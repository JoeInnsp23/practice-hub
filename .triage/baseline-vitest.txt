
> practice-hub@0.1.0 test /root/projects/practice-hub
> vitest run --run --pool=threads --poolOptions.threads.singleThread=true --reporter=verbose


 RUN  v3.2.4 /root/projects/practice-hub

stdout | __tests__/routers/invoices.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > create (Integration) > should create invoice and persist to database 326ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > create (Integration) > should create invoice with items 52ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > create (Integration) > should create activity log for invoice creation 46ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > create (Integration) > should validate invoice calculations (subtotal + tax = total) 45ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > create (Integration) > should validate required fields 39ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > list (Integration) > should list invoices with tenant isolation 75ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > list (Integration) > should filter invoices by search term (invoice number) 40ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > list (Integration) > should filter invoices by status 33ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > list (Integration) > should filter invoices by clientId 50ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > list (Integration) > should filter overdue invoices 24ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > getById (Integration) > should retrieve invoice by ID with items 29ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 33ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 48ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > update (Integration) > should update invoice and persist changes 38ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > update (Integration) > should create activity log for update 36ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent invoice 30ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > update (Integration) > should prevent cross-tenant update 42ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > update (Integration) > should allow partial updates 41ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > updateStatus (Integration) > should update invoice status and persist changes 43ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > updateStatus (Integration) > should create activity log for status update 32ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > updateStatus (Integration) > should throw NOT_FOUND for non-existent invoice 43ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > updateStatus (Integration) > should prevent cross-tenant status update 31ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > delete (Integration) > should delete invoice and invoice items 31ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > delete (Integration) > should create activity log for deletion 38ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent invoice 21ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 55ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Invoice Calculations > should handle invoice with discount correctly 47ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Invoice Calculations > should handle partial payments correctly 35ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Invoice Calculations > should handle zero tax invoices 28ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should update status for multiple invoices 71ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should enforce multi-tenant isolation 69ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should log activity for bulk status update (AC22) 53ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkSendEmails > should send emails for multiple invoices (AC9-10) 52ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkSendEmails > should track sent/failed counts for progress tracking (AC9-10) 44ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkSendEmails > should log activity for bulk email operations (AC22) 39ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should delete multiple invoices and cascade to items 46ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should enforce multi-tenant isolation 53ms
stdout | __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should generate PDF for valid invoice
Rendering PDF for invoice: 98dd7b32-42f1-41f2-acaf-2a1f297877ef

stderr | __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should generate PDF for valid invoice
Error generating invoice PDF: ReferenceError: React is not defined
    at generateInvoicePdf [90m(/root/projects/practice-hub/[39mlib/pdf/generate-invoice-pdf.tsx:106:7[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/root/projects/practice-hub/[39mapp/server/routers/invoices.ts:618:26
    at resolveMiddleware [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:571:22[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at procedure [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:673:20[90m)[39m
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/router.ts:474:20

 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should log activity for bulk delete (AC22) 47ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Bulk Operations (Integration) > Transaction Safety (AC23) > should rollback on partial failure - bulkUpdateStatus 30ms
stdout | __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should log activity when PDF is generated
Rendering PDF for invoice: 73f43692-808b-4b4f-8186-bf1405f4ca63

stderr | __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should log activity when PDF is generated
Error generating invoice PDF: ReferenceError: React is not defined
    at generateInvoicePdf [90m(/root/projects/practice-hub/[39mlib/pdf/generate-invoice-pdf.tsx:106:7[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/root/projects/practice-hub/[39mapp/server/routers/invoices.ts:618:26
    at resolveMiddleware [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:571:22[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at procedure [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:673:20[90m)[39m
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/router.ts:474:20

 Ã— __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should generate PDF for valid invoice 73ms
   â†’ Failed to generate PDF: React is not defined
 Ã— __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should log activity when PDF is generated 33ms
   â†’ Failed to generate PDF: React is not defined
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should reject PDF generation for non-existent invoice 23ms
stdout | __tests__/routers/invoices.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should enforce tenant isolation for PDF generation 59ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Router Structure > should export all expected procedures 31ms
 âœ“ __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > Router Structure > should have 10 procedures total 23ms
stdout | __tests__/routers/users.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > list > should accept empty input 31ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > list > should accept search parameter 3ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > list > should accept role filter 3ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > list > should accept multiple filters 3ms
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > getById > should accept valid UUID 16ms
   â†’ promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > getById > should validate input is a string 1ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should validate required fields 1ms
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept valid user data 20ms
   â†’ promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept any string as email 25ms
   â†’ promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept optional phone field 35ms
   â†’ promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should validate required id field 1ms
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept valid update data 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept any string as email in updates 1ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept partial updates 1ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > delete > should accept valid user ID 31ms
   â†’ promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > delete > should validate input is a string 2ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > updateRole > should validate required fields 1ms
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > updateRole > should accept valid role update 4ms
   â†’ promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > updateRole > should validate id is a string 2ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > sendPasswordReset > should validate required userId field 1ms
 Ã— __tests__/routers/users.test.ts > app/server/routers/users.ts > sendPasswordReset > should accept valid userId 6ms
   â†’ promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > sendPasswordReset > should validate userId is a string 2ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkUpdateStatus > should update status for multiple users 124ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkUpdateStatus > should enforce multi-tenant isolation 52ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkUpdateStatus > should log activity for bulk status update (AC22) 40ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkUpdateStatus > should prevent admin from deactivating own account (AC18 - CRITICAL) 17ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkChangeRole > should change role for multiple users 55ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkChangeRole > should enforce multi-tenant isolation 26ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkChangeRole > should log activity for bulk role change (AC22) 38ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkChangeRole > should handle invalid role values 26ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkAssignDepartment > should assign department to multiple users 59ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkAssignDepartment > should enforce multi-tenant isolation 36ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkAssignDepartment > should log activity for bulk department assignment (AC22) 43ms
stdout | __tests__/routers/users.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > bulkAssignDepartment > should validate department exists 36ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Bulk Operations (Integration) > Transaction Safety (AC23) > should rollback on partial failure - bulkUpdateStatus 31ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/users.test.ts > app/server/routers/users.ts > Router Structure > should have 10 procedures total 1ms
stdout | __tests__/routers/proposals.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list > should accept empty input 5ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list > should accept status filter 2ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list > should accept clientId filter 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list > should accept search parameter 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > getById > should accept valid UUID 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > getById > should validate input is a string 2ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > create > should validate required fields 5ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > create > should accept valid proposal data 5ms
   â†’ promise rejected "TRPCError: db.transâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > create > should validate totalAmount is a number 2ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > createFromLead > should accept valid lead ID 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > createFromLead > should validate required leadId field 2ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > update > should validate required id field 3ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > update > should accept valid update data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > update > should accept partial updates 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > delete > should accept valid proposal ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > delete > should validate input is a string 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > send > should validate required fields 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > send > should accept valid send data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > send > should validate required fields 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > trackView > should accept valid proposal ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > trackView > should validate input is a string 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > addSignature > should validate required fields 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > addSignature > should accept valid signature data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > addSignature > should accept any string as email 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > getStats > should have no required input 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > generatePdf > should accept valid proposal ID 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > generatePdf > should validate input is a string 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should accept valid sales stage update 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should validate all sales stage enum values 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should reject invalid sales stage 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should require both id and salesStage 2ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list with salesStage filter > should accept salesStage filter 2ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list with salesStage filter > should accept salesStage with other filters 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > list with salesStage filter > should reject invalid salesStage values 8ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept empty input 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by assignedToId 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by date range 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by value range 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by specific stages 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept search parameter 1ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept all filters combined 2ms
   â†’ promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should reject invalid stage values 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should validate value range types 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage - Advanced Validation > should require both id and salesStage fields 1ms
stdout | __tests__/routers/proposals.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage - Advanced Validation > should validate salesStage is a valid enum value 1ms
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should create a note for a proposal 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should create an internal note 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should reject note for non-existent proposal 7ms
   â†’ expected [Function] to throw error including 'Proposal not found' but got '(intermediate value) is not iterable'
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNotes > should retrieve notes for a proposal 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNotes > should support pagination 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > updateNote > should allow author to update their note 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > updateNote > should reject update for non-existent note 2ms
   â†’ expected [Function] to throw error including 'Note not found' but got '(intermediate value) is not iterable'
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > deleteNote > should allow author to delete their note 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > deleteNote > should reject delete for non-existent note 2ms
   â†’ expected [Function] to throw error including 'Note not found' but got '(intermediate value) is not iterable'
 Ã— __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNoteCount > should count notes for a proposal 1ms
   â†’ Cannot read properties of undefined (reading 'id')
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Router Structure > should export all expected procedures 1ms
 âœ“ __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Router Structure > should have 25 procedures total 1ms
stdout | __tests__/routers/clientPortalAdmin.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate required fields 2ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept valid invitation data 5ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate email format 2ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate firstName minimum length 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate lastName minimum length 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate clientIds array minimum length 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should validate role enum values 1ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept all valid role values 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept optional message 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > listInvitations > should accept empty input 2ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > listInvitations > should accept status filter 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > listInvitations > should validate status enum values 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > listInvitations > should accept all valid status values 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > resendInvitation > should validate required invitationId field 1ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > resendInvitation > should accept valid invitation ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > revokeInvitation > should validate required invitationId field 1ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > revokeInvitation > should accept valid invitation ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > listPortalUsers > should have no required input 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should validate required fields 1ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept valid access grant data 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept optional expiresAt 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should validate role enum values 1ms
 Ã— __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept all valid role values 2ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > revokeAccess > should validate required accessId field 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > revokeAccess > should accept valid access ID 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > updateRole > should validate required fields 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > updateRole > should accept valid role update data 1ms
stdout | __tests__/routers/clientPortalAdmin.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > updateRole > should validate role enum values 2ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > suspendUser > should validate required portalUserId field 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > suspendUser > should accept valid portal user ID 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > reactivateUser > should validate required portalUserId field 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > reactivateUser > should accept valid portal user ID 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > Router Structure > should export all expected procedures 1ms
 âœ“ __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > Router Structure > should have 10 procedures total 1ms
stdout | __tests__/routers/clientPortal.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getMyClients > should have no required input 1ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should validate required clientId field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept valid input without status 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept valid input with status 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should validate status enum values 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept all valid status values 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposalById > should validate required id field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposalById > should accept valid proposal ID 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should validate required clientId field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept valid input without status 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept valid input with status 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should validate status enum values 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept all valid status values 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoiceById > should validate required id field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoiceById > should accept valid invoice ID 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocuments > should validate required clientId field 1ms
stdout | __tests__/routers/clientPortal.test.ts
âœ… Test teardown complete

 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocuments > should accept valid client ID 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocumentsToSign > should validate required clientId field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocumentsToSign > should accept valid client ID 3ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getSignedDocuments > should validate required clientId field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getSignedDocuments > should accept valid client ID 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMyThreads > should validate required clientId field 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMyThreads > should accept valid client ID 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getThread > should validate required fields 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getThread > should accept valid thread and client IDs 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should validate required fields 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should accept valid input with defaults 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should validate limit min value 5ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should validate limit max value 3ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should validate offset min value 1ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should validate required fields 4ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept valid message data 14ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should validate content minimum length 2ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should validate content maximum length 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept file type 1ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept message without metadata 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > markThreadAsRead > should validate required fields 1ms
 Ã— __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > markThreadAsRead > should accept valid thread and client IDs 2ms
   â†’ promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > Router Structure > should export all expected procedures 1ms
 âœ“ __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > Router Structure > should have 15 procedures total 1ms
stdout | __tests__/routers/analytics.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLeadStats > should accept empty input 3ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLeadStats > should accept date range 2ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLeadStats > should accept startDate only 2ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLeadStats > should accept endDate only 1ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getProposalStats > should accept empty input 1ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getProposalStats > should accept date range 1ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getConversionMetrics > should accept empty input 1ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getConversionMetrics > should accept date range 1ms
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineMetrics > should accept empty input 5ms
   â†’ promise rejected "TRPCError: leadsByStage.reduce is not a fâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineMetrics > should accept date range 2ms
   â†’ promise rejected "TRPCError: leadsByStage.reduce is not a fâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getModelComparison > should accept empty input 2ms
   â†’ promise rejected "TRPCError: modelStats.find is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getModelComparison > should accept date range 2ms
   â†’ promise rejected "TRPCError: modelStats.find is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept empty input 2ms
   â†’ promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept date range 2ms
   â†’ promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept limit parameter 12ms
   â†’ promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept all parameters combined 3ms
   â†’ promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should reject limit below min value 2ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should reject limit above max value 1ms
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getDiscountAnalysis > should accept empty input 3ms
   â†’ promise rejected "TRPCError: proposalsWithDiscounts is not â€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getDiscountAnalysis > should accept date range 3ms
   â†’ promise rejected "TRPCError: proposalsWithDiscounts is not â€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getTaskMetrics > should have no required input 1ms
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getComplexityDistribution > should accept empty input 2ms
   â†’ promise rejected "TRPCError: proposalsWithMetadata is not iâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getComplexityDistribution > should accept date range 2ms
   â†’ promise rejected "TRPCError: proposalsWithMetadata is not iâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept empty input 3ms
   â†’ promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept date range 3ms
   â†’ promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept assignedToId filter 2ms
   â†’ promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept clientId filter 2ms
   â†’ promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept all filters combined 2ms
   â†’ promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineValueByStage > should accept empty input 3ms
   â†’ promise rejected "TRPCError: stageData.reduce is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineValueByStage > should accept asOf date 2ms
   â†’ promise rejected "TRPCError: stageData.reduce is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getAverageDealSize > should accept empty input 3ms
   â†’ promise rejected "TRPCError: byStage.map is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getAverageDealSize > should accept date range 3ms
   â†’ promise rejected "TRPCError: byStage.map is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getSalesCycleDuration > should accept empty input 3ms
   â†’ promise rejected "TRPCError: wonProposals.map is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getSalesCycleDuration > should accept date range 3ms
   â†’ promise rejected "TRPCError: wonProposals.map is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should accept empty input 3ms
   â†’ promise rejected "TRPCError: monthlyData.map is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should accept months parameter 2ms
   â†’ promise rejected "TRPCError: monthlyData.map is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should reject months below min value 2ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should reject months above max value 2ms
 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLossReasons > should accept empty input 3ms
   â†’ promise rejected "TRPCError: lossData.reduce is not a functâ€¦ { code: 'â€¦' }" instead of resolving
stdout | __tests__/routers/analytics.test.ts
âœ… Test teardown complete

 Ã— __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLossReasons > should accept date range 4ms
   â†’ promise rejected "TRPCError: lossData.reduce is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > Router Structure > should export all expected procedures 3ms
 âœ“ __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > Router Structure > should have 17 procedures total 1ms
stdout | __tests__/routers/invitations.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getRateLimitStatus > should have no required input 2ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should accept empty input 4ms
   â†’ promise rejected "TRPCError: logs.reverse is not a function { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should accept limit parameter 3ms
   â†’ promise rejected "TRPCError: logs.reverse is not a function { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should default limit to 20 3ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should validate limit min value 2ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should validate limit max value 3ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > list > should have no required input 2ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should validate required fields 2ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept valid invitation data 4ms
   â†’ promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept custom message 2ms
   â†’ promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should validate role enum values 2ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept all valid role values 3ms
   â†’ promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should validate email format 2ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > verify > should validate required token field 1ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > verify > should accept valid token 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should validate required fields 3ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should accept valid acceptance data 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should accept optional name fields 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should validate password minimum length 3ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > resend > should validate required invitationId field 3ms
stdout | __tests__/routers/invitations.test.ts
âœ… Test teardown complete

 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > resend > should accept valid invitation ID 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > resend > should validate UUID format 3ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > cancel > should validate required invitationId field 2ms
 Ã— __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > cancel > should accept valid invitation ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > Router Structure > should export all expected procedures 3ms
 âœ“ __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > Router Structure > should have 8 procedures total 1ms
stdout | __tests__/routers/messages.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listThreads > should have no required input 5ms
stdout | __tests__/routers/messages.test.ts
âœ… Test teardown complete

 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > getThread > should accept valid thread ID 9ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > getThread > should validate UUID format 3ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createDirectMessage > should validate required participantIds field 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createDirectMessage > should accept valid participant list 4ms
   â†’ promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createDirectMessage > should validate minimum participant count 2ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createDirectMessage > should validate maximum participant count 2ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createChannel > should validate required name field 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createChannel > should accept valid channel data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createChannel > should accept optional fields 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createClientThread > should validate required fields 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createClientThread > should accept valid client thread data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createClientThread > should accept optional initial message 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > addParticipant > should validate required fields 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > addParticipant > should accept valid participant data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > removeParticipant > should validate required fields 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > removeParticipant > should accept valid removal data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should validate required threadId field 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should accept valid thread ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should accept pagination parameters 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should validate limit max value 2ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should validate required fields 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should accept valid message data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should accept optional fields 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should validate content minimum length 3ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should validate content maximum length 13ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > editMessage > should validate required fields 2ms
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > editMessage > should accept valid edit data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/messages.test.ts > app/server/routers/messages.ts > deleteMessage > should accept valid message ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > deleteMessage > should validate UUID format 2ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > markAsRead > should accept valid thread ID 1ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > getUnreadCount > should have no required input 1ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/messages.test.ts > app/server/routers/messages.ts > Router Structure > should have 13 procedures total 1ms
stdout | __tests__/routers/proposalTemplates.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/proposalTemplates.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept empty input 4ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept category filter 2ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept isActive filter 2ms
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept search parameter 5ms
   â†’ promise rejected "TRPCError: templates.filter is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept all filters combined 3ms
   â†’ promise rejected "TRPCError: templates.filter is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > getById > should accept valid UUID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > getById > should reject invalid UUID 2ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > getById > should reject non-string input 3ms
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept valid template data with minimal fields 5ms
   â†’ promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept valid template data with all fields 4ms
   â†’ promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should require name field 2ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should require defaultServices array 2ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should validate defaultServices structure 2ms
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept service config as optional 3ms
   â†’ promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept partial update data 4ms
   â†’ promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept updating multiple fields 11ms
   â†’ promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept updating services 3ms
   â†’ promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should require valid UUID for id 2ms
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept empty data object 2ms
   â†’ promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > delete > should accept valid UUID 2ms
   â†’ promise rejected "TRPCError: Failed to delete template { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > delete > should reject invalid UUID 2ms
 Ã— __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > setDefault > should accept valid UUID 4ms
   â†’ promise rejected "TRPCError: Failed to set default template { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > setDefault > should reject invalid UUID 2ms
 âœ“ __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > setDefault > should reject non-string input 2ms
stdout | __tests__/routers/pricingAdmin.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/pricingAdmin.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getAllComponents > should have no required input 2ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getComponent > should accept valid component ID 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getComponent > should validate input is a string 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createComponent > should validate required fields 4ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createComponent > should accept valid component data 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateComponent > should validate required id field 5ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateComponent > should accept valid update data 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateComponent > should accept partial updates 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > deleteComponent > should accept valid component ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > deleteComponent > should validate input is a string 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > cloneComponent > should validate required fields 2ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > cloneComponent > should accept valid clone data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkUpdateComponents > should validate required fields 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkUpdateComponents > should accept valid bulk update data 14ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkUpdateComponents > should validate ids is an array 3ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getAllRules > should have no required input 1ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getRulesByComponent > should accept valid component ID 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createRule > should validate required fields 3ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createRule > should accept valid rule data 3ms
   â†’ promise rejected "TRPCError: [
  {
    "expected": "string"â€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateRule > should validate required id field 2ms
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateRule > should accept valid update data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > deleteRule > should accept valid rule ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkCreateRules > should accept array of valid rules 3ms
   â†’ promise rejected "TRPCError: [
  {
    "expected": "string"â€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkCreateRules > should validate input is an array 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > validatePricingIntegrity > should have no required input 1ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > Router Structure > should have 14 procedures total 1ms
stdout | __tests__/routers/pricing.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/pricing.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should validate required fields 3ms
 Ã— __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept valid calculation input 6ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept service with configuration 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept transaction data 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept modifiers 14ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should validate industry enum values 3ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept all valid industry values 4ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > getComponents > should have no required input 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > getRules > should validate required componentId field 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > getRules > should accept valid component ID 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > estimateTransactions > should validate required fields 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > estimateTransactions > should accept valid estimation input 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > estimateTransactions > should accept all valid turnover bands 16ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > Router Structure > should have 4 procedures total 1ms
stdout | __tests__/routers/activities.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/activities.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getRecent > should accept empty input 4ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getRecent > should accept limit parameter 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getRecent > should validate limit min value 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getRecent > should validate limit max value 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > list > should validate required fields 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > list > should accept valid input 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > list > should accept limit parameter 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > create > should validate required fields 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > create > should accept valid activity data 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > create > should accept optional metadata 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getActivityCounts > should validate required fields 2ms
 Ã— __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getActivityCounts > should accept valid input 4ms
   â†’ promise rejected "TRPCError: activities is not iterable { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/activities.test.ts > app/server/routers/activities.ts > Router Structure > should have 4 procedures total 2ms
stdout | __tests__/routers/legal.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/legal.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should require pageType input 4ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: privacy 6ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: terms 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: cookie_policy 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should reject invalid pageType 2ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should require both pageType and content 3ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should accept valid input with pageType and content 3ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should reject empty content 1ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should accept markdown formatted content 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getVersionHistory > should require pageType input 1ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getVersionHistory > should accept valid pageType 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getVersionHistory > should reject invalid pageType 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getAll > should have no required input 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > multi-tenant isolation > getByType should be protected (requires authentication) 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > multi-tenant isolation > update should require admin role 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > multi-tenant isolation > getVersionHistory should require admin role 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > multi-tenant isolation > getAll should be protected (requires authentication) 1ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > version tracking > update input should accept content that will be versioned 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should reject null pageType 1ms
 âœ“ __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should reject undefined pageType 1ms
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should accept long content for update 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should handle special characters in content 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
stdout | __tests__/routers/admin-kyc.test.ts
ðŸ§ª Test setup initialized

 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept empty input 6ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept status filter 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept pagination parameters 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should validate status enum values 3ms
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept both pending and completed status 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > getVerificationDetail > should validate required verificationId field 2ms
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > getVerificationDetail > should accept valid verification ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > approveVerification > should validate required verificationId field 2ms
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > approveVerification > should accept valid approval data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > approveVerification > should accept optional notes 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > rejectVerification > should validate required fields 2ms
 Ã— __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > rejectVerification > should accept valid rejection data 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > rejectVerification > should validate reason minimum length 2ms
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > getReviewStats > should have no required input 1ms
stdout | __tests__/routers/admin-kyc.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > Router Structure > should have 5 procedures total 1ms
stdout | __tests__/routers/leads.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/leads.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > list > should accept empty input 4ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > list > should accept search parameter 1ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > list > should accept status filter 1ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > list > should accept source filter 1ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > list > should accept multiple filters 1ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > getById > should accept valid UUID 4ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > getById > should validate input is a string 2ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should validate required fields 2ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept valid lead data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept any string as email 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept optional fields 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > update > should validate required id field 2ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > update > should accept valid update data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > update > should validate email format in updates 1ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > delete > should accept valid lead ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > delete > should validate input is a string 2ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > assignLead > should validate required fields 2ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > assignLead > should accept valid assignment data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > scheduleFollowUp > should validate required fields 2ms
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > scheduleFollowUp > should accept valid follow-up data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > scheduleFollowUp > should validate nextFollowUpAt is a string 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/leads.test.ts > app/server/routers/leads.ts > convertToClient > should accept valid conversion data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > convertToClient > should validate required fields 2ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > getStats > should have no required input 1ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/leads.test.ts > app/server/routers/leads.ts > Router Structure > should have 10 procedures total 1ms
stdout | __tests__/routers/transactionData.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/transactionData.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getByClient > should accept valid client ID 3ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getByClient > should validate input is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should validate required fields 2ms
 Ã— __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should accept valid estimate input 5ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should validate turnover is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should validate industry is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should validate vatRegistered is a boolean 2ms
 Ã— __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > should accept valid client ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > should validate input is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should fetch transactions from Xero and calculate monthly average 10ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should handle errors when Xero connection not found 5ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should handle errors when token refresh fails 4ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should handle errors when fetching transactions fails 4ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should handle empty transaction list 5ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > Implementation > should respect tenant isolation (uses correct client's connection) 5ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > upsert > should validate required fields 3ms
 Ã— __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > upsert > should accept valid upsert input 4ms
   â†’ promise rejected "TRPCError: undefined is not iterable (canâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > upsert > should validate monthlyTransactions is a number 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > delete > should accept valid transaction data ID 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > delete > should validate input is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getAllWithData > should have no required input 1ms
 Ã— __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getHistory > should accept valid client ID 2ms
   â†’ promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getHistory > should validate input is a string 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > Router Structure > should have 7 procedures total 1ms
stdout | __tests__/routers/notifications.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/notifications.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > list > should accept empty input 4ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > list > should accept pagination parameters 3ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > list > should accept unreadOnly filter 2ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > list > should validate limit max value 2ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > list > should validate limit min value 2ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > getUnreadCount > should have no required input 1ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > markAsRead > should validate required notificationId field 2ms
 Ã— __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > markAsRead > should accept valid notification ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > markAsRead > should validate UUID format 2ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > markAllAsRead > should have no required input 1ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > delete > should validate required notificationId field 2ms
 Ã— __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > delete > should accept valid notification ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > create > should validate required fields 2ms
 Ã— __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > create > should accept valid notification data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > create > should accept optional fields 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > Router Structure > should have 6 procedures total 1ms
stdout | __tests__/routers/workflows.versioning.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/workflows.versioning.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Router Procedures Exist > should have all version management procedures 3ms
 âœ“ __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate listVersions input 2ms
 âœ“ __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate publishVersion input 2ms
 âœ“ __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate publishVersion input with publishNotes 2ms
 Ã— __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate compareVersions input 4ms
   â†’ promise rejected "TRPCError: One or both versions not found { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate rollbackToVersion input 2ms
   â†’ promise rejected "TRPCError: Workflow not found { â€¦(1) }" instead of resolving
 Ã— __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate rollbackToVersion input with minimal fields 2ms
   â†’ promise rejected "TRPCError: Workflow not found { â€¦(1) }" instead of resolving
 Ã— __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate migrateInstances input 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Task Assignment with Versioning > should validate assignWorkflow input 6ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
stdout | __tests__/routers/calendar.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/calendar.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > listEvents > should accept empty input 3ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > listEvents > should accept date range filters 2ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > listEvents > should accept type filter 1ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > listEvents > should reject invalid type enum values 1ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > getEvent > should reject missing eventId field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > getEvent > should accept valid event ID 3ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > getEvent > should reject invalid UUID format 1ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should reject missing required fields 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept valid event data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept optional fields 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept all-day events 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > updateEvent > should reject missing eventId field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > updateEvent > should accept valid update data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > updateEvent > should accept partial updates 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > deleteEvent > should reject missing eventId field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > deleteEvent > should accept valid event ID 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > respondToInvitation > should reject missing status field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > respondToInvitation > should accept valid response data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > respondToInvitation > should accept all status values 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > addAttendee > should reject missing userId field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > addAttendee > should accept valid attendee data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > addAttendee > should accept optional isOptional field 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > removeAttendee > should reject missing eventId field 1ms
 Ã— __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > removeAttendee > should accept valid removal data 2ms
   â†’ promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > Router Structure > should export all expected procedures 1ms
 âœ“ __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > Router Structure > should have 8 procedures total 1ms
stdout | __tests__/routers/pricingConfig.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > getConfig > should have no required input 3ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should validate required fields 2ms
stdout | __tests__/routers/pricingConfig.test.ts
âœ… Test teardown complete

 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should accept valid Model A multipliers 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should accept valid Model B multipliers 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should validate model enum values 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should validate multiplier min value 2ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should validate multiplier max value 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateIndustryMultipliers > should validate required fields 1ms
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateIndustryMultipliers > should accept valid industry multipliers 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateIndustryMultipliers > should validate multiplier ranges 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateDiscountRules > should validate required fields 1ms
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateDiscountRules > should accept valid discount rules 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateDiscountRules > should validate percentage ranges 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateDiscountRules > should validate duration ranges 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should validate required fields 2ms
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept valid global settings 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should validate industry enum values 2ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should validate rounding rule enum values 1ms
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept all valid industry values 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept all valid rounding rules 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > resetToDefaults > should have no required input 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > exportConfig > should have no required input 1ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > importConfig > should validate required fields 2ms
 Ã— __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > importConfig > should accept valid configuration import 2ms
   â†’ promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > Router Structure > should have 8 procedures total 1ms
stdout | __tests__/routers/tasks.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should create task and persist to database 139ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should create activity log for task creation 61ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should auto-assign to current user if no assignee specified 36ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should set default status to pending if not provided 38ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should set default priority to medium if not provided 49ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > create (Integration) > should validate required fields 27ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should list tasks with tenant isolation 64ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should filter tasks by search term 46ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should filter tasks by status 56ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should filter tasks by priority 54ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should filter tasks by assignee 46ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > list (Integration) > should filter tasks by client 55ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getById (Integration) > should retrieve task by ID 54ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 31ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 72ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getById (Integration) > should include client information in response 55ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should update task and persist changes 45ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should auto-set progress to 100 when status changes to completed 52ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should create activity log for update 39ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent task 24ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should prevent cross-tenant update 44ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > update (Integration) > should allow partial updates 53ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > delete (Integration) > should delete task from database 48ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > delete (Integration) > should create activity log for deletion 42ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent task 18ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 33ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateStatus (Integration) > should update task status 41ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateStatus (Integration) > should set completedAt when status changes to completed 31ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateStatus (Integration) > should create activity log for status update 36ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateStatus (Integration) > should throw NOT_FOUND for non-existent task 25ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkUpdateStatus (Integration) > should update status for multiple tasks 45ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkUpdateStatus (Integration) > should create activity logs for each task 51ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkUpdateStatus (Integration) > should throw error if any task not found 43ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkAssign (Integration) > should assign multiple tasks to a user 44ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkAssign (Integration) > should create activity logs for each assignment 35ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkDelete (Integration) > should delete multiple tasks 40ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkDelete (Integration) > should create activity logs before deletion 23ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > assignWorkflow (Integration) > should assign workflow to task and create workflow instance 38ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > assignWorkflow (Integration) > should throw NOT_FOUND for non-existent task 18ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > assignWorkflow (Integration) > should throw NOT_FOUND for non-existent workflow 23ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > assignWorkflow (Integration) > should prevent cross-tenant workflow assignment 38ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getWorkflowInstance (Integration) > should retrieve workflow instance for task 60ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getWorkflowInstance (Integration) > should return null if task has no workflow 39ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getWorkflowInstance (Integration) > should throw NOT_FOUND for non-existent task 22ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getWorkflowInstance (Integration) > should prevent cross-tenant access 44ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateChecklistItem (Integration) > should update checklist item completion status 64ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateChecklistItem (Integration) > should create activity log for checklist update 149ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > updateChecklistItem (Integration) > should throw NOT_FOUND for non-existent workflow instance 25ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Router Structure > should export all expected procedures 29ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Router Structure > should have 26 procedures total 30ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > createNote > should create a task note 51ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > createNote > should create an internal note 42ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > createNote > should create notifications for mentioned users 48ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > createNote > should reject note for non-existent task 28ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > createNote > should enforce tenant isolation 51ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNotes > should get all notes for a task 49ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNotes > should order notes by creation date (newest first) 64ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNotes > should support pagination 64ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNotes > should not return soft-deleted notes 71ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > updateNote > should update note content 36ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > updateNote > should update updatedAt timestamp 61ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > updateNote > should allow admin to update any note 63ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > updateNote > should reject update by non-owner non-admin 41ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > deleteNote > should soft delete a note 34ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > deleteNote > should allow admin to delete any note 57ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > deleteNote > should reject delete by non-owner non-admin 43ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNoteCount > should return 0 for task with no notes 32ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by first name
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1)
params: 2e593e12-1c70-48f6-9009-4ea9361b30f1
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1)'[39m,
  params: [ [32m'2e593e12-1c70-48f6-9009-4ea9361b30f1'[39m ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(2e593e12-1c70-48f6-9009-4ea9361b30f1) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNoteCount > should return correct count 45ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getNoteCount > should exclude soft-deleted notes from count 45ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by last name
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1)
params: 00e7afb3-005c-403b-aee5-2fe76588db30
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1)'[39m,
  params: [ [32m'00e7afb3-005c-403b-aee5-2fe76588db30'[39m ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(00e7afb3-005c-403b-aee5-2fe76588db30) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by first name 61ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by last name 38ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by email
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1)
params: 13f6f231-cb3c-4098-acd6-9cdc45962266
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1)'[39m,
  params: [ [32m'13f6f231-cb3c-4098-acd6-9cdc45962266'[39m ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(13f6f231-cb3c-4098-acd6-9cdc45962266) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should search by email 133ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should be case insensitive
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1)
params: a15774ac-6411-425c-b37f-475a128e7a71
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1)'[39m,
  params: [ [32m'a15774ac-6411-425c-b37f-475a128e7a71'[39m ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(a15774ac-6411-425c-b37f-475a128e7a71) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should be case insensitive 141ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should limit results to 10
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1)
params: 268bf26b-2ce6-4836-b9e2-3062951e447b
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1)'[39m,
  params: [ [32m'268bf26b-2ce6-4836-b9e2-3062951e447b'[39m ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(268bf26b-2ce6-4836-b9e2-3062951e447b) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should limit results to 10 110ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should only return users from same tenant
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1, $2)
params: 1ff5c5ed-d86e-453a-837e-3abed2671965,704478c8-5d5b-485a-8970-7d66a60d5578
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1, $2)'[39m,
  params: [
    [32m'1ff5c5ed-d86e-453a-837e-3abed2671965'[39m,
    [32m'704478c8-5d5b-485a-8970-7d66a60d5578'[39m
  ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(1ff5c5ed-d86e-453a-837e-3abed2671965) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > Task Notes Procedures (Integration) > getMentionableUsers > should only return users from same tenant 125ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > reassign (Integration) > should reassign a task to a new user 166ms
stderr | __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > reassign (Integration) > should enforce tenant isolation
Test cleanup error: DrizzleQueryError: Failed query: delete from "tenants" where "tenants"."id" in ($1, $2)
params: b8bc4939-7451-4434-9680-2038973836a0,856a2f09-b116-4cec-aac0-00ecb5e6d6d3
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
  query: [32m'delete from "tenants" where "tenants"."id" in ($1, $2)'[39m,
  params: [
    [32m'b8bc4939-7451-4434-9680-2038973836a0'[39m,
    [32m'856a2f09-b116-4cec-aac0-00ecb5e6d6d3'[39m
  ],
  cause: error: update or delete on table "tenants" violates foreign key constraint "users_tenant_id_tenants_id_fk" on table "users"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:383:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/tasks.test.ts:77:5 {
    length: [33m320[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(856a2f09-b116-4cec-aac0-00ecb5e6d6d3) is still referenced from table "users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'users'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'users_tenant_id_tenants_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > reassign (Integration) > should prevent self-reassignment 50ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > reassign (Integration) > should enforce tenant isolation 60ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > bulkReassign (Integration) > should reassign multiple tasks 137ms
 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getAssignmentHistory (Integration) > should return assignment history for a task 79ms
stdout | __tests__/routers/tasks.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/tasks.test.ts > app/server/routers/tasks.ts (Integration) > getAssignmentHistory (Integration) > should return empty array for task with no history 34ms
stdout | __tests__/performance/timesheet-approval.perf.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17)

â³ Setting up performance test environment...

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17)
â³ Creating 100 staff members with pending timesheet submissions...

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17)
âœ“ Performance test setup complete: 100 staff, 100 pending submissions, tenant 176acd6d-a297-4b1c-a9a4-c811d199b018

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.1: Should load 100 pending approvals in < 2 seconds

ðŸ“Š Testing Approvals Page Load Performance (AC17.1)...

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.1: Should load 100 pending approvals in < 2 seconds

ðŸ“Š Approvals Page Load Performance:
   Pending submissions: 100
   Execution time: 0.006s
   Avg per submission: 0.0001s
   Status: âœ… PASS (AC17 requirement: <2s)


stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.2: Should bulk approve 50 submissions in < 5 seconds

ðŸ“Š Testing Bulk Approval Performance (AC17.2)...

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.2: Should bulk approve 50 submissions in < 5 seconds

âš¡ Bulk Approval Performance:
   Submissions approved: 50
   Execution time: 0.105s
   Avg per submission: 0.0021s
   Status: âœ… PASS (AC17 requirement: <5s)


 âœ“ __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.1: Should load 100 pending approvals in < 2 seconds 9ms
stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.3: Should bulk reject 50 submissions in < 5 seconds

ðŸ“Š Testing Bulk Rejection Performance (AC17.3)...

stdout | __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.3: Should bulk reject 50 submissions in < 5 seconds

âš¡ Bulk Rejection Performance:
   Submissions rejected: 50
   Execution time: 0.015s
   Avg per submission: 0.0003s
   Status: âœ… PASS (AC17 requirement: <5s)


 âœ“ __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.2: Should bulk approve 50 submissions in < 5 seconds 112ms
 âœ“ __tests__/performance/timesheet-approval.perf.test.ts > Timesheet Approval Performance Tests (AC17) > AC17.3: Should bulk reject 50 submissions in < 5 seconds 24ms
stdout | __tests__/performance/timesheet-approval.perf.test.ts
âœ… Test teardown complete

stdout | __tests__/routers/documents.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should create folder and persist to database 125ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should create folder with client association 59ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should create nested folder with correct path 65ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should create folder with tags 36ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should throw NOT_FOUND for invalid parent folder 28ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createFolder (Integration) > should throw BAD_REQUEST when parent is not a folder 57ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should list documents with tenant isolation 60ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should filter by client ID 65ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should filter by type (file vs folder) 57ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should filter by search term 31ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should filter by parent folder 51ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should list root-level documents with null parentId 45ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > list (Integration) > should respect pagination limits 27ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > get (Integration) > should retrieve document by ID 55ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > get (Integration) > should throw NOT_FOUND for non-existent document 32ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > get (Integration) > should prevent cross-tenant access (CRITICAL) 51ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should update document and persist changes 29ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should update document tags 59ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should move document to different parent folder 64ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should move document to root level with null parentId 33ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent document 24ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should throw BAD_REQUEST for invalid parent folder 34ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > update (Integration) > should prevent cross-tenant update 34ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > delete (Integration) > should delete file document 34ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > delete (Integration) > should delete empty folder 33ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > delete (Integration) > should throw BAD_REQUEST when deleting non-empty folder 50ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent document 16ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 52ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getPresignedUrl (Integration) > should generate presigned URL for file 36ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getPresignedUrl (Integration) > should throw NOT_FOUND for non-existent document 20ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getPresignedUrl (Integration) > should throw BAD_REQUEST for folder (not file) 29ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getPresignedUrl (Integration) > should prevent cross-tenant access 48ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createShareLink (Integration) > should create shareable link for document 54ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createShareLink (Integration) > should create share link without expiration 43ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createShareLink (Integration) > should throw NOT_FOUND for non-existent document 20ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createShareLink (Integration) > should throw BAD_REQUEST for folder 31ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > createShareLink (Integration) > should prevent cross-tenant access 42ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSharedDocument (Integration) > should retrieve document by share token 45ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSharedDocument (Integration) > should throw NOT_FOUND for invalid share token 16ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSharedDocument (Integration) > should throw FORBIDDEN for expired share link 33ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSharedDocument (Integration) > should throw NOT_FOUND for revoked share link 44ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > revokeShareLink (Integration) > should revoke share link 37ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > revokeShareLink (Integration) > should succeed even if document is not shared 29ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > revokeShareLink (Integration) > should prevent cross-tenant access 55ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getStorageStats (Integration) > should calculate storage statistics for tenant 38ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getStorageStats (Integration) > should only count files from current tenant 33ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > search (Integration) > should search documents by query 25ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > search (Integration) > should filter search by client 47ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > search (Integration) > should respect search limit 24ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > search (Integration) > should enforce tenant isolation in search 56ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSigningStatus (Integration) > should return status for document not requiring signature 27ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSigningStatus (Integration) > should return status for document requiring signature 39ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSigningStatus (Integration) > should throw NOT_FOUND for non-existent document 18ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > getSigningStatus (Integration) > should prevent cross-tenant access 52ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkMove > should move multiple documents to folder 58ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkMove > should enforce multi-tenant isolation 50ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkMove > should log activity for bulk move (AC22) 57ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkChangeCategory > should change tags for multiple documents (replace mode - AC13) 40ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkChangeCategory > should add tags to existing tags (add mode - AC13) 65ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkChangeCategory > should log activity for bulk category change (AC22) 52ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should delete multiple documents 45ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should enforce multi-tenant isolation 46ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should log activity for bulk delete (AC22) 37ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Bulk Operations (Integration) > Transaction Safety (AC23) > should rollback on partial failure - bulkMove 33ms
 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Router Structure > should export all expected procedures 24ms
stdout | __tests__/routers/documents.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/documents.test.ts > app/server/routers/documents.ts (Integration) > Router Structure > should have 16 procedures total 21ms
stdout | __tests__/performance/staff-statistics.perf.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests
â³ Creating 100 test staff members...

stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests
âœ“ Performance test setup complete: 100 staff, 1 department, tenant 554fcf33-99bc-440e-8844-e812f5652f2d

stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle 100 staff utilization calculation in < 2 seconds

ðŸ“Š Staff Utilization Performance:
   Staff count: 101
   Average utilization: 97%
   Overallocated: 44
   Underutilized: 1
   Execution time: 0.018s
   Avg per staff: 0.000s
   Status: âœ… PASS (requirement: <2s)


stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle 52-week trend calculation in < 1 second
â³ Creating 52 weeks of time entry data...

stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle 52-week trend calculation in < 1 second

ðŸ“ˆ 52-Week Trend Performance:
   Weeks calculated: 52
   Staff capacity: 35 hrs/week
   Total hours logged: 1656.0
   Execution time: 0.061s
   Avg per week: 0.0012s
   Status: âœ… PASS (requirement: <1s)


 âœ“ __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle 100 staff utilization calculation in < 2 seconds 23ms
stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle department utilization aggregation in < 1 second
â³ Creating 5 departments with 20 staff each...

 âœ“ __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle 52-week trend calculation in < 1 second 145ms
stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle department utilization aggregation in < 1 second

ðŸ¢ Department Aggregation Performance:
   Departments: 6
   Total staff across all departments: 200
   Execution time: 0.010s
   Avg per department: 0.002s
   Status: âœ… PASS (requirement: <1s)


stdout | __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle staff comparison with sorting in < 500ms

ðŸ”„ Staff Comparison Sorting Performance:
   Staff sorted: 201
   Execution time: 0.017s
   Status: âœ… PASS (requirement: <500ms)


 âœ“ __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle department utilization aggregation in < 1 second 782ms
 âœ“ __tests__/performance/staff-statistics.perf.test.ts > Staff Statistics Performance Tests > should handle staff comparison with sorting in < 500ms 24ms
stdout | __tests__/performance/staff-statistics.perf.test.ts
âœ… Test teardown complete

stdout | __tests__/routers/compliance.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > create (Integration) > should create compliance item and persist to database 116ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > create (Integration) > should create compliance with optional fields 58ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > create (Integration) > should create activity log for compliance creation 44ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > create (Integration) > should default assignedToId to current user if not provided 56ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > create (Integration) > should validate required fields 33ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should list compliance items with tenant isolation 46ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter compliance by search term 49ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter compliance by type 49ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter compliance by status 42ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter compliance by clientId 49ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter compliance by assigneeId 65ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > list (Integration) > should filter overdue compliance items 43ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getById (Integration) > should retrieve compliance item by ID 47ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 29ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 65ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should update compliance item and persist changes 54ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should set completedDate when status changes to completed 24ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should create activity log for update 39ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent compliance item 20ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should prevent cross-tenant update 40ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > update (Integration) > should allow partial updates 42ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > delete (Integration) > should delete compliance item from database 33ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > delete (Integration) > should create activity log for deletion 47ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent compliance item 23ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 49ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should update status and persist changes 48ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should set completedDate when status changes to completed 51ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should create activity log for status update 34ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should throw NOT_FOUND for non-existent compliance item 23ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should prevent cross-tenant status update 49ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > updateStatus (Integration) > should accept all valid status values 94ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should return upcoming deadlines within default 30 days 45ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should return empty array when no deadlines exist 23ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should filter by custom days parameter 41ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should enforce tenant isolation 65ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should include client information via join 37ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should order results by dueDate ascending 44ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should exclude past deadlines 45ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should exclude deadlines beyond date range 41ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > getUpcoming (Integration) > should return correct deadline properties 32ms
stdout | __tests__/routers/compliance.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > Router Structure > should export all expected procedures 16ms
 âœ“ __tests__/routers/compliance.test.ts > app/server/routers/compliance.ts (Integration) > Router Structure > should have 7 procedures total 16ms
stdout | __tests__/routers/departments.test.ts
ðŸ§ª Test setup initialized

stderr | __tests__/routers/departments.test.ts > departments router > list > should list departments for the current tenant
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > list > should list departments for the current tenant 87ms
stderr | __tests__/routers/departments.test.ts > departments router > list > should include staff counts for each department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > list > should only show active departments by default
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > list > should include staff counts for each department 65ms
stderr | __tests__/routers/departments.test.ts > departments router > list > should include inactive departments when requested
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > list > should only show active departments by default 83ms
 âœ“ __tests__/routers/departments.test.ts > departments router > list > should include inactive departments when requested 91ms
stderr | __tests__/routers/departments.test.ts > departments router > list > should NOT return departments from other tenants
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > getById > should get a department by ID
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > list > should NOT return departments from other tenants 58ms
stderr | __tests__/routers/departments.test.ts > departments router > getById > should throw NOT_FOUND for non-existent department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > getById > should get a department by ID 88ms
 âœ“ __tests__/routers/departments.test.ts > departments router > getById > should throw NOT_FOUND for non-existent department 82ms
stderr | __tests__/routers/departments.test.ts > departments router > getById > should throw NOT_FOUND when accessing another tenant's department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > getById > should throw NOT_FOUND when accessing another tenant's department 86ms
stderr | __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should get all staff in a department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should throw NOT_FOUND for non-existent department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should get all staff in a department 79ms
 âœ“ __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should throw NOT_FOUND for non-existent department 52ms
stderr | __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should throw NOT_FOUND when accessing another tenant's department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > create > should allow admin to create a department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > getStaffByDepartment > should throw NOT_FOUND when accessing another tenant's department 46ms
 âœ“ __tests__/routers/departments.test.ts > departments router > create > should allow admin to create a department 69ms
stderr | __tests__/routers/departments.test.ts > departments router > create > should allow creating department without manager
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > create > should reject non-admin users
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > create > should allow creating department without manager 56ms
stderr | __tests__/routers/departments.test.ts > departments router > create > should reject invalid manager from different tenant
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > create > should reject non-admin users 67ms
 âœ“ __tests__/routers/departments.test.ts > departments router > create > should reject invalid manager from different tenant 81ms
stderr | __tests__/routers/departments.test.ts > departments router > create > should reject manager with member role
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > create > should reject manager with member role 68ms
stderr | __tests__/routers/departments.test.ts > departments router > update > should allow admin to update a department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > update > should allow updating manager
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > update > should allow admin to update a department 79ms
stderr | __tests__/routers/departments.test.ts > departments router > update > should allow removing manager by setting to null
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > update > should allow updating manager 86ms
 âœ“ __tests__/routers/departments.test.ts > departments router > update > should allow removing manager by setting to null 68ms
stderr | __tests__/routers/departments.test.ts > departments router > update > should reject non-admin users
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > update > should throw NOT_FOUND when updating another tenant's department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6,7db1be44-5236-480a-9076-c5ab861635ad,bf7ecbfc-9bc7-4c7c-970b-8d5909162c69,14911155-f756-4ebe-b5ab-c63f599df8ec,afccde8a-c22b-4915-b87e-3d964ccdfecc
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m,
    [32m'7db1be44-5236-480a-9076-c5ab861635ad'[39m,
    [32m'bf7ecbfc-9bc7-4c7c-970b-8d5909162c69'[39m,
    [32m'14911155-f756-4ebe-b5ab-c63f599df8ec'[39m,
    [32m'afccde8a-c22b-4915-b87e-3d964ccdfecc'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > update > should reject non-admin users 53ms
 âœ“ __tests__/routers/departments.test.ts > departments router > update > should throw NOT_FOUND when updating another tenant's department 58ms
stderr | __tests__/routers/departments.test.ts > departments router > delete > should allow admin to soft delete a department with no staff
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6,7db1be44-5236-480a-9076-c5ab861635ad,bf7ecbfc-9bc7-4c7c-970b-8d5909162c69,14911155-f756-4ebe-b5ab-c63f599df8ec,afccde8a-c22b-4915-b87e-3d964ccdfecc,886f79b3-4df8-4e67-974a-aad536af9d57,46682935-d02a-4b5c-ac16-816f4f53dc9a,e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0,51ec25d8-91d7-4876-8af7-1abe0dc803cb
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m,
    [32m'7db1be44-5236-480a-9076-c5ab861635ad'[39m,
    [32m'bf7ecbfc-9bc7-4c7c-970b-8d5909162c69'[39m,
    [32m'14911155-f756-4ebe-b5ab-c63f599df8ec'[39m,
    [32m'afccde8a-c22b-4915-b87e-3d964ccdfecc'[39m,
    [32m'886f79b3-4df8-4e67-974a-aad536af9d57'[39m,
    [32m'46682935-d02a-4b5c-ac16-816f4f53dc9a'[39m,
    [32m'e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0'[39m,
    [32m'51ec25d8-91d7-4876-8af7-1abe0dc803cb'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stderr | __tests__/routers/departments.test.ts > departments router > delete > should reject deletion if department has active staff
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6,7db1be44-5236-480a-9076-c5ab861635ad,bf7ecbfc-9bc7-4c7c-970b-8d5909162c69,14911155-f756-4ebe-b5ab-c63f599df8ec,afccde8a-c22b-4915-b87e-3d964ccdfecc,886f79b3-4df8-4e67-974a-aad536af9d57,46682935-d02a-4b5c-ac16-816f4f53dc9a,e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0,51ec25d8-91d7-4876-8af7-1abe0dc803cb,3d333d58-b681-48ce-a92b-f01a2534b12f,02211f8b-1d7c-47f1-914e-10250d8ee07a,20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec,f1086eaf-1a1b-4851-b77d-e6be5b922dd9
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m,
    [32m'7db1be44-5236-480a-9076-c5ab861635ad'[39m,
    [32m'bf7ecbfc-9bc7-4c7c-970b-8d5909162c69'[39m,
    [32m'14911155-f756-4ebe-b5ab-c63f599df8ec'[39m,
    [32m'afccde8a-c22b-4915-b87e-3d964ccdfecc'[39m,
    [32m'886f79b3-4df8-4e67-974a-aad536af9d57'[39m,
    [32m'46682935-d02a-4b5c-ac16-816f4f53dc9a'[39m,
    [32m'e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0'[39m,
    [32m'51ec25d8-91d7-4876-8af7-1abe0dc803cb'[39m,
    [32m'3d333d58-b681-48ce-a92b-f01a2534b12f'[39m,
    [32m'02211f8b-1d7c-47f1-914e-10250d8ee07a'[39m,
    [32m'20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec'[39m,
    [32m'f1086eaf-1a1b-4851-b77d-e6be5b922dd9'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > delete > should allow admin to soft delete a department with no staff 86ms
stderr | __tests__/routers/departments.test.ts > departments router > delete > should reject non-admin users
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92, $93, $94, $95, $96)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6,7db1be44-5236-480a-9076-c5ab861635ad,bf7ecbfc-9bc7-4c7c-970b-8d5909162c69,14911155-f756-4ebe-b5ab-c63f599df8ec,afccde8a-c22b-4915-b87e-3d964ccdfecc,886f79b3-4df8-4e67-974a-aad536af9d57,46682935-d02a-4b5c-ac16-816f4f53dc9a,e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0,51ec25d8-91d7-4876-8af7-1abe0dc803cb,3d333d58-b681-48ce-a92b-f01a2534b12f,02211f8b-1d7c-47f1-914e-10250d8ee07a,20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec,f1086eaf-1a1b-4851-b77d-e6be5b922dd9,146626cf-f48d-41b0-bb98-69e0454f5322,6d6dc113-3aa2-40a2-a626-63ae94b61d49,69620cdd-2ed1-4c3b-aebc-54021c33adc4,05309e0d-e49f-4c03-906a-4e0daf39976d
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92, $93, $94, $95, $96)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m,
    [32m'7db1be44-5236-480a-9076-c5ab861635ad'[39m,
    [32m'bf7ecbfc-9bc7-4c7c-970b-8d5909162c69'[39m,
    [32m'14911155-f756-4ebe-b5ab-c63f599df8ec'[39m,
    [32m'afccde8a-c22b-4915-b87e-3d964ccdfecc'[39m,
    [32m'886f79b3-4df8-4e67-974a-aad536af9d57'[39m,
    [32m'46682935-d02a-4b5c-ac16-816f4f53dc9a'[39m,
    [32m'e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0'[39m,
    [32m'51ec25d8-91d7-4876-8af7-1abe0dc803cb'[39m,
    [32m'3d333d58-b681-48ce-a92b-f01a2534b12f'[39m,
    [32m'02211f8b-1d7c-47f1-914e-10250d8ee07a'[39m,
    [32m'20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec'[39m,
    [32m'f1086eaf-1a1b-4851-b77d-e6be5b922dd9'[39m,
    [32m'146626cf-f48d-41b0-bb98-69e0454f5322'[39m,
    [32m'6d6dc113-3aa2-40a2-a626-63ae94b61d49'[39m,
    [32m'69620cdd-2ed1-4c3b-aebc-54021c33adc4'[39m,
    [32m'05309e0d-e49f-4c03-906a-4e0daf39976d'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

 âœ“ __tests__/routers/departments.test.ts > departments router > delete > should reject deletion if department has active staff 56ms
 âœ“ __tests__/routers/departments.test.ts > departments router > delete > should reject non-admin users 81ms
stderr | __tests__/routers/departments.test.ts > departments router > delete > should throw NOT_FOUND when deleting another tenant's department
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92, $93, $94, $95, $96, $97, $98, $99, $100)
params: 9cee62fb-24d9-4dbc-b569-169246978d24,f5019f78-0c44-4a05-b0cb-93d4ecd28337,f23c95ee-70bb-4fb7-81ea-919831fbbcff,21d65dd2-1cac-45a1-9591-b29626320c0d,4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2,db7ecc66-a366-45c1-9440-8c68f11c1a99,55544f23-fbe6-4f56-bb23-b4e8a64e1a9b,054c37fb-1302-467a-8819-51f7122821ee,8f48b5bb-f554-4ca7-93d0-894ce0b41ec7,8a3e4776-dfba-4ffc-aa31-be1df80e8f25,7e9a301f-5604-4011-a472-711f9c991654,80d91ca8-0bb6-488c-b573-1e307a39e7ae,45e08d5f-1479-4b81-8870-443d01e4c556,33c3bd39-d386-4384-828e-c5a84f0a2c81,f488b73f-ba98-48ff-929f-cadbb142a2df,62305910-57b8-4a5b-8a13-292ad2969876,069efed6-ad99-4e94-a633-38168f349350,dc0c9fb7-8031-4954-b41d-299629db49f3,395a8397-3f3a-429c-84ae-d93d2488f417,13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4,614d9ee2-725e-4ea7-9fae-28ac96831cdf,40a3df31-d078-4b5d-be7b-8f319601cffb,bd42bff2-0689-46e4-b9c6-882615af63c2,12508958-35f9-4f1d-af8b-2b24a0daa3dc,3c45c5fc-188d-41e0-afd3-45d2864fec8f,fbca033d-9d90-4f63-9168-84a1948f0688,0717d817-eb5f-40fb-8e4c-8161476bde62,f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8,1cafbbd7-afb9-4e2c-af87-1e004b59db4b,8beedc11-40ab-4a1b-9891-b5b2002f23cb,b0c5d318-996f-451b-a81c-376ec8657f3c,90c9f949-3cef-4ef0-9842-df53c69dd21a,72aead0c-1c34-4ae9-b863-14af1da0a64d,569f53f9-5753-49e3-af3f-0b59cfaceadc,5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7,e5fd919c-2a05-4776-8b76-c0c9c6bc6f08,b10a98a0-e44e-41d8-9fa9-c8116441ad92,096ceb94-c37c-4ce5-b2b7-b4d9f5446302,efa21b38-3af8-4a69-bb86-6324bc3c582c,1abf25a2-01b9-4bee-9efa-56695669609d,76ae086d-540a-4185-9a5b-6f97304c26c6,76475a87-f12d-4576-b292-f93c6a8efd02,4b227ad4-22b9-45ae-beb3-554b856b8639,3870ccd5-dc43-4434-b6c4-c347171a2b51,45550cc6-7112-42f6-a3d9-8a4ce2053f2c,946fb122-083c-4695-8885-d40cc92bb2fb,fef2f422-f607-4717-b920-2cde68387d0c,ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e,e0af3d72-ebc4-40e0-bb84-5ac136463eca,9f9c4d81-2719-4f75-9746-920175d7ef5d,d69765ed-72c5-4fd9-8a41-b447fb2242c7,7441d539-9c66-4d0b-b5a5-d05267845cdf,1385c097-b6d6-42cb-93df-58c18ad1dc3f,ad16d057-cf46-40fe-a818-108dc54a4679,a65b67bb-ad82-4bfd-9f12-abb9e70775d4,b65d684d-265b-4429-9248-ddb23933f200,f17d0d05-88bc-47ba-bffa-9bc93fad8ff4,d7ca0c9f-7af7-49b0-a38a-3e9680120f33,b36bc295-9830-4dc3-9356-49c16d3be890,1a2dfce2-5b72-4ee7-bea9-68f7574b460d,bf6d0e95-32cf-44db-a990-0097d8f90adb,32774306-657f-4cde-b487-888b7efa3ddb,4a344900-7f51-49d6-8cee-c4914d5c168e,1aa7ad27-997f-4539-90f5-8587d1a3bb7f,9e2a12a6-bae4-4f70-b72b-78f27d912e0c,a2786d0d-726e-4d7b-8cdb-cb1de93f3682,2f6140f8-b0a8-4645-9064-c6ac27ef7248,43165ecd-f1ad-4396-8ac6-141c2e55f05c,336f2914-f435-480a-a3b8-3e5725a74b02,96284c91-bbf4-40e4-9b94-3cabd81debe6,7d9c9796-fdfb-4013-9b55-64648b79c9c1,89a22978-ea06-49f4-846e-e276ea773e16,18a989be-ef8e-42a3-91fe-20b80636d73c,b2655466-e6e5-4d2e-8550-4f5f416d4102,65b91de6-ef01-4fe5-bc02-699e7b77e60a,3771cf43-5cb8-4ea4-9b8a-32a83c4fefba,5a5cc755-ed0e-4202-93ed-360dd6a2e2e0,60e8f595-7126-43b2-b123-ad62473953e4,0c48d3e1-f9cb-4f42-a998-b40a77e21910,a548f1b5-64db-4732-b567-ccfabfe650e6,7db1be44-5236-480a-9076-c5ab861635ad,bf7ecbfc-9bc7-4c7c-970b-8d5909162c69,14911155-f756-4ebe-b5ab-c63f599df8ec,afccde8a-c22b-4915-b87e-3d964ccdfecc,886f79b3-4df8-4e67-974a-aad536af9d57,46682935-d02a-4b5c-ac16-816f4f53dc9a,e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0,51ec25d8-91d7-4876-8af7-1abe0dc803cb,3d333d58-b681-48ce-a92b-f01a2534b12f,02211f8b-1d7c-47f1-914e-10250d8ee07a,20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec,f1086eaf-1a1b-4851-b77d-e6be5b922dd9,146626cf-f48d-41b0-bb98-69e0454f5322,6d6dc113-3aa2-40a2-a626-63ae94b61d49,69620cdd-2ed1-4c3b-aebc-54021c33adc4,05309e0d-e49f-4c03-906a-4e0daf39976d,11a0d99a-6fb6-44cc-a520-26ac09f933a5,7f1c9160-08eb-4b09-8adc-e9efedd575bf,0b9c6cf3-f677-4e7d-af24-8c4bbf1a2326,28af0539-afd1-49e0-a414-995c7e0e645d
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
  query: [32m'delete from "users" where "users"."id" in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92, $93, $94, $95, $96, $97, $98, $99, $100)'[39m,
  params: [
    [32m'9cee62fb-24d9-4dbc-b569-169246978d24'[39m,
    [32m'f5019f78-0c44-4a05-b0cb-93d4ecd28337'[39m,
    [32m'f23c95ee-70bb-4fb7-81ea-919831fbbcff'[39m,
    [32m'21d65dd2-1cac-45a1-9591-b29626320c0d'[39m,
    [32m'4fd1a7a1-58a5-4957-9ae7-ecdbf827e8e2'[39m,
    [32m'db7ecc66-a366-45c1-9440-8c68f11c1a99'[39m,
    [32m'55544f23-fbe6-4f56-bb23-b4e8a64e1a9b'[39m,
    [32m'054c37fb-1302-467a-8819-51f7122821ee'[39m,
    [32m'8f48b5bb-f554-4ca7-93d0-894ce0b41ec7'[39m,
    [32m'8a3e4776-dfba-4ffc-aa31-be1df80e8f25'[39m,
    [32m'7e9a301f-5604-4011-a472-711f9c991654'[39m,
    [32m'80d91ca8-0bb6-488c-b573-1e307a39e7ae'[39m,
    [32m'45e08d5f-1479-4b81-8870-443d01e4c556'[39m,
    [32m'33c3bd39-d386-4384-828e-c5a84f0a2c81'[39m,
    [32m'f488b73f-ba98-48ff-929f-cadbb142a2df'[39m,
    [32m'62305910-57b8-4a5b-8a13-292ad2969876'[39m,
    [32m'069efed6-ad99-4e94-a633-38168f349350'[39m,
    [32m'dc0c9fb7-8031-4954-b41d-299629db49f3'[39m,
    [32m'395a8397-3f3a-429c-84ae-d93d2488f417'[39m,
    [32m'13be1954-4d7c-4bb2-b1ef-cb17a9b1e9d4'[39m,
    [32m'614d9ee2-725e-4ea7-9fae-28ac96831cdf'[39m,
    [32m'40a3df31-d078-4b5d-be7b-8f319601cffb'[39m,
    [32m'bd42bff2-0689-46e4-b9c6-882615af63c2'[39m,
    [32m'12508958-35f9-4f1d-af8b-2b24a0daa3dc'[39m,
    [32m'3c45c5fc-188d-41e0-afd3-45d2864fec8f'[39m,
    [32m'fbca033d-9d90-4f63-9168-84a1948f0688'[39m,
    [32m'0717d817-eb5f-40fb-8e4c-8161476bde62'[39m,
    [32m'f25ca6cc-f5ac-4a29-b016-ef0aac3da3c8'[39m,
    [32m'1cafbbd7-afb9-4e2c-af87-1e004b59db4b'[39m,
    [32m'8beedc11-40ab-4a1b-9891-b5b2002f23cb'[39m,
    [32m'b0c5d318-996f-451b-a81c-376ec8657f3c'[39m,
    [32m'90c9f949-3cef-4ef0-9842-df53c69dd21a'[39m,
    [32m'72aead0c-1c34-4ae9-b863-14af1da0a64d'[39m,
    [32m'569f53f9-5753-49e3-af3f-0b59cfaceadc'[39m,
    [32m'5aad95ec-b5ed-4eab-a83e-59bf54ea9ce7'[39m,
    [32m'e5fd919c-2a05-4776-8b76-c0c9c6bc6f08'[39m,
    [32m'b10a98a0-e44e-41d8-9fa9-c8116441ad92'[39m,
    [32m'096ceb94-c37c-4ce5-b2b7-b4d9f5446302'[39m,
    [32m'efa21b38-3af8-4a69-bb86-6324bc3c582c'[39m,
    [32m'1abf25a2-01b9-4bee-9efa-56695669609d'[39m,
    [32m'76ae086d-540a-4185-9a5b-6f97304c26c6'[39m,
    [32m'76475a87-f12d-4576-b292-f93c6a8efd02'[39m,
    [32m'4b227ad4-22b9-45ae-beb3-554b856b8639'[39m,
    [32m'3870ccd5-dc43-4434-b6c4-c347171a2b51'[39m,
    [32m'45550cc6-7112-42f6-a3d9-8a4ce2053f2c'[39m,
    [32m'946fb122-083c-4695-8885-d40cc92bb2fb'[39m,
    [32m'fef2f422-f607-4717-b920-2cde68387d0c'[39m,
    [32m'ca05eb76-f9c5-4d4b-90c0-ac52a779fb6e'[39m,
    [32m'e0af3d72-ebc4-40e0-bb84-5ac136463eca'[39m,
    [32m'9f9c4d81-2719-4f75-9746-920175d7ef5d'[39m,
    [32m'd69765ed-72c5-4fd9-8a41-b447fb2242c7'[39m,
    [32m'7441d539-9c66-4d0b-b5a5-d05267845cdf'[39m,
    [32m'1385c097-b6d6-42cb-93df-58c18ad1dc3f'[39m,
    [32m'ad16d057-cf46-40fe-a818-108dc54a4679'[39m,
    [32m'a65b67bb-ad82-4bfd-9f12-abb9e70775d4'[39m,
    [32m'b65d684d-265b-4429-9248-ddb23933f200'[39m,
    [32m'f17d0d05-88bc-47ba-bffa-9bc93fad8ff4'[39m,
    [32m'd7ca0c9f-7af7-49b0-a38a-3e9680120f33'[39m,
    [32m'b36bc295-9830-4dc3-9356-49c16d3be890'[39m,
    [32m'1a2dfce2-5b72-4ee7-bea9-68f7574b460d'[39m,
    [32m'bf6d0e95-32cf-44db-a990-0097d8f90adb'[39m,
    [32m'32774306-657f-4cde-b487-888b7efa3ddb'[39m,
    [32m'4a344900-7f51-49d6-8cee-c4914d5c168e'[39m,
    [32m'1aa7ad27-997f-4539-90f5-8587d1a3bb7f'[39m,
    [32m'9e2a12a6-bae4-4f70-b72b-78f27d912e0c'[39m,
    [32m'a2786d0d-726e-4d7b-8cdb-cb1de93f3682'[39m,
    [32m'2f6140f8-b0a8-4645-9064-c6ac27ef7248'[39m,
    [32m'43165ecd-f1ad-4396-8ac6-141c2e55f05c'[39m,
    [32m'336f2914-f435-480a-a3b8-3e5725a74b02'[39m,
    [32m'96284c91-bbf4-40e4-9b94-3cabd81debe6'[39m,
    [32m'7d9c9796-fdfb-4013-9b55-64648b79c9c1'[39m,
    [32m'89a22978-ea06-49f4-846e-e276ea773e16'[39m,
    [32m'18a989be-ef8e-42a3-91fe-20b80636d73c'[39m,
    [32m'b2655466-e6e5-4d2e-8550-4f5f416d4102'[39m,
    [32m'65b91de6-ef01-4fe5-bc02-699e7b77e60a'[39m,
    [32m'3771cf43-5cb8-4ea4-9b8a-32a83c4fefba'[39m,
    [32m'5a5cc755-ed0e-4202-93ed-360dd6a2e2e0'[39m,
    [32m'60e8f595-7126-43b2-b123-ad62473953e4'[39m,
    [32m'0c48d3e1-f9cb-4f42-a998-b40a77e21910'[39m,
    [32m'a548f1b5-64db-4732-b567-ccfabfe650e6'[39m,
    [32m'7db1be44-5236-480a-9076-c5ab861635ad'[39m,
    [32m'bf7ecbfc-9bc7-4c7c-970b-8d5909162c69'[39m,
    [32m'14911155-f756-4ebe-b5ab-c63f599df8ec'[39m,
    [32m'afccde8a-c22b-4915-b87e-3d964ccdfecc'[39m,
    [32m'886f79b3-4df8-4e67-974a-aad536af9d57'[39m,
    [32m'46682935-d02a-4b5c-ac16-816f4f53dc9a'[39m,
    [32m'e220d26e-88e8-4bc9-be4b-c58d5e7dd1d0'[39m,
    [32m'51ec25d8-91d7-4876-8af7-1abe0dc803cb'[39m,
    [32m'3d333d58-b681-48ce-a92b-f01a2534b12f'[39m,
    [32m'02211f8b-1d7c-47f1-914e-10250d8ee07a'[39m,
    [32m'20acfe6f-bd7b-42b1-9d84-fbbf8e2993ec'[39m,
    [32m'f1086eaf-1a1b-4851-b77d-e6be5b922dd9'[39m,
    [32m'146626cf-f48d-41b0-bb98-69e0454f5322'[39m,
    [32m'6d6dc113-3aa2-40a2-a626-63ae94b61d49'[39m,
    [32m'69620cdd-2ed1-4c3b-aebc-54021c33adc4'[39m,
    [32m'05309e0d-e49f-4c03-906a-4e0daf39976d'[39m,
    [32m'11a0d99a-6fb6-44cc-a520-26ac09f933a5'[39m,
    [32m'7f1c9160-08eb-4b09-8adc-e9efedd575bf'[39m,
    [32m'0b9c6cf3-f677-4e7d-af24-8c4bbf1a2326'[39m,
    [32m'28af0539-afd1-49e0-a414-995c7e0e645d'[39m
  ],
  cause: error: update or delete on table "users" violates foreign key constraint "departments_manager_id_users_id_fk" on table "departments"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/departments.test.ts:53:5 {
    length: [33m346[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (id)=(9cee62fb-24d9-4dbc-b569-169246978d24) is still referenced from table "departments".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'departments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'departments_manager_id_users_id_fk'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2621'[39m,
    routine: [32m'ri_ReportViolation'[39m
  }
}

stdout | __tests__/routers/departments.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/departments.test.ts > departments router > delete > should throw NOT_FOUND when deleting another tenant's department 63ms
stdout | __tests__/routers/task-generation.test.ts
ðŸ§ª Test setup initialized

stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should generate a task from template
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: 475cd883-1d45-4b30-9a1b-6a977b091082
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'475cd883-1d45-4b30-9a1b-6a977b091082'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m764[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (cde80c09-aeca-4dba-a296-57e048bb331d, b29fb2b4-8afe-4e44-87b6-299c29c1dec2, VAT QQ4 2025 - Test Client 1761765896924, Complete VAT for Test Client 1761765896924, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:56.962, 2025-11-22 19:24:56.962, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:57.044, null, 2025-10-29 19:24:57.04618, 2025-10-29 19:24:57.04618).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should generate a task from template 220ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should skip duplicate task (AC4)
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: 944228d3-e7b7-4842-9c96-6b1724c9d15c
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'944228d3-e7b7-4842-9c96-6b1724c9d15c'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m766[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (c35330d9-2b6f-4cc2-a3da-dc975eee09b8, c2c09bf0-ccff-44cd-afb9-cdb7fba31f5b, VAT QQ4 2025 - Test Client 1761765897140, Complete VAT for Test Client 1761765897140, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:57.156, 2025-11-22 19:24:57.156, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:57.161, null, 2025-10-29 19:24:57.162534, 2025-10-29 19:24:57.162534).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should skip duplicate task (AC4) 89ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should enforce tenant isolation 128ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should support custom activation date
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: afc36b4e-3266-4fb0-8f31-ee8c1dba74b9
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'afc36b4e-3266-4fb0-8f31-ee8c1dba74b9'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m758[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (d1fa3947-1b33-41fb-ade0-29bc527ed033, b7ce13db-5261-4045-9af9-5716032e5fb5, VAT QQ2 2025 - Test Client 1761765897400, Complete VAT for Test Client 1761765897400, pending, high, null, null, null, null, null, null, 2025-07-01 00:00:00, 2025-06-24 00:00:00, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:57.427, null, 2025-10-29 19:24:57.428291, 2025-10-29 19:24:57.428291).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should throw error for non-existent template 65ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateFromTemplate (AC1-AC7) > should support custom activation date 67ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > previewGeneration (AC8, AC9) > should preview tasks before generation 137ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > previewGeneration (AC8, AC9) > should return empty array when no templates exist 90ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > previewGeneration (AC8, AC9) > should enforce tenant isolation 72ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should generate tasks for multiple clients
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: 034cbedb-6ad7-4633-8422-09b788b93072
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'034cbedb-6ad7-4633-8422-09b788b93072'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m766[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (4e7c0c63-4829-4e02-a9d9-5286dcd9ccc6, 092252ed-bb5a-4a56-bca4-d9aa7e76fb4d, VAT QQ4 2025 - Test Client 1761765897769, Complete VAT for Test Client 1761765897769, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:57.799, 2025-11-22 19:24:57.799, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:57.802, null, 2025-10-29 19:24:57.793113, 2025-10-29 19:24:57.793113).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should generate tasks for multiple clients 77ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should generate tasks for all service clients when no clientIds provided
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: be53d735-b433-4b5a-b05a-f9a0dd666b8c
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'be53d735-b433-4b5a-b05a-f9a0dd666b8c'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m764[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (1343efbc-2777-4f94-b32b-d1229922bde4, a85dfc56-7b17-40dc-993f-5af16b6172ef, VAT QQ4 2025 - Test Client 1761765897871, Complete VAT for Test Client 1761765897871, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:57.896, 2025-11-22 19:24:57.896, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:57.9, null, 2025-10-29 19:24:57.890448, 2025-10-29 19:24:57.890448).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should generate tasks for all service clients when no clientIds provided 128ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should skip existing tasks in bulk generation
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: 4b22af74-0eb6-4bb5-8cdc-844c5c4eb19e
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'4b22af74-0eb6-4bb5-8cdc-844c5c4eb19e'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m764[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (91e0ca28-47be-46d9-8e96-3b296f40b814, 57587007-1f9a-49be-ae3b-af5e1fa87f2e, VAT QQ4 2025 - Test Client 1761765898130, Complete VAT for Test Client 1761765898130, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:58.146, 2025-11-22 19:24:58.146, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:58.148, null, 2025-10-29 19:24:58.14963, 2025-10-29 19:24:58.14963).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should rollback transaction on error (AC19) 159ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should skip existing tasks in bulk generation 64ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateRecurringTasks (AC5) > should generate multiple periods for recurring templates
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: d4ea63f1-b4f9-4e59-940e-e1933ce00064
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'd4ea63f1-b4f9-4e59-940e-e1933ce00064'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m764[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (1916102b-14bd-4161-9e07-2430b8bd23f1, 529aea45-f28b-4263-bbbd-a3e9f0eb1c4c, VAT QQ4 2025 - Test Client 1761765898361, Complete VAT for Test Client 1761765898361, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:58.38, 2025-11-22 19:24:58.38, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:58.382, null, 2025-10-29 19:24:58.383372, 2025-10-29 19:24:58.383372).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > bulkGenerateForService (AC10, AC19) > should enforce tenant isolation in bulk generation 162ms
 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateRecurringTasks (AC5) > should generate multiple periods for recurring templates 63ms
stderr | __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateRecurringTasks (AC5) > should skip duplicate periods in recurring generation
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: c09be0c6-a60c-4513-89ed-2f861af721ed
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'c09be0c6-a60c-4513-89ed-2f861af721ed'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/routers/task-generation.test.ts:125:5 {
    length: [33m762[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (972c25e9-d517-4626-bba3-7dda160ae56a, 2cf403e9-b189-4e11-90d9-efc6f250a65d, VAT QQ4 2025 - Test Client 1761765898441, Complete VAT for Test Client 1761765898441, pending, high, null, null, null, null, null, null, 2025-11-29 19:24:58.458, 2025-11-22 19:24:58.458, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:24:58.462, null, 2025-10-29 19:24:58.4631, 2025-10-29 19:24:58.4631).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateRecurringTasks (AC5) > should skip duplicate periods in recurring generation 134ms
stdout | __tests__/routers/task-generation.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/task-generation.test.ts > app/server/routers/task-generation.ts (Integration) > generateRecurringTasks (AC5) > should throw error for non-recurring template 146ms
stdout | __tests__/routers/workflows.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > create (Integration) > should create workflow and persist to database 122ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > create (Integration) > should create workflow with stages 54ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > create (Integration) > should create initial version snapshot 49ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > create (Integration) > should validate required fields 35ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > list (Integration) > should list workflows with tenant isolation 32ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > list (Integration) > should filter workflows by isActive status 50ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > list (Integration) > should return stage count for each workflow 41ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getById (Integration) > should retrieve workflow with stages 37ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 16ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 37ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > update (Integration) > should update workflow and increment version 50ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > update (Integration) > should create new version snapshot on update 47ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > update (Integration) > should update stages when provided 34ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent workflow 19ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > update (Integration) > should prevent cross-tenant update 37ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > delete (Integration) > should delete workflow from database 28ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > delete (Integration) > should prevent deletion if workflow is in use by tasks 64ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent workflow 17ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 21ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > toggleActive (Integration) > should toggle workflow active status 20ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > toggleActive (Integration) > should throw NOT_FOUND for non-existent workflow 22ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > toggleActive (Integration) > should prevent cross-tenant toggle 37ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > listVersions (Integration) > should list all versions for a workflow 39ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > listVersions (Integration) > should enforce tenant isolation for version listing 44ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > publishVersion (Integration) > should publish a version and make it active 44ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > publishVersion (Integration) > should deactivate other versions when publishing 58ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > compareVersions (Integration) > should compare two versions and show differences 97ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > compareVersions (Integration) > should throw NOT_FOUND for non-existent versions 48ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getActiveInstances (Integration) > should retrieve active workflow instances for a workflow 85ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getActiveInstances (Integration) > should return empty array if no active instances 36ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getActiveInstances (Integration) > should only return active instances, not completed 49ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > getActiveInstances (Integration) > should prevent cross-tenant access 34ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > migrateInstances (Integration) > should migrate instances to new workflow version 77ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > migrateInstances (Integration) > should throw NOT_FOUND for non-existent version 63ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > migrateInstances (Integration) > should handle multiple instances 63ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > rollbackToVersion (Integration) > should create new version based on previous version 40ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > rollbackToVersion (Integration) > should throw NOT_FOUND for non-existent workflow 18ms
stdout | __tests__/routers/workflows.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > rollbackToVersion (Integration) > should throw NOT_FOUND for non-existent target version 36ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > rollbackToVersion (Integration) > should prevent cross-tenant rollback 42ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > Router Structure > should export all expected procedures 20ms
 âœ“ __tests__/routers/workflows.test.ts > app/server/routers/workflows.ts (Integration) > Router Structure > should have 12 procedures total 22ms
stdout | __tests__/routers/clients.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > create (Integration) > should create client and persist to database 111ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > create (Integration) > should create client with primary contact 42ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > create (Integration) > should create activity log for client creation 41ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > create (Integration) > should validate required fields 33ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > create (Integration) > should validate primary contact email format 23ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > list (Integration) > should list clients with tenant isolation 46ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > list (Integration) > should filter clients by search term 36ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > list (Integration) > should filter clients by type 43ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > list (Integration) > should filter clients by status 38ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getById (Integration) > should retrieve client by ID 27ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 15ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 53ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > update (Integration) > should update client and persist changes 46ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > update (Integration) > should create activity log for update 41ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent client 26ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > update (Integration) > should prevent cross-tenant update 47ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > update (Integration) > should allow partial updates 37ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > delete (Integration) > should archive client (soft delete) 36ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > delete (Integration) > should create activity log for archiving 39ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent client 21ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 36ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getClientServices (Integration) > should retrieve client services 28ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getClientServices (Integration) > should enforce tenant isolation (returns empty for other tenant's client) 37ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getClientContacts (Integration) > should retrieve client contacts 27ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getClientDirectors (Integration) > should retrieve client directors 30ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > getClientPSCs (Integration) > should retrieve client PSCs (Persons with Significant Control) 27ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > validateVAT (Integration) > should validate VAT number without updating database when clientId not provided 18ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > validateVAT (Integration) > should validate VAT number and update database when clientId provided 33ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > validateVAT (Integration) > should enforce multi-tenant isolation (cannot update client from different tenant) 58ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > validateVAT (Integration) > should handle invalid VAT number gracefully 35ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > validateVAT (Integration) > should log activity when validating VAT number 43ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should update status for multiple clients 46ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should enforce multi-tenant isolation 61ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkUpdateStatus > should log activity for bulk status update (AC22) 49ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkAssignManager > should assign manager to multiple clients 65ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkAssignManager > should enforce multi-tenant isolation 40ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkAssignManager > should log activity for bulk manager assignment (AC22) 51ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should delete multiple clients 31ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should enforce multi-tenant isolation 48ms
stdout | __tests__/routers/clients.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > bulkDelete > should log activity for bulk delete (AC22) 42ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Bulk Operations (Integration) > Transaction Safety (AC23) > should rollback on partial failure - bulkUpdateStatus 30ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Router Structure > should export all expected procedures 20ms
 âœ“ __tests__/routers/clients.test.ts > app/server/routers/clients.ts (Integration) > Router Structure > should have 11 procedures total 17ms
stdout | __tests__/routers/timesheets.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > create (Integration) > should create time entry and persist to database 134ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > create (Integration) > should create time entry with optional fields 49ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > create (Integration) > should create activity log for time entry creation 57ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > create (Integration) > should validate required fields 34ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > list (Integration) > should list time entries with tenant isolation 62ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > list (Integration) > should filter time entries by date range 51ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > list (Integration) > should filter time entries by user 39ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > list (Integration) > should filter time entries by client 56ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > list (Integration) > should filter time entries by billable status 33ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getById (Integration) > should retrieve time entry by ID 38ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 23ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 54ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > update (Integration) > should update time entry and persist changes 47ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > update (Integration) > should create activity log for update 37ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent time entry 32ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > update (Integration) > should prevent cross-tenant update 43ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > update (Integration) > should allow partial updates 48ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > delete (Integration) > should delete time entry 39ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > delete (Integration) > should create activity log for deletion 49ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent time entry 32ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 58ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > summary (Integration) > should calculate summary statistics correctly 54ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > summary (Integration) > should filter summary by user 32ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > summary (Integration) > should respect tenant isolation in summary 57ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > summary (Integration) > should validate required date fields 31ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getWeek (Integration) > should return time entries for specified week 47ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getWeek (Integration) > should enforce tenant isolation when querying week 49ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > copyPreviousWeek (Integration) > should copy entries from previous week with adjusted dates 53ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > copyPreviousWeek (Integration) > should return zero entries copied when previous week is empty 25ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getWeeklySummary (Integration) > should calculate total hours and billable percentage 60ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > getWeeklySummary (Integration) > should handle empty week with zero hours 20ms
stdout | __tests__/routers/timesheets.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > Router Structure > should export all expected procedures 26ms
 âœ“ __tests__/routers/timesheets.test.ts > app/server/routers/timesheets.ts (Integration) > Router Structure > should have 16 procedures total 26ms
stdout | __tests__/routers/services.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > create (Integration) > should create service and persist to database 98ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > create (Integration) > should create service with optional fields 36ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > create (Integration) > should create service with isActive defaulting to true 39ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > create (Integration) > should create activity log for service creation 49ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > create (Integration) > should validate required fields 30ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should list services with tenant isolation 54ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should filter services by search term (name) 53ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should filter services by search term (code) 30ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should filter services by category 48ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should filter services by isActive status 39ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > list (Integration) > should handle multiple filters simultaneously 26ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > getById (Integration) > should retrieve service by ID 34ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > getById (Integration) > should throw NOT_FOUND for non-existent ID 24ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > getById (Integration) > should prevent cross-tenant access (CRITICAL) 55ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should update service and persist changes 56ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should create activity log for update 35ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should throw NOT_FOUND for non-existent service 23ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should prevent cross-tenant update 38ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should allow partial updates 44ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > update (Integration) > should update service pricing type and rate 36ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > delete (Integration) > should soft delete service (mark as inactive) 51ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > delete (Integration) > should create activity log for deactivation 51ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > delete (Integration) > should throw NOT_FOUND for non-existent service 19ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > delete (Integration) > should prevent cross-tenant deletion 35ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > delete (Integration) > should allow re-deactivation of already inactive service 35ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Service Pricing Logic (Integration) > should handle fixed pricing type 30ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Service Pricing Logic (Integration) > should handle hourly pricing type with rate and duration 38ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Service Pricing Logic (Integration) > should handle service with tags for categorization 40ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Service Pricing Logic (Integration) > should handle service with custom metadata 34ms
 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Router Structure > should export all expected procedures 16ms
stdout | __tests__/routers/services.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/services.test.ts > app/server/routers/services.ts (Integration) > Router Structure > should have 5 procedures total 21ms
stdout | __tests__/lib/email/workflow-triggers.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > detectStageCompletion > should detect stage completion when all checklist items completed 190ms
 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > detectStageCompletion > should not detect completion when checklist items incomplete 61ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 30: should trigger workflow email rule and queue email when stage completes
[Workflow Email] Queued email for workflow 3d099048-cb60-42e5-875a-dd8d360b0480 stage d935090a-44bc-4417-b612-2df1d8a6dd67 to staff-1761765905859@test.com (send at: 2025-10-29T19:25:05.907Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > detectStageCompletion > should detect completion for stage with no checklist items 78ms
 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 30: should trigger workflow email rule and queue email when stage completes 107ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 31: should trigger multiple rules per stage (3 rules = 3 emails queued)
[Workflow Email] Queued email for workflow cf23a930-37e4-4634-9273-4c5a7153412b stage b503b37f-9359-45a9-a321-a79832f57910 to staff-1761765905967@test.com (send at: 2025-10-29T19:25:06.018Z)

stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 31: should trigger multiple rules per stage (3 rules = 3 emails queued)
[Workflow Email] Queued email for workflow cf23a930-37e4-4634-9273-4c5a7153412b stage b503b37f-9359-45a9-a321-a79832f57910 to client-1761765905973@test.com (send at: 2025-10-29T19:25:06.031Z)

stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 31: should trigger multiple rules per stage (3 rules = 3 emails queued)
[Workflow Email] Queued email for workflow cf23a930-37e4-4634-9273-4c5a7153412b stage b503b37f-9359-45a9-a321-a79832f57910 to custom@example.com (send at: 2025-10-29T19:25:06.042Z)

stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 32: should match both stage-specific rules AND any-stage rules (stageId IS NULL)
[Workflow Email] Queued email for workflow 712e6122-e0fa-4375-b2bb-b6a278c20951 stage 9f97790e-6b37-4181-a0cd-b3d069c6098d to staff-1761765906085@test.com (send at: 2025-10-29T19:25:06.134Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 31: should trigger multiple rules per stage (3 rules = 3 emails queued) 119ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 32: should match both stage-specific rules AND any-stage rules (stageId IS NULL)
[Workflow Email] Queued email for workflow 712e6122-e0fa-4375-b2bb-b6a278c20951 stage 9f97790e-6b37-4181-a0cd-b3d069c6098d to anystage@example.com (send at: 2025-10-29T19:25:06.152Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 32: should match both stage-specific rules AND any-stage rules (stageId IS NULL) 135ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 33: should populate all 7 template variables from workflow/client/staff data
[Workflow Email] Queued email for workflow 841fbf98-1e33-4095-b77c-3e6edebc4149 stage 26051aee-c85c-446d-99d3-b787eeeccf1f to test@example.com (send at: 2025-10-29T19:25:06.280Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 33: should populate all 7 template variables from workflow/client/staff data 104ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > should respect sendDelayHours and schedule email for future
[Workflow Email] Queued email for workflow cf6da18a-cb5f-46fd-8e3c-046ad9652524 stage 900376e0-9dd1-4c80-8188-9c41b5b7158b to staff-1761765906405@test.com (send at: 2025-10-29T21:25:06.459Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > Test 34: should not queue emails when no rules match the stage (no errors) 80ms
stdout | __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > should handle client_manager recipient type correctly
[Workflow Email] Queued email for workflow e852aa68-15f5-45c9-b036-45b375db929f stage fea18528-2746-45da-a2e5-a474ed482c14 to staff-1761765906497@test.com (send at: 2025-10-29T19:25:06.544Z)

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > should respect sendDelayHours and schedule email for future 93ms
stdout | __tests__/lib/email/workflow-triggers.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > should handle client_manager recipient type correctly 82ms
 âœ“ __tests__/lib/email/workflow-triggers.test.ts > Workflow Email Triggers > triggerWorkflowEmails > should not trigger emails for inactive rules 77ms
stdout | __tests__/performance/task-generation.perf.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests
âœ“ Performance test setup complete: 50 clients, 1 template, tenant 12a7274b-968c-42d3-9b2f-0d230a420f19

stdout | __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests > AC18: should generate 50 tasks in < 5 seconds

ðŸ“Š Performance Test Results:
   Clients processed: 50
   Tasks generated: 50
   Tasks skipped: 0
   Execution time: 0.517s
   Avg per task: 0.010s
   Status: âœ… PASS (requirement: <5s)


stdout | __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests > should handle performance with transaction rollback on error

ðŸ”„ Transaction Rollback Performance:
   Execution time: 0.052s
   Status: âœ… Fast rollback


 âœ“ __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests > AC18: should generate 50 tasks in < 5 seconds 527ms
 âœ“ __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests > should handle performance with transaction rollback on error 59ms
stderr | __tests__/performance/task-generation.perf.test.ts > Task Generation Performance Tests
Test cleanup error: DrizzleQueryError: Failed query: delete from "users" where "users"."id" in ($1)
params: b6f26652-f058-4ba7-964b-45a281de4817
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/performance/task-generation.perf.test.ts:137:5 {
  query: [32m'delete from "users" where "users"."id" in ($1)'[39m,
  params: [ [32m'b6f26652-f058-4ba7-964b-45a281de4817'[39m ],
  cause: error: null value in column "created_by_id" of relation "tasks" violates not-null constraint
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:373:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/performance/task-generation.perf.test.ts:137:5 {
    length: [33m780[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23502'[39m,
    detail: [32m'Failing row contains (f329d3e6-0b73-4cd6-9acb-1393791905e7, 12a7274b-968c-42d3-9b2f-0d230a420f19, VAT Return QQ4 2025 - Performance Test Client 3, Complete VAT return for Performance Test Client 3, pending, high, null, null, null, null, null, null, 2025-12-06 19:25:07.133, 2025-11-29 19:25:07.133, null, 2.00, null, 0, compliance, null, null, null, null, f, null, null, null, null, t, null, 2025-10-29 19:25:07.141, null, 2025-10-29 19:25:07.083874, 2025-10-29 19:25:07.083874).'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m'SQL statement "UPDATE ONLY "public"."tasks" SET "created_by_id" = NULL WHERE $1 OPERATOR(pg_catalog.=) "created_by_id""'[39m,
    schema: [32m'public'[39m,
    table: [32m'tasks'[39m,
    column: [32m'created_by_id'[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'execMain.c'[39m,
    line: [32m'2005'[39m,
    routine: [32m'ExecConstraints'[39m
  }
}

stdout | __tests__/performance/task-generation.perf.test.ts
âœ… Test teardown complete

stdout | __tests__/routers/companies-house.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Basic Functionality > should successfully lookup company and return data 142ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Basic Functionality > should validate company number format (8 digits) 37ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Basic Functionality > should throw error for invalid company number format 35ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Cache Scenarios > should return cached data on second lookup (cache hit) 50ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Cache Scenarios > should bypass cache and call API after cache expires 50ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Cache Scenarios > should complete cached lookup in under 100ms (AC #19 performance requirement) 55ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Rate Limiting > should return cached data when rate limit exceeded 45ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Rate Limiting > should throw error when rate limited and no cache available 37ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Activity Logging > should log lookup activity in activityLogs table 49ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Activity Logging > should include tenantId and userId in activity log 41ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Tenant Isolation > should isolate cache entries by company number (no tenantId needed) 48ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Tenant Isolation > should use global rate limiting (not per-tenant) 42ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Error Handling > should throw NOT_FOUND for 404 errors 32ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Error Handling > should throw TOO_MANY_REQUESTS for 429 errors 24ms
stdout | __tests__/routers/companies-house.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Error Handling > should throw INTERNAL_SERVER_ERROR for API server errors 42ms
 âœ“ __tests__/routers/companies-house.test.ts > app/server/routers/clients.ts - lookupCompaniesHouse (Integration) > Error Handling > should throw INTERNAL_SERVER_ERROR for network errors 39ms
stdout | __tests__/spike/transaction-isolation.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 1: Basic Transaction Support > should support db.transaction() wrapper 89ms
 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 1: Basic Transaction Support > should allow database operations within transaction 33ms
 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 2: Transaction Rollback (CRITICAL) > should rollback transaction when error is thrown 23ms
 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 2: Transaction Rollback (CRITICAL) > should rollback transaction with explicit rollback call 29ms
 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 3: Integration with tRPC Router Procedures > should work with tRPC router.createCaller pattern 90ms
stdout | __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 4: Performance Measurement > should measure transaction overhead

ðŸ“Š Performance Results:
Without transaction: 336ms
With transaction: 169ms
Overhead: -167ms (-49.7%)

stdout | __tests__/spike/transaction-isolation.test.ts
âœ… Test teardown complete

 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 4: Performance Measurement > should measure transaction overhead 544ms
 âœ“ __tests__/spike/transaction-isolation.test.ts > SPIKE: Transaction-Based Test Isolation > Test 5: Alternative Approach - Unique IDs + Cleanup > should demonstrate unique ID approach 38ms
stdout | __tests__/routers/workingPatterns.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > list > should list all working patterns for tenant 118ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > list > should filter by userId when provided 59ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > list > should enforce multi-tenant isolation 45ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > getByUser > should get all patterns for a specific user 39ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > getByUser > should throw NOT_FOUND for non-existent user 33ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > getByUser > should enforce multi-tenant isolation 41ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > getActive > should get the currently active pattern for a user 42ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > getActive > should return null if no active pattern 35ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > create > should create a new working pattern (admin only) 55ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > create > should validate that sum of day hours equals contracted hours 29ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > create > should throw BAD_REQUEST for non-existent user 50ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > update > should update an existing working pattern (admin only) 48ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > update > should validate sum of hours when updating 46ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > update > should throw NOT_FOUND for non-existent pattern 30ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > update > should enforce multi-tenant isolation 34ms
stdout | __tests__/routers/workingPatterns.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > delete > should delete a working pattern (admin only) 54ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > delete > should throw NOT_FOUND for non-existent pattern 42ms
 âœ“ __tests__/routers/workingPatterns.test.ts > workingPatterns router > delete > should enforce multi-tenant isolation 38ms
stdout | __tests__/routers/toil.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should accrue TOIL when logged hours exceed contracted hours 101ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should not accrue TOIL when logged hours equal contracted hours 19ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should not accrue TOIL when logged hours are less than contracted 20ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should update existing leave balance when accruing TOIL 26ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should create new leave balance if none exists 39ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > accrueToil > should set expiry date to 6 months from accrual 33ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getBalance > should return current TOIL balance for user 21ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getBalance > should return zero balance if no leave balance exists 22ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getBalance > should default to current user if userId not provided 21ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getHistory > should return TOIL accrual history for user 27ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getHistory > should respect pagination limits 30ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getExpiringToil > should return TOIL expiring within specified days 20ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getExpiringToil > should not return already expired TOIL 20ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > getExpiringToil > should not return TOIL expiring beyond the specified days 19ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > markExpiredToil > should mark expired TOIL records as expired 27ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > markExpiredToil > should not mark future TOIL as expired 26ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > markExpiredToil > should only mark TOIL for current tenant 32ms
 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > Multi-tenant isolation > should only return TOIL balance for current tenant 31ms
stdout | __tests__/routers/toil.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/toil.test.ts > app/server/routers/toil.ts (Integration) > Multi-tenant isolation > should only return TOIL history for current tenant 40ms
stdout | __tests__/routers/staff-statistics.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilization > should calculate utilization for staff with time entries 126ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilization > should identify underutilized staff 59ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilization > should return all staff when no userId provided 35ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilization > should filter by department 44ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilization > should calculate correct averages in summary 49ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getDepartmentUtilization > should aggregate utilization by department 58ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilizationTrend > should return 12-week trend data 68ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilizationTrend > should calculate trend utilization correctly 46ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffUtilizationTrend > should throw error for non-existent user 45ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffComparison > should return sorted staff comparison 46ms
 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffComparison > should filter by status 32ms
stdout | __tests__/routers/staff-statistics.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/staff-statistics.test.ts > Staff Statistics Router > getStaffComparison > should sort by name alphabetically 38ms
stdout | __tests__/helpers/factories.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestTenant > should create a tenant with unique slug 70ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestTenant > should accept overrides 21ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestUser > should create a user with unique email 47ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestUser > should accept overrides 32ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestClient > should create a client with unique client code 39ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestClient > should accept overrides 48ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestTask > should create a task with unique title 37ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestInvoice > should create an invoice with unique invoice number 37ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createTestDocument > should create a document with unique file name 35ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > Batch creation functions > should create multiple clients 37ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > Batch creation functions > should create multiple tasks 43ms
stderr | __tests__/helpers/factories.test.ts > Test Data Factories > cleanupTestData > should handle cleanup failures gracefully
Test cleanup error: DrizzleQueryError: Failed query: delete from "clients" where "clients"."id" in ($1)
params: non-existent-id
    at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:73:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:369:7[90m)[39m
    at [90m/root/projects/practice-hub/[39m__tests__/helpers/factories.test.ts:388:7
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  query: [32m'delete from "clients" where "clients"."id" in ($1)'[39m,
  params: [ [32m'non-existent-id'[39m ],
  cause: error: invalid input syntax for type uuid: "non-existent-id"
      at [90m/root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/node-postgres/session.ts:149:14
      at NodePgPreparedQuery.queryWithCache [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/[4msrc[24m/pg-core/session.ts:71:12[90m)[39m
      at cleanupTestData [90m(/root/projects/practice-hub/[39m__tests__/helpers/factories.ts:369:7[90m)[39m
      at [90m/root/projects/practice-hub/[39m__tests__/helpers/factories.test.ts:388:7
      at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    length: [33m147[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'22P02'[39m,
    detail: [90mundefined[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [32m"unnamed portal parameter $1 = '...'"[39m,
    schema: [90mundefined[39m,
    table: [90mundefined[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [90mundefined[39m,
    file: [32m'uuid.c'[39m,
    line: [32m'133'[39m,
    routine: [32m'string_to_uuid'[39m
  }
}

stdout | __tests__/helpers/factories.test.ts
âœ… Test teardown complete

 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > createCompleteTestSetup > should create tenant, user, and client 36ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > cleanupTestData > should delete all tracked data 44ms
 âœ“ __tests__/helpers/factories.test.ts > Test Data Factories > cleanupTestData > should handle cleanup failures gracefully 10ms
stdout | __tests__/routers/workTypes.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > list > should list all active work types for tenant 89ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > list > should filter out inactive work types by default 43ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > list > should include inactive when requested 46ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > list > should enforce tenant isolation 50ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > create > should create a new work type 40ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > create > should auto-assign sort order 44ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > create > should reject duplicate code 37ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > create > should reject invalid color code 27ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > update > should update work type properties 28ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > update > should reject update for non-existent work type 16ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > update > should enforce tenant isolation 39ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > softDelete > should hard delete when no time entries exist 34ms
 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > softDelete > should soft delete when time entries exist 48ms
stdout | __tests__/routers/workTypes.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/workTypes.test.ts > app/server/routers/workTypes.ts (Integration) > reorder > should update sort orders 124ms
stdout | __tests__/routers/timesheet-submissions.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > submit procedure > should successfully submit a week with sufficient hours 125ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > submit procedure > should fail to submit with insufficient hours 40ms
stderr | __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > approve procedure > should allow managers to approve submissions
No staffCapacity record found for user 057659e8-d04c-45f3-a73c-1f7bd3400356 - skipping TOIL accrual

 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > submit procedure > should prevent duplicate submissions 75ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > approve procedure > should allow managers to approve submissions 40ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > approve procedure > should prevent non-managers from approving 30ms
stdout | __tests__/routers/timesheet-submissions.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > reject procedure > should reject submission with comments 36ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > getPendingApprovals procedure > should return pending submissions for managers 31ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > getSubmissionStatus procedure > should return submission status for a week 29ms
 âœ“ __tests__/routers/timesheet-submissions.test.ts > app/server/routers/timesheets.ts - Submissions (Integration) > getSubmissionStatus procedure > should return null for weeks without submissions 27ms
stdout | __tests__/routers/staff-statistics-multi-tenant.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/staff-statistics-multi-tenant.test.ts > Staff Statistics Multi-Tenant Isolation > should only return stats for current tenant 136ms
 âœ“ __tests__/routers/staff-statistics-multi-tenant.test.ts > Staff Statistics Multi-Tenant Isolation > should isolate department utilization 72ms
 âœ“ __tests__/routers/staff-statistics-multi-tenant.test.ts > Staff Statistics Multi-Tenant Isolation > should isolate staff utilization trends 80ms
 âœ“ __tests__/routers/staff-statistics-multi-tenant.test.ts > Staff Statistics Multi-Tenant Isolation > should isolate staff comparison data 46ms
stdout | __tests__/routers/staff-statistics-multi-tenant.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/staff-statistics-multi-tenant.test.ts > Staff Statistics Multi-Tenant Isolation > should not expose department IDs across tenants 39ms
stdout | __tests__/routers/email-templates.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 1: should create email template with all fields and return ID 110ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 2: should list all templates for tenant and filter by type 53ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 3: should get template by ID with all fields 41ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 4: should update template subject, bodyHtml, and variables 41ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 5: should soft delete template (set isActive = false) 52ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 6: Multi-tenant isolation - Tenant A cannot see Tenant B templates 71ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 7: should reject empty subject and bodyHtml 20ms
 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 8: should preview template with sample data and render HTML 26ms
stdout | __tests__/routers/email-templates.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/email-templates.test.ts > Email Templates Router > Test 1-9: Email Templates CRUD > Test 9: should send test email and queue it for delivery 32ms
stdout | __tests__/api/import/tasks.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/api/import/tasks.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Duplicate Detection (AC13) > should detect duplicate task against existing database records (AC13) 30ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Duplicate Detection (AC13) > should detect duplicate task within same import batch (AC13) 25ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Duplicate Detection (AC13) > should detect duplicates with case-insensitive title matching (AC13) 17ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Duplicate Detection (AC13) > should allow same task title for different clients (not a duplicate) 56ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Client/User Lookup (AC11, AC12) > should fail when client_code not found (AC11) 11ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Client/User Lookup (AC11, AC12) > should fail when assigned_to_email not found (AC12) 12ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Client/User Lookup (AC11, AC12) > should successfully import task with valid client and user (AC11, AC12) 30ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Dry-Run Mode (AC14) > should validate without importing when dry-run enabled (AC14) 13ms
 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Dry-Run Mode (AC14) > should show validation errors in dry-run mode (AC14) 7ms
stdout | __tests__/api/import/tasks.test.ts
âœ… Test teardown complete

stdout | __tests__/api/import/tasks.test.ts
âœ… Test teardown complete

 âœ“ __tests__/api/import/tasks.test.ts > Task Import API - Batch Processing > should process large imports in batches 69ms
stdout | __tests__/lib/xero/sync-service.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncClientToXero > should sync a new client to Xero successfully
Client 550e8400-e29b-41d4-a716-446655440001 synced to Xero successfully (ContactID: xero-contact-123)

stderr | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncClientToXero > should handle sync errors and update status
Failed to sync client 550e8400-e29b-41d4-a716-446655440001 to Xero: Error: Xero API error: Rate limit exceeded
    at [90m/root/projects/practice-hub/[39m__tests__/lib/xero/sync-service.test.ts:180:9
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncClientToXero > should sync a new client to Xero successfully 112ms
 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncClientToXero > should handle sync errors and update status 50ms
stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncInvoiceToXero > should sync invoice and auto-sync client if needed
Client 550e8400-e29b-41d4-a716-446655440001 not synced to Xero yet, syncing now...

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncInvoiceToXero > should sync invoice and auto-sync client if needed
Client 550e8400-e29b-41d4-a716-446655440001 synced to Xero successfully (ContactID: xero-contact-123)

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncInvoiceToXero > should sync invoice and auto-sync client if needed
Invoice dd884c4a-41ab-4dde-8275-85fd9bc25e98 synced to Xero successfully (InvoiceID: xero-invoice-123)

 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > syncInvoiceToXero > should sync invoice and auto-sync client if needed 73ms
 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > markClientAsPendingSync > should mark client as pending sync 32ms
 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > markInvoiceAsPendingSync > should mark invoice as pending sync 36ms
stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > processPendingSyncs > should process all pending syncs for a tenant
Client 550e8400-e29b-41d4-a716-446655440011 synced to Xero successfully (ContactID: xero-contact-1)

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > processPendingSyncs > should process all pending syncs for a tenant
Client 550e8400-e29b-41d4-a716-446655440012 synced to Xero successfully (ContactID: xero-contact-2)

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > processPendingSyncs > should process all pending syncs for a tenant
Pending sync complete: 2 clients, 0 invoices synced successfully

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > retryFailedSyncs > should retry all failed syncs for a tenant
Client 550e8400-e29b-41d4-a716-446655440001 synced to Xero successfully (ContactID: xero-contact-123)

stdout | __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > retryFailedSyncs > should retry all failed syncs for a tenant
Retry complete: 1 clients, 0 invoices synced successfully

stdout | __tests__/lib/xero/sync-service.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > processPendingSyncs > should process all pending syncs for a tenant 61ms
 âœ“ __tests__/lib/xero/sync-service.test.ts > Xero Sync Service > retryFailedSyncs > should retry all failed syncs for a tenant 54ms
stdout | __tests__/routers/toil-expiry.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should identify TOIL expiring within 30 days 114ms
 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should not include TOIL expiring beyond 30 days 43ms
 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should mark expired TOIL and deduct from balance 37ms
 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should handle multiple expired TOIL records for same user 45ms
stdout | __tests__/routers/toil-expiry.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should not deduct balance below zero 39ms
 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should not mark already expired TOIL records 38ms
 âœ“ __tests__/routers/toil-expiry.test.ts > TOIL Expiry Policy > should correctly calculate expiring TOIL for multiple records 21ms
stdout | __tests__/lib/xero/api-client.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getCredentials > should return decrypted credentials 80ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getCredentials > should return null if credentials not found 35ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getCredentials > should auto-refresh if token expires within 5 minutes 48ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > createOrUpdateContact > should create a contact in Xero 38ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > createOrUpdateContact > should handle API errors 26ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > createOrUpdateInvoice > should create an invoice in Xero 19ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > createPayment > should create a payment in Xero 15ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getContact > should fetch a contact from Xero 22ms
stdout | __tests__/lib/xero/api-client.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getContact > should return null if contact not found 24ms
 âœ“ __tests__/lib/xero/api-client.test.ts > XeroApiClient > getInvoice > should fetch an invoice from Xero 24ms
stdout | __tests__/integration/tenant-isolation.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Clients Table Isolation > should isolate client records by tenant 33ms
 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Clients Table Isolation > should prevent cross-tenant client access 9ms
 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Leads Table Isolation > should isolate lead records by tenant 26ms
 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Tasks Table Isolation > should isolate task records by tenant 38ms
 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Activity Logs Isolation > should isolate activity log records by tenant 21ms
 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > User Assignment Isolation > should prevent cross-tenant user assignments 17ms
stdout | __tests__/integration/tenant-isolation.test.ts
âœ… Test teardown complete

 âœ“ __tests__/integration/tenant-isolation.test.ts > Tenant Isolation Integration Tests > Complex Query Isolation > should maintain isolation in joined queries 41ms
stdout | __tests__/lib/notifications/shouldSendNotification.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should return true when no user settings exist (default behavior) 83ms
 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should return false when global email channel is disabled 23ms
 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should return false when global in_app channel is disabled 39ms
 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should return false when specific notification preference is disabled 39ms
stdout | __tests__/lib/notifications/shouldSendNotification.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should return true when all checks pass (global and specific) 28ms
 âœ“ __tests__/lib/notifications/shouldSendNotification.test.ts > lib/notifications/check-preferences.ts (Integration) > shouldSendNotification > should handle all 6 notification types correctly 41ms
stdout | __tests__/api/import/services.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/api/import/services.test.ts > Service Import API Integration Tests > should import valid CSV file and create services in database (AC1, AC7) 35ms
 âœ“ __tests__/api/import/services.test.ts > Service Import API Integration Tests > should detect and prevent duplicate service names (AC5) 22ms
 âœ“ __tests__/api/import/services.test.ts > Service Import API Integration Tests > should validate required fields and return errors (AC3) 11ms
 âœ“ __tests__/api/import/services.test.ts > Service Import API Integration Tests > should support dry-run mode for validation preview (AC6) 12ms
stdout | __tests__/api/import/services.test.ts
âœ… Test teardown complete

stdout | __tests__/routers/leave-toil-integration.test.ts
ðŸ§ª Test setup initialized

stderr | __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should allow TOIL leave request when user has sufficient balance
Failed to send leave request submitted email: ReferenceError: React is not defined
    at LeaveRequestSubmittedEmail [90m(/root/projects/practice-hub/[39mlib/email/templates/leave-request-submitted.tsx:29:3[90m)[39m
    at sendLeaveRequestSubmitted [90m(/root/projects/practice-hub/[39mlib/email/leave-notifications.ts:35:14[90m)[39m
    at [90m/root/projects/practice-hub/[39mapp/server/routers/leave.ts:216:7
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at resolveMiddleware [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:571:22[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at procedure [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:673:20[90m)[39m

stderr | __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should deduct TOIL balance when admin approves TOIL leave
Failed to send leave request approved email: ReferenceError: React is not defined
    at LeaveRequestApprovedEmail [90m(/root/projects/practice-hub/[39mlib/email/templates/leave-request-approved.tsx:31:3[90m)[39m
    at sendLeaveRequestApproved [90m(/root/projects/practice-hub/[39mlib/email/leave-notifications.ts:64:14[90m)[39m
    at [90m/root/projects/practice-hub/[39mapp/server/routers/leave.ts:358:9
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at resolveMiddleware [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:571:22[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at callRecursive [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:633:20[90m)[39m
    at procedure [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.2/node_modules/[4m@trpc/server[24m/src/unstable-core-do-not-import/procedureBuilder.ts:673:20[90m)[39m

 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should reject TOIL leave request when user has insufficient balance 9ms
 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should reject TOIL leave request when user has zero balance 11ms
 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should allow TOIL leave request when user has sufficient balance 18ms
 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should deduct TOIL balance when admin approves TOIL leave 20ms
stdout | __tests__/routers/leave-toil-integration.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should restore TOIL balance when user cancels approved TOIL leave 23ms
 âœ“ __tests__/routers/leave-toil-integration.test.ts > Leave-TOIL Redemption Integration > should handle multi-day TOIL leave correctly 8ms
stdout | __tests__/routers/timesheet-toil-integration.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/timesheet-toil-integration.test.ts > Timesheet-TOIL Integration > should accrue TOIL when timesheet with overtime is approved 36ms
 âœ“ __tests__/routers/timesheet-toil-integration.test.ts > Timesheet-TOIL Integration > should NOT accrue TOIL when logged hours equal contracted hours 12ms
stdout | __tests__/routers/timesheet-toil-integration.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/timesheet-toil-integration.test.ts > Timesheet-TOIL Integration > should NOT accrue TOIL when logged hours are less than contracted hours 19ms
 âœ“ __tests__/routers/timesheet-toil-integration.test.ts > Timesheet-TOIL Integration > should accrue TOIL for multiple submissions in bulk approve 65ms
stdout | app/server/routers/staffCapacity.test.ts
ðŸ§ª Test setup initialized

 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > list > should return empty array when no capacity records exist 26ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > list > should accept optional userId filter 4ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilization > should return utilization data structure 4ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilization > should accept optional userId filter 3ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilization > should accept optional weekStartDate 2ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilizationTrends > should return trends data structure 18ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilizationTrends > should default to 12 weeks if not specified 11ms
stdout | app/server/routers/staffCapacity.test.ts
âœ… Test teardown complete

 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getUtilizationTrends > should accept optional userId filter 8ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > getRecommendations > should return recommendations data structure 4ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > multi-tenant isolation > should only access capacity records for the authenticated tenant 5ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > multi-tenant isolation > should only show utilization for the authenticated tenant 4ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > utilization calculation > should calculate utilization percentage correctly 1ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > utilization calculation > should identify overallocated status (>100%) 1ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > utilization calculation > should identify underutilized status (<75%) 1ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > utilization calculation > should identify optimal status (75-100%) 1ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > create and update operations > should prevent creating capacity record with duplicate effectiveFrom date 4ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > create and update operations > should allow creating capacity records with different effectiveFrom dates 3ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > create and update operations > should reject invalid weeklyHours (< 1) 3ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > create and update operations > should reject invalid weeklyHours (> 168) 3ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > create and update operations > should reject creating capacity for non-existent user 2ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > delete operation > should return success false when deleting non-existent record 2ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > capacity history tracking > should track capacity changes over time 2ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > edge cases > should handle users without capacity records gracefully 2ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > edge cases > should handle division by zero in utilization calculation 1ms
 âœ“ app/server/routers/staffCapacity.test.ts > staffCapacityRouter > edge cases > should handle negative actual hours gracefully 1ms
stdout | lib/cache.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Basic Operations > should store and retrieve values 2ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Basic Operations > should return null for non-existent keys 2ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Basic Operations > should handle multiple keys independently 1ms
stdout | lib/cache.test.ts
âœ… Test teardown complete

 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - TTL (Time To Live) > should expire values after TTL 156ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - TTL (Time To Live) > should not expire before TTL 53ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - TTL (Time To Live) > should use default TTL of 30 seconds 3ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Manual Operations > should delete specific keys 3ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Manual Operations > should clear all cached values 2ms
 âœ“ lib/cache.test.ts > lib/cache.ts > SimpleCache - Manual Operations > should provide cache statistics 2ms
 âœ“ lib/cache.test.ts > lib/cache.ts > invalidateQuestionnaireCache > should invalidate cache for specific session 2ms
 âœ“ lib/cache.test.ts > lib/cache.ts > invalidateQuestionnaireCache > should not affect other sessions 1ms
stdout | app/api/webhooks/lemverify/route.test.ts
ðŸ§ª Test setup initialized

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should reject requests without signature
Missing LEM Verify webhook signature

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should reject requests with invalid signature
Invalid LEM Verify webhook signature

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should accept requests with valid signature
KYC verification not found for LEM Verify ID: verification-123
This may be a test webhook or a verification from another tenant

 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should reject requests without signature 8ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should reject requests with invalid signature 5ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should accept requests with valid signature 29ms
stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should return 500 when LEMVERIFY_WEBHOOK_SECRET not configured
LEMVERIFY_WEBHOOK_SECRET not configured

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Payload Validation > should reject invalid JSON
Failed to parse webhook body: SyntaxError: Unexpected token 'i', "invalid json {" is not valid JSON
    at JSON.parse (<anonymous>)
    at POST [90m(/root/projects/practice-hub/[39mapp/api/webhooks/lemverify/route.ts:282:20[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/root/projects/practice-hub/[39mapp/api/webhooks/lemverify/route.test.ts:141:24
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Payload Validation > should reject events missing required fields
Missing required fields in webhook event

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 401 for invalid signature (security - don't retry)
Invalid LEM Verify webhook signature

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 400 for invalid JSON (bad data - don't retry)
Failed to parse webhook body: SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)
    at JSON.parse (<anonymous>)
    at POST [90m(/root/projects/practice-hub/[39mapp/api/webhooks/lemverify/route.ts:282:20[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/root/projects/practice-hub/[39mapp/api/webhooks/lemverify/route.test.ts:207:24
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 400 for missing required fields (bad data - don't retry)
Missing required fields in webhook event

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Event Processing > should accept completed verification events
KYC verification not found for LEM Verify ID: verification-123
This may be a test webhook or a verification from another tenant

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Event Processing > should accept AML alert events
KYC verification not found for LEM Verify ID: verification-123
This may be a test webhook or a verification from another tenant

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Security & Error Handling > should validate signatures are case-sensitive
Invalid LEM Verify webhook signature

stderr | app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Security & Error Handling > should not leak information in error messages
Invalid LEM Verify webhook signature

stdout | app/api/webhooks/lemverify/route.test.ts
âœ… Test teardown complete

 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Signature Verification > should return 500 when LEMVERIFY_WEBHOOK_SECRET not configured 6ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Payload Validation > should reject invalid JSON 6ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Payload Validation > should reject events missing required fields 3ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Payload Validation > should accept events with all required fields 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 401 for invalid signature (security - don't retry) 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 400 for invalid JSON (bad data - don't retry) 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > HTTP Status Codes > should return 400 for missing required fields (bad data - don't retry) 1ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Event Processing > should accept completed verification events 4ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Event Processing > should accept AML alert events 5ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Event Processing > should accept pending status events 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Security & Error Handling > should handle HMAC signature correctly 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Security & Error Handling > should validate signatures are case-sensitive 2ms
 âœ“ app/api/webhooks/lemverify/route.test.ts > app/api/webhooks/lemverify/route.ts > Security & Error Handling > should not leak information in error messages 2ms
stdout | lib/rate-limit/webhook.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should allow requests within tenant limit (10 req/sec) 4ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should block requests exceeding tenant limit 2ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should allow requests within submission limit (1 req/sec) 2ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should block duplicate submission spam 1ms
stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920488

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkSubmissionRateLimit (in-memory fallback) > should enforce 1 req/sec limit
[webhook-rate-limit] Using in-memory fallback for submission submission-1761765920492

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkSubmissionRateLimit (in-memory fallback) > should enforce 1 req/sec limit
[webhook-rate-limit] Using in-memory fallback for submission submission-1761765920492

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for tenant tenant-1761765920494

stderr | lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently
[webhook-rate-limit] Using in-memory fallback for submission submission-1761765920494

stdout | lib/rate-limit/webhook.test.ts
âœ… Test teardown complete

 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should reset counter after window expires 154ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should track different keys independently 3ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkWebhookRateLimitInMemory > should return correct reset time 2ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkTenantRateLimit (in-memory fallback) > should enforce 10 req/sec limit 4ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > checkSubmissionRateLimit (in-memory fallback) > should enforce 1 req/sec limit 1ms
 âœ“ lib/rate-limit/webhook.test.ts > lib/rate-limit/webhook.ts > rate limit isolation > should track tenant and submission limits independently 2ms
stdout | lib/rate-limit.test.ts
ðŸ§ª Test setup initialized

stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should allow requests within limit
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)

stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should block requests exceeding limit
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)

stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should reset counter after window expires
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)

 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should allow requests within limit 4ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should block requests exceeding limit 3ms
stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should reset counter after window expires
Rate limiting using in-memory fallback (not suitable for production)

stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should track different identifiers independently
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)
Rate limiting using in-memory fallback (not suitable for production)

stderr | lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should return correct reset time
Rate limiting using in-memory fallback (not suitable for production)

stdout | lib/rate-limit.test.ts
âœ… Test teardown complete

 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should reset counter after window expires 154ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should track different identifiers independently 3ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > checkRateLimit > should return correct reset time 2ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > getClientIdentifier > should extract IP from x-forwarded-for header 2ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > getClientIdentifier > should extract IP from x-real-ip header when x-forwarded-for not available 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > getClientIdentifier > should prefer x-forwarded-for over x-real-ip 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > getClientIdentifier > should return 'unknown' when no IP headers present 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > getClientIdentifier > should handle multiple IPs in x-forwarded-for 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > formatResetTime > should format seconds when less than 60 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > formatResetTime > should format minutes when 60 seconds or more 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > formatResetTime > should round up minutes 1ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > formatResetTime > should handle very short times 5ms
 âœ“ lib/rate-limit.test.ts > lib/rate-limit.ts > formatResetTime > should handle times in the past (returns 0s or negative) 1ms
stdout | lib/realtime/event-emitter.test.ts
ðŸ§ª Test setup initialized

stderr | lib/realtime/event-emitter.test.ts > ServerEventEmitter > Event Emission > should handle errors in callbacks without affecting other subscribers
[ServerEventEmitter] Error in callback for tenant tenant-1: Error: Subscriber error
    at [90m/root/projects/practice-hub/[39mlib/realtime/event-emitter.test.ts:198:15
    at [90m/root/projects/practice-hub/[39mlib/realtime/event-emitter.ts:89:9
    at Set.forEach (<anonymous>)
    at ServerEventEmitter.emit [90m(/root/projects/practice-hub/[39mlib/realtime/event-emitter.ts:87:15[90m)[39m
    at [90m/root/projects/practice-hub/[39mlib/realtime/event-emitter.test.ts:206:15
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Multi-tenant Isolation > should isolate events between different tenants 4ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Multi-tenant Isolation > should not leak events between tenants 2ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Multi-tenant Isolation > should support multiple subscribers per tenant 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Subscription Management > should return cleanup function from subscribe 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Subscription Management > should remove tenant when last subscriber unsubscribes 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Event Emission > should add timestamp to events if not present 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Event Emission > should preserve existing timestamp 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Event Emission > should not emit if tenant has no subscribers 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Event Emission > should handle errors in callbacks without affecting other subscribers 4ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Statistics > should track subscriber count per tenant 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Statistics > should track total subscriber count 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Statistics > should list active tenants 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Cleanup Operations > should clear all subscribers for a tenant 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Cleanup Operations > should clear all subscribers across all tenants 1ms
 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Performance & Scalability > should handle many subscribers efficiently 2ms
stdout | lib/realtime/event-emitter.test.ts
âœ… Test teardown complete

 âœ“ lib/realtime/event-emitter.test.ts > ServerEventEmitter > Performance & Scalability > should handle rapid event emission 22ms
stdout | __tests__/lib/companies-house-client.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should successfully fetch company data with 200 response 6ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw CompanyNotFoundError on 404 response 4ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw RateLimitError on 429 response 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw APIServerError on 500 response 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw APIServerError on 502 response 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw APIServerError on 503 response 6ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw APIServerError on 504 response 5ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should throw NetworkError on fetch failure 4ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should use correct Basic Auth header format 5ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should map snake_case API response to camelCase 6ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should handle missing API key gracefully 4ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should handle company with no SIC codes 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getCompany() > should handle company with incomplete address 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should successfully fetch officers array 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should handle empty officers list 2ms
stdout | __tests__/lib/companies-house-client.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should throw CompanyNotFoundError on 404 response 8ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should throw RateLimitError on 429 response 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should throw APIServerError on 500 response 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should throw NetworkError on fetch failure 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should map snake_case API response to camelCase 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getOfficers() > should handle officers without resignation date 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should successfully fetch PSCs array 3ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should handle empty PSCs list 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should throw CompanyNotFoundError on 404 response 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should throw RateLimitError on 429 response 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should throw APIServerError on 500 response 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should throw NetworkError on fetch failure 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should map snake_case API response to camelCase 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should handle PSC with single nature of control 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > getPSCs() > should handle corporate entity PSCs 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > Error Classes > should create CompanyNotFoundError with correct properties 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > Error Classes > should create RateLimitError with correct properties 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > Error Classes > should create APIServerError with correct properties 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > Error Classes > should create NetworkError with correct properties 2ms
 âœ“ __tests__/lib/companies-house-client.test.ts > Error Classes > should handle NetworkError with non-Error objects 2ms
stdout | lib/utils/csv-parser-enhanced.test.ts
ðŸ§ª Test setup initialized

stdout | lib/utils/csv-parser-enhanced.test.ts
âœ… Test teardown complete

 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > stripBOM > should remove UTF-8 BOM from start of string 2ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > stripBOM > should handle content without BOM 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > stripBOM > should handle empty string 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > stripBOM > should only remove BOM from start, not middle 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > stripBOM > should handle UTF-16 BOMs 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > hasBOM > should detect UTF-8 BOM 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > hasBOM > should detect UTF-16 BOMs 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > hasBOM > should return false for content without BOM 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > hasBOM > should return false for empty string 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should detect comma delimiter 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should detect semicolon delimiter 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should detect tab delimiter 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should default to comma if no delimiters found 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should handle empty string 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should choose delimiter with highest count 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should ignore empty lines 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiter > should handle CSV with BOM 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiterRobust > should detect delimiter with consistent usage 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiterRobust > should handle mixed delimiters by choosing most consistent 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiterRobust > should analyze multiple lines for better accuracy 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > detectDelimiterRobust > should default to comma if no clear winner 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should parse UK format (DD/MM/YYYY) 3ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should parse ISO format (YYYY-MM-DD) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should parse US format (MM/DD/YYYY) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should parse hyphenated UK format (DD-MM-YYYY) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should parse dotted format (DD.MM.YYYY) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should auto-detect format from multiple options 5ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should return null for invalid date 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should return null for empty string 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should handle dates with leading/trailing whitespace 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDate > should use custom formats if provided 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDateAuto > should parse date with auto-detection 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseDateAuto > should return null for invalid dates 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > toISODateString > should convert Date to ISO string (YYYY-MM-DD) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > toISODateString > should return null for null input 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > toISODateString > should return null for invalid date 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should parse simple numbers 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should parse numbers with thousand separators 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should parse numbers with currency symbols 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should parse negative numbers in parentheses 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should handle numbers with spaces 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should return null for invalid numbers 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseNumber > should handle decimal numbers 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseBoolean > should parse truthy values (case-insensitive) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseBoolean > should parse falsy values (case-insensitive) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseBoolean > should handle whitespace 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > parseBoolean > should use default value for invalid input 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformValue > should transform to date 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformValue > should transform to number 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformValue > should transform to boolean 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformValue > should transform to string (trim) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformValue > should return null for empty string 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformRow > should transform entire row based on field types 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformRow > should handle missing field types (default to string) 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > transformRow > should handle empty values 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > Integration: CSV with BOM + delimiter detection > should handle BOM-prefixed CSV with auto-detection 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > Integration: Date parsing edge cases > should distinguish between DD/MM/YYYY and MM/DD/YYYY when ambiguous 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > Integration: Date parsing edge cases > should handle unambiguous dates correctly 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > Constants > should have correct DEFAULT_DATE_FORMATS 1ms
 âœ“ lib/utils/csv-parser-enhanced.test.ts > Enhanced CSV Parser Utilities > Constants > should have correct UTF8_BOM character 1ms
stdout | lib/realtime/sse-client.test.ts
ðŸ§ª Test setup initialized

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should connect and emit connection state event
[SSE] State changed: connecting

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should connect and emit connection state event
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should transition to connected state on open
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should transition to connected state on open
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should handle disconnection
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should receive and process events
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should receive and process events
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should support multiple subscriptions
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should support multiple subscriptions
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should allow unsubscribing
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should allow unsubscribing
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should attempt reconnection on error
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/3)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should attempt reconnection on error
[SSE] Connection error

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should attempt reconnection on error
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should use exponential backoff for reconnection
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/3)
[SSE] Reconnecting in 2000ms (attempt 2/3)
[SSE] Reconnecting in 4000ms (attempt 3/3)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should use exponential backoff for reconnection
[SSE] Connection error
[SSE] Connection error
[SSE] Connection error

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should use exponential backoff for reconnection
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should fail after max reconnection attempts
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/3)
[SSE] Reconnecting in 2000ms (attempt 2/3)
[SSE] Reconnecting in 4000ms (attempt 3/3)
[SSE] State changed: failed
[SSE] Falling back to polling mode
[SSE] Starting polling (interval: 30000ms)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should fail after max reconnection attempts
[SSE] Connection error
[SSE] Connection error
[SSE] Connection error
[SSE] Connection error
[SSE] Max reconnection attempts reached

stderr | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should fail after max reconnection attempts
[SSE] Polling error: TypeError: Cannot read properties of undefined (reading 'ok')
    at SSEClient.poll [90m(/root/projects/practice-hub/[39mlib/realtime/sse-client.ts:353:21[90m)[39m

stdout | lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should fail after max reconnection attempts
[SSE] Polling stopped
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should detect stale connections
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/3)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should detect stale connections
[SSE] No heartbeat received, connection may be stale

stdout | lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should detect stale connections
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should reset heartbeat timer on ping
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should reset heartbeat timer on ping
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should start polling after max reconnection attempts
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/2)
[SSE] Reconnecting in 2000ms (attempt 2/2)
[SSE] State changed: failed
[SSE] Falling back to polling mode
[SSE] Starting polling (interval: 30000ms)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should start polling after max reconnection attempts
[SSE] Connection error
[SSE] Connection error
[SSE] Connection error
[SSE] Max reconnection attempts reached

stderr | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should start polling after max reconnection attempts
[SSE] Polling error: TypeError: Cannot read properties of undefined (reading 'ok')
    at SSEClient.poll [90m(/root/projects/practice-hub/[39mlib/realtime/sse-client.ts:353:21[90m)[39m

stdout | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should start polling after max reconnection attempts
[SSE] Polling stopped
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should disable polling when explicitly set
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/1)
[SSE] State changed: failed
[SSE] Falling back to polling mode
[SSE] Starting polling (interval: 30000ms)
[SSE] Polling stopped

stderr | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should disable polling when explicitly set
[SSE] Connection error
[SSE] Connection error
[SSE] Max reconnection attempts reached
[SSE] Polling error: TypeError: Cannot read properties of undefined (reading 'ok')
    at SSEClient.poll [90m(/root/projects/practice-hub/[39mlib/realtime/sse-client.ts:353:21[90m)[39m

stdout | lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should disable polling when explicitly set
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should track connection statistics
[SSE] State changed: connecting
[SSE] Connected
[SSE] State changed: connected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should track connection statistics
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should update reconnect attempts
[SSE] State changed: connecting
[SSE] State changed: reconnecting
[SSE] Reconnecting in 1000ms (attempt 1/3)

stderr | lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should update reconnect attempts
[SSE] Connection error

stdout | lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should update reconnect attempts
[SSE] State changed: disconnected

stdout | lib/realtime/sse-client.test.ts
âœ… Test teardown complete

 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should connect and emit connection state event 11ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should transition to connected state on open 5ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Connection Management > should handle disconnection 4ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should receive and process events 4ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should support multiple subscriptions 3ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Event Subscription > should allow unsubscribing 4ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should attempt reconnection on error 5ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should use exponential backoff for reconnection 5ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Reconnection Logic > should fail after max reconnection attempts 7ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should detect stale connections 3ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Heartbeat Monitoring > should reset heartbeat timer on ping 3ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should start polling after max reconnection attempts 4ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Polling Fallback > should disable polling when explicitly set 3ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should track connection statistics 3ms
 âœ“ lib/realtime/sse-client.test.ts > SSEClient > Connection Stats > should update reconnect attempts 3ms
stdout | lib/services/csv-import.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should generate template with headers only 4ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should generate template with headers and example row 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should generate service template correctly 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should generate task template correctly 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should generate user template correctly 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > generateCsvTemplate > should handle empty example data 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Client CSV Parsing > should parse valid client CSV data 10ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Client CSV Parsing > should validate required fields for clients 4ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Client CSV Parsing > should validate email format for clients 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Service CSV Parsing > should parse valid service CSV data 4ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Service CSV Parsing > should validate required fields for services 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Service CSV Parsing > should parse numeric fields correctly 3ms
stdout | lib/services/csv-import.test.ts
âœ… Test teardown complete

 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Service CSV Parsing > should parse boolean fields correctly 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Task CSV Parsing > should parse valid task CSV data 4ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Task CSV Parsing > should validate required fields for tasks 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > User CSV Parsing > should parse valid user CSV data 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > User CSV Parsing > should validate email format for users 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > User CSV Parsing > should validate required fields for users 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should handle empty CSV files 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should handle CSV with headers only 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should skip empty rows 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should handle mixed valid and invalid rows 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should provide row numbers in error messages 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Error Handling > should provide field names in error messages 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > BOM Handling (AC5) > should handle UTF-8 BOM prefix 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > BOM Handling (AC5) > should strip BOM by default 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > BOM Handling (AC5) > should handle CSV without BOM 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Multi-Delimiter Support (AC1, AC2) > should parse semicolon-delimited CSV 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Multi-Delimiter Support (AC1, AC2) > should parse tab-delimited CSV 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Multi-Delimiter Support (AC1, AC2) > should use explicit delimiter if provided 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Multi-Delimiter Support (AC1, AC2) > should auto-detect delimiter without explicit option 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Date Format Support (AC3, AC4) > should parse UK date format (DD/MM/YYYY) 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Date Format Support (AC3, AC4) > should parse ISO date format (YYYY-MM-DD) 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Date Format Support (AC3, AC4) > should parse US date format (MM/DD/YYYY) 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Date Format Support (AC3, AC4) > should parse hyphenated UK format (DD-MM-YYYY) 1ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Date Format Support (AC3, AC4) > should handle mixed date formats in same CSV 3ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Combined Enhancement Tests > should handle BOM + semicolon delimiter + date formats 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Combined Enhancement Tests > should handle tab-delimited with BOM 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Combined Enhancement Tests > should handle real-world Excel CSV export (semicolons + quotes) 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Task Import with service_name (AC10) > should accept service_name field 2ms
 âœ“ lib/services/csv-import.test.ts > CSV Import Service > parseCsvFile > Task Import with service_name (AC10) > should handle missing service_name (optional) 1ms
stdout | lib/services/client-import-validator.test.ts
ðŸ§ª Test setup initialized

stdout | lib/services/client-import-validator.test.ts
âœ… Test teardown complete

 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should validate a complete valid row 4ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should require company_name 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should validate email format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should validate VAT number format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should validate Companies House number length 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should validate client_type enum 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should default status to active 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should normalize email to lowercase 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > clientImportRowSchema > should accept valid VAT number formats 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should parse DD/MM/YYYY format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should parse YYYY-MM-DD format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should parse MM/DD/YYYY format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should return success for empty string 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should fail for invalid date format 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > parseFlexibleDate > should fail for invalid date values 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > validateClientRow > should return validation errors for invalid schema 2ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > validateClientRow > should include row number in error messages 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > validateClientImport > should validate multiple rows 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > validateClientImport > should return error count and valid count 1ms
 âœ“ lib/services/client-import-validator.test.ts > client-import-validator > generateClientCode > should generate sequential client codes 1ms
stdout | __tests__/api/webhooks/docuseal.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > processes 'completed' event and updates proposal to 'signed' 12ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > returns cached response for duplicate 'completed' event (idempotency) 5ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > processes 'declined' event and updates proposal to 'rejected' 7ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > processes 'expired' event and updates proposal to 'expired' 5ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > rejects request with missing signature header 4ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > rejects request with invalid signature 14ms
stdout | __tests__/api/webhooks/docuseal.test.ts
âœ… Test teardown complete

 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > rate limits tenant after 10 requests per second (returns 429) 5ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > prevents submission spam with 409 Conflict (2+ requests in 1 second) 5ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > creates activity log only once per real event (not on cached) 6ms
 âœ“ __tests__/api/webhooks/docuseal.test.ts > DocuSeal Webhook Handler > captures Sentry errors for all error branches 9ms
stdout | __tests__/lib/services/template-placeholders.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {client_name} placeholder 3ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {service_name} placeholder 2ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {period} placeholder 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {tax_year} placeholder 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {company_number} placeholder 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {quarter} placeholder from activation date 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {month} placeholder from activation date 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace {year} placeholder from activation date 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace multiple placeholders in one string 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should replace the same placeholder multiple times 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should handle missing placeholder data gracefully 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should handle empty string 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should handle text with no placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > replacePlaceholders > should calculate correct quarter from different months 2ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should validate valid placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should accept all supported placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should detect invalid placeholder 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should detect multiple invalid placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should validate text with no placeholders as valid 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should validate empty string as valid 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should detect malformed placeholder (no closing brace) 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should handle nested braces correctly 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > validatePlaceholders > should validate case-sensitive placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should add days to activation date 1ms
stdout | __tests__/lib/services/template-placeholders.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should add months to activation date 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should add both days and months 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle zero offsets 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle month overflow correctly 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle day overflow across months 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle February edge cases 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle large day offsets 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle large month offsets 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should preserve time components 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > calculateDueDate > should handle leap year correctly 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > SUPPORTED_PLACEHOLDERS constant > should contain all expected placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > SUPPORTED_PLACEHOLDERS constant > should have descriptions for all placeholders 1ms
 âœ“ __tests__/lib/services/template-placeholders.test.ts > lib/services/template-placeholders.ts > SUPPORTED_PLACEHOLDERS constant > should have exactly 9 supported placeholders 1ms
stdout | lib/utils/task-generation.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should replace client name placeholder 3ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should replace multiple different placeholders 3ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should replace same placeholder multiple times 3ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should handle missing optional placeholders 3ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should preserve text without placeholders 2ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should handle empty template 2ms
 âœ“ lib/utils/task-generation.test.ts > replacePlaceholders > should replace all placeholder types 3ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should add months correctly 3ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should add days correctly 2ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should add both months and days 2ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should handle negative offsets 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should handle zero offsets 1ms
stdout | lib/utils/task-generation.test.ts
âœ… Test teardown complete

 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should handle undefined offsets 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should handle end of month correctly 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateDueDate > should handle leap year 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTargetDate > should return 7 days before due date 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTargetDate > should handle month boundary 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTargetDate > should handle year boundary 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > monthly frequency > should calculate current month 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > monthly frequency > should calculate next month 2ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > monthly frequency > should calculate month in next year 2ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > quarterly frequency > should calculate Q1 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > quarterly frequency > should calculate Q2 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > quarterly frequency > should calculate Q4 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > quarterly frequency > should calculate Q1 next year 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > annually frequency > should calculate current year 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > annually frequency > should calculate next year 1ms
 âœ“ lib/utils/task-generation.test.ts > calculatePeriodInfo > annually frequency > should calculate multiple years ahead 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTaxYear > should return correct tax year before April 6 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTaxYear > should return correct tax year on April 6 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTaxYear > should return correct tax year after April 6 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTaxYear > should return correct tax year in December 1ms
 âœ“ lib/utils/task-generation.test.ts > calculateTaxYear > should return correct tax year in January 1ms
stdout | __tests__/routers/taskTemplates.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should accept empty input (all templates) 4ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should accept serviceId filter 4ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should accept taskType filter 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should accept includeInactive flag 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should default includeInactive to false 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > list > should accept all filters combined 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > getById > should require string ID 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > getById > should reject non-string ID 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > getById > should accept empty string (will fail at database level) 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should accept valid template data 3ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should require serviceId as UUID 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should require namePattern 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should require priority 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should validate priority enum 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should reject invalid priority 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should allow optional taskType 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should accept optional fields 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should default dueDateOffsetDays to 0 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should default dueDateOffsetMonths to 0 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > create > should default isRecurring to false 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > update > should accept valid update data 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > update > should require template ID 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > update > should require all fields for update 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > delete > should accept template ID 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > delete > should require id field 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > clone > should accept templateId 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > clone > should require templateId field 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > getClientTemplates > should accept clientId 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > getClientTemplates > should require clientId 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should accept valid override data 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should accept customPriority 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should validate customPriority enum 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should reject invalid customPriority 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should accept customDueDate as string 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should default isDisabled to false 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should require clientId and templateId 3ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > setClientOverride > should accept all override fields combined 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > removeClientOverride > should accept clientId and templateId 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > removeClientOverride > should require both clientId and templateId 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > Router Structure > should export all expected procedures 2ms
stdout | __tests__/routers/taskTemplates.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > Router Structure > should have 9 procedures total 2ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > Multi-tenant Isolation > should use tenantId from context in all queries 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > Placeholder Validation Integration > should validate namePattern placeholders on create 1ms
 âœ“ __tests__/routers/taskTemplates.test.ts > app/server/routers/taskTemplates.ts > Placeholder Validation Integration > should validate namePattern placeholders on update 1ms
stdout | lib/xero/client.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getAuthorizationUrl > should generate valid OAuth URL with state parameter 6ms
 â†“ lib/xero/client.test.ts > lib/xero/client.ts > getAuthorizationUrl > should throw error if XERO_CLIENT_ID is not set
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getAccessToken > should exchange code for access token successfully 5ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getAccessToken > should throw error on 401 Unauthorized response 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getAccessToken > should throw error on 500 Server Error response 3ms
 â†“ lib/xero/client.test.ts > lib/xero/client.ts > getAccessToken > should throw error if credentials are not configured
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > refreshAccessToken > should refresh access token successfully 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > refreshAccessToken > should throw error when refresh token is expired 3ms
 â†“ lib/xero/client.test.ts > lib/xero/client.ts > refreshAccessToken > should throw error if credentials are not configured
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getConnections > should fetch Xero connections successfully 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getConnections > should throw error when fetch fails 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getValidAccessToken > should return valid token if not near expiry 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getValidAccessToken > should refresh token when near expiration (5-min buffer) 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getValidAccessToken > should refresh token when already expired 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > getValidAccessToken > should throw error when no Xero connection found for client 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > fetchBankTransactions > should fetch bank transactions successfully 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > fetchBankTransactions > should handle empty transactions response 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > fetchBankTransactions > should handle missing optional fields in transactions 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > fetchBankTransactions > should throw error on API failure 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Network Errors > should handle network error in getAccessToken 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Network Errors > should handle network error in refreshAccessToken 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Network Errors > should handle network error in getConnections 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Network Errors > should handle network error in fetchBankTransactions 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > HTTP Error Codes > should handle 429 Rate Limit error in getAccessToken 3ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > HTTP Error Codes > should handle 500 Internal Server Error in refreshAccessToken 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Malformed Responses > should handle invalid JSON in getAccessToken 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > Error Handling > Malformed Responses > should handle invalid JSON in fetchBankTransactions 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should return 0 for empty transactions array 8ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should calculate average monthly transactions correctly 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should handle single month with multiple transactions 4ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should handle single transaction in single month 5ms
 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should handle transactions across multiple months 5ms
stdout | lib/xero/client.test.ts
âœ… Test teardown complete

 âœ“ lib/xero/client.test.ts > lib/xero/client.ts > calculateMonthlyTransactions > should round fractional averages correctly 5ms
stdout | __tests__/routers/reports.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getDashboardKpis > should have no required input 4ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getDashboardKpis > should return KPIs with calculated metrics 4ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getDashboardKpis > should handle null KPI data gracefully 4ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should accept default parameters 5ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should accept months parameter 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should accept period parameter 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should accept custom date range 3ms
stdout | __tests__/routers/reports.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should validate months min value 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should validate months max value 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getMonthlyRevenue > should return monthly revenue data 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getClientRevenue > should accept default parameters 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getClientRevenue > should accept limit parameter 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getClientRevenue > should validate limit min value 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getClientRevenue > should validate limit max value 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getClientRevenue > should return client revenue data 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getServicePerformance > should accept empty input 4ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getServicePerformance > should accept period parameter 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > getServicePerformance > should return service performance data 3ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > Multi-tenant isolation > should filter KPIs by tenantId 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > Multi-tenant isolation > should filter monthly revenue by tenantId 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > Multi-tenant isolation > should filter client revenue by tenantId 2ms
 âœ“ __tests__/routers/reports.test.ts > app/server/routers/reports.ts > Multi-tenant isolation > should filter service performance by tenantId 4ms
stdout | lib/s3/upload.test.ts
ðŸ§ª Test setup initialized

stderr | lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should throw error for invalid URLs
Failed to extract S3 key from URL: TypeError: Invalid URL
[90m    at new URL (node:internal/url:825:25)[39m
    at extractS3Key [90m(/root/projects/practice-hub/[39mlib/s3/upload.ts:172:20[90m)[39m
    at [90m/root/projects/practice-hub/[39mlib/s3/upload.test.ts:51:20
    at Proxy.assertThrows [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/chai@5.3.3/node_modules/[4mchai[24m/index.js:2767:5[90m)[39m
    at Proxy.methodWrapper [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/chai@5.3.3/node_modules/[4mchai[24m/index.js:1686:25[90m)[39m
    at Proxy.<anonymous> [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+expect@3.2.4/node_modules/[4m@vitest/expect[24m/dist/index.js:1088:12[90m)[39m
    at Proxy.overwritingMethodWrapper [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/chai@5.3.3/node_modules/[4mchai[24m/index.js:1735:33[90m)[39m
    at Proxy.<anonymous> [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+expect@3.2.4/node_modules/[4m@vitest/expect[24m/dist/index.js:1420:16[90m)[39m
    at Proxy.<anonymous> [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/@vitest+expect@3.2.4/node_modules/[4m@vitest/expect[24m/dist/index.js:1029:14[90m)[39m
    at Proxy.methodWrapper [90m(file:///root/projects/practice-hub/[39mnode_modules/[4m.pnpm[24m/chai@5.3.3/node_modules/[4mchai[24m/index.js:1686:25[90m)[39m {
  code: [32m'ERR_INVALID_URL'[39m,
  input: [32m'not-a-valid-url'[39m
}

stdout | lib/s3/upload.test.ts
âœ… Test teardown complete

 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should extract key from MinIO direct URL 2ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should extract key from presigned MinIO URL 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should extract key from Hetzner S3 URL 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should handle nested paths 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should handle keys with special characters 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should handle URLs without bucket name prefix 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should throw error for invalid URLs 3ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should handle single-level keys 1ms
 âœ“ lib/s3/upload.test.ts > lib/s3/upload.ts > extractS3Key > should remove multiple leading slashes 1ms
stdout | __tests__/routers/settings.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > getTenant > should have no required input 5ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTenant > should accept empty input (partial schema) 3ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTenant > should accept name update 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTenant > should accept slug update 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTenant > should accept multiple fields 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > getNotificationSettings > should have no required input 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept empty input (partial schema) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept global toggles (emailNotifications, inAppNotifications) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept digestEmail string 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept individual notification preferences (FR31) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept all 6 granular notification preferences (FR31) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should accept combined global toggles and granular preferences (FR31) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateNotificationSettings (FR31) > should validate boolean types for notification preferences 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > getUserSettings > should have no required input 1ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should accept valid user settings with notification preferences 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should accept partial settings 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should validate theme enum 2ms
stdout | __tests__/routers/settings.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should validate digestEmail enum 9ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should accept all valid theme values 4ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateUserSettings (includes FR31 fields) > should accept all valid digestEmail values 4ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > getTimesheetSettings (Story 6.3) > should have no required input 4ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should accept empty input (partial schema) 4ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should accept minWeeklyHours only 3ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should accept dailyTargetHours only 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should accept both fields together 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should validate minWeeklyHours minimum (0) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should validate minWeeklyHours maximum (168) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should validate dailyTargetHours minimum (0) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should validate dailyTargetHours maximum (24) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > updateTimesheetSettings (Story 6.3) > should accept boundary values (0 and maximums) 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/settings.test.ts > app/server/routers/settings.ts > Router Structure > should have 8 procedures total 2ms
stdout | lib/services/encryption.test.ts
ðŸ§ª Test setup initialized

stdout | lib/services/encryption.test.ts
âœ… Test teardown complete

 âœ“ lib/services/encryption.test.ts > Encryption Service > validateEncryptionKey > should validate encryption key successfully 2ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > validateEncryptionKey > should throw error if encryption key is missing 2ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > validateEncryptionKey > should throw error if encryption key is wrong length 2ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should encrypt and decrypt text successfully 2ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should produce different ciphertext for same plaintext (different IV) 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should handle special characters and unicode 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should handle long text 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should throw error for tampered ciphertext 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encrypt and decrypt > should throw error for invalid format 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encryptObject and decryptObject > should encrypt and decrypt simple object 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encryptObject and decryptObject > should encrypt and decrypt nested object 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encryptObject and decryptObject > should handle empty object 2ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > encryptObject and decryptObject > should preserve data types after encryption/decryption 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > Real-world use cases > should encrypt Xero OAuth credentials 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > Real-world use cases > should encrypt API keys 1ms
 âœ“ lib/services/encryption.test.ts > Encryption Service > Real-world use cases > should encrypt database connection strings 1ms
stdout | __tests__/routers/portal.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/portal.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/portal.test.ts > app/server/routers/portal.ts > Router Structure > should export all expected procedures 4ms
 âœ“ __tests__/routers/portal.test.ts > app/server/routers/portal.ts > Router Structure > should have 13 procedures total 2ms
stdout | __tests__/routers/dashboard.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > kpis > should have no required input 4ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should accept empty input 3ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should accept pagination parameters 2ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should accept entityType filter 2ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should validate limit max value 2ms
stdout | __tests__/routers/dashboard.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should validate limit min value 2ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > activity > should accept all filters combined 3ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > Router Structure > should export all expected procedures 2ms
 âœ“ __tests__/routers/dashboard.test.ts > app/server/routers/dashboard.ts > Router Structure > should have 2 procedures total 2ms
stdout | lib/services/mention-parser.test.ts
ðŸ§ª Test setup initialized

 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should parse bracketed mentions 3ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should parse multiple bracketed mentions 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should parse username mentions 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should parse mixed mention formats 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should return empty array for no mentions 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > parseMentions > should handle empty string 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > should wrap mentions in styled spans 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > should highlight multiple mentions 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > should not affect text without mentions 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > XSS Protection > should escape script tags in mentions 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > XSS Protection > should escape HTML tags in note content 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > XSS Protection > should escape quotes and apostrophes 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > XSS Protection > should escape ampersands 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > highlightMentions > XSS Protection > should handle multiple XSS attack vectors 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should extract user IDs by full name 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should be case insensitive 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should match by email 10ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should handle null lastName 3ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should return empty array for no matches 3ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > extractUserIds > should remove duplicates 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > insertMention > should insert mention at cursor position 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > insertMention > should replace partial mention 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > insertMention > should insert after text 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > insertMention > should append to end if no @ found 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > isInMentionContext > should return true after @ symbol 1ms
stdout | lib/services/mention-parser.test.ts
âœ… Test teardown complete

 âœ“ lib/services/mention-parser.test.ts > mention-parser > isInMentionContext > should return true after @ with partial text 2ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > isInMentionContext > should return false after space 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > isInMentionContext > should return false before @ 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > isInMentionContext > should return false with no @ 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > getMentionQuery > should extract query after @ 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > getMentionQuery > should return empty string for just @ 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > getMentionQuery > should return empty string if not in mention context 1ms
 âœ“ lib/services/mention-parser.test.ts > mention-parser > getMentionQuery > should extract query with longer text 1ms
stdout | lib/hmrc/client.test.ts
ðŸ§ª Test setup initialized

stdout | lib/hmrc/client.test.ts
âœ… Test teardown complete

 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should successfully validate a valid VAT number 4ms
 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should return invalid for non-existent VAT number 3ms
 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should normalize VAT number by removing GB prefix 2ms
 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should throw RateLimitError when API returns 429 2ms
 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should throw AuthenticationError when OAuth fails 2ms
 âœ“ lib/hmrc/client.test.ts > HMRC VAT Validation > validateVAT > should cache OAuth token for subsequent requests 2ms
stdout | __tests__/lib/email/template-renderer.test.ts
ðŸ§ª Test setup initialized

 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should substitute basic variables 3ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should escape HTML in variables by default 3ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should leave unreplaced variables unchanged if not provided 2ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should use custom placeholder for null values 2ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should handle null values 2ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should not escape HTML when escapeHtml is false 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should handle multiple occurrences of same variable 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > renderTemplate > should handle all supported variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > extractVariables > should extract all variables from template 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > extractVariables > should handle templates with no variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > extractVariables > should deduplicate repeated variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > extractVariables > should handle nested braces correctly 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > validateTemplate > should validate template with all supported variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > validateTemplate > should detect unsupported variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > validateTemplate > should detect multiple unsupported variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > validateTemplate > should validate empty template 1ms
stdout | __tests__/lib/email/template-renderer.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > validateTemplate > should validate template with no variables 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > XSS Protection > should escape < and > 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > XSS Protection > should escape quotes 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > XSS Protection > should escape ampersands 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > XSS Protection > should prevent script injection 1ms
 âœ“ __tests__/lib/email/template-renderer.test.ts > Template Renderer > XSS Protection > should prevent event handler injection by escaping quotes 1ms
stdout | lib/config.test.ts
ðŸ§ª Test setup initialized

stdout | lib/config.test.ts
âœ… Test teardown complete

 âœ“ lib/config.test.ts > lib/config.ts > SUPPORT_EMAIL > should load from NEXT_PUBLIC_SUPPORT_EMAIL environment variable 5ms
 âœ“ lib/config.test.ts > lib/config.ts > SUPPORT_EMAIL > should fallback to default when env var not set 3ms
 âœ“ lib/config.test.ts > lib/config.ts > APP_NAME > should load from NEXT_PUBLIC_APP_NAME environment variable 4ms
 âœ“ lib/config.test.ts > lib/config.ts > APP_NAME > should fallback to default when env var not set 3ms
 âœ“ lib/config.test.ts > lib/config.ts > APP_URL > should load from NEXT_PUBLIC_APP_URL environment variable 3ms
 âœ“ lib/config.test.ts > lib/config.ts > APP_URL > should fallback to BETTER_AUTH_URL when NEXT_PUBLIC_APP_URL not set 3ms
 âœ“ lib/config.test.ts > lib/config.ts > APP_URL > should fallback to localhost when no env vars set 3ms
stdout | __tests__/lib/leave/working-days.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/lib/leave/working-days.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should calculate working days for a standard week (Monday-Friday) 3ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should exclude weekends from calculation 2ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should return 0 for weekend-only date range 2ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should count single day request as 1 working day (when not weekend) 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should count single Saturday as 0 working days 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should exclude UK bank holidays from calculation 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle New Year's Day bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle Easter Monday bank holiday (April 21, 2025) 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle Christmas period with bank holidays 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle multi-week requests 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle requests spanning bank holiday weekend 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > calculateWorkingDays > should handle bank holiday that falls on weekend (substituted) 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > hasWorkingDays > should return true for date range with working days 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > hasWorkingDays > should return false for weekend-only date range 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > hasWorkingDays > should return false for bank holiday only 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > hasWorkingDays > should return true for single working day 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify New Year's Day 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Good Friday 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Easter Monday 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify May Day 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Spring bank holiday 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Summer bank holiday 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Christmas Day 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should identify Boxing Day 2025 as a bank holiday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should return false for non-bank holiday weekday 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should return false for weekend (not a bank holiday) 1ms
 âœ“ __tests__/lib/leave/working-days.test.ts > Working Days Calculation > isUKBankHoliday > should handle 2026 bank holidays correctly 1ms
stdout | __tests__/lib/leave/carryover.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/lib/leave/carryover.test.ts
âœ… Test teardown complete

 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should return 5 days when user has 10 unused days (max carryover) 2ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should return 3 days when user has 3 unused days 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should return 0 days when user has no unused leave 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should return 0 days when user has used more than entitlement 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should not count already carried over days in calculation 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should cap at 5 days even with large unused balance from carried over days 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should handle edge case of exactly 5 unused days 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should handle full year unused (25 days available for carryover) 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should handle partial year entitlement correctly 1ms
 âœ“ __tests__/lib/leave/carryover.test.ts > Leave Carryover Logic > calculateCarryover > should return 0 when user has used exactly their current year entitlement (with carryover) 1ms
stdout | lib/client-portal/auto-convert-lead.test.ts
ðŸ§ª Test setup initialized

stdout | lib/client-portal/auto-convert-lead.test.ts
âœ… Test teardown complete

 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Sequential Suffix Logic > should generate CLIENT-001 for first client with empty name prefix 8ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Sequential Suffix Logic > should generate sequential suffix based on existing codes 5ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Sequential Suffix Logic > should use 3-digit suffix with leading zeros 4ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Sequential Suffix Logic > should generate prefix from company name 3ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Sequential Suffix Logic > should use CLIENT prefix when name is empty or too short 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Uniqueness Check > should query for existing codes with matching prefix 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Uniqueness Check > should handle collision by incrementing suffix 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Code Format Validation > should match expected format: PREFIX-### 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Code Format Validation > should not match invalid formats 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Multi-tenant Isolation > should filter codes by tenantId 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Multi-tenant Isolation > should allow same client code in different tenants 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Edge Cases > should handle very long company names 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Edge Cases > should handle special characters in company name 2ms
 âœ“ lib/client-portal/auto-convert-lead.test.ts > Client Code Generation > Edge Cases > should handle suffix overflow (>999) 2ms
stdout | __tests__/routers/onboarding.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/onboarding.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/onboarding.test.ts > app/server/routers/onboarding.ts > Router Structure > should export all expected procedures 4ms
 âœ“ __tests__/routers/onboarding.test.ts > app/server/routers/onboarding.ts > Router Structure > should have 13 procedures total 2ms
stdout | __tests__/routers/pipeline.test.ts
ðŸ§ª Test setup initialized

stdout | __tests__/routers/pipeline.test.ts
âœ… Test teardown complete

 âœ“ __tests__/routers/pipeline.test.ts > app/server/routers/pipeline.ts > Router Structure > should export all expected procedures 6ms
 âœ“ __tests__/routers/pipeline.test.ts > app/server/routers/pipeline.ts > Router Structure > should have 2 procedures total 6ms
stdout | lib/xero/client.integration.test.ts
ðŸ§ª Test setup initialized

stdout | lib/xero/client.integration.test.ts > Xero Integration Tests - Setup Instructions > should show setup instructions when XERO_TEST is not set

========================================
Xero Integration Tests are SKIPPED
========================================
To run these tests:
1. Set up Xero sandbox account (https://developer.xero.com)
2. Add credentials to .env.local
3. Run: XERO_TEST=true pnpm test lib/xero/client.integration.test.ts
========================================


stdout | lib/xero/client.integration.test.ts
âœ… Test teardown complete

 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > OAuth Authorization Flow > should generate valid authorization URL
 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > OAuth Authorization Flow > should exchange authorization code for token
 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > Token Refresh > should refresh access token
 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > Xero Connections > should fetch Xero organization connections
 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > Bank Transactions > should fetch bank transactions from Xero sandbox
 â†“ lib/xero/client.integration.test.ts > Xero Integration Tests (Manual Only) > End-to-End Integration Test > should complete full OAuth flow and fetch data
 âœ“ lib/xero/client.integration.test.ts > Xero Integration Tests - Setup Instructions > should show setup instructions when XERO_TEST is not set 2ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 1 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  __tests__/routers/toil-multi-tenant.test.ts [ __tests__/routers/toil-multi-tenant.test.ts ]
RangeError: Maximum call stack size exceeded
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/207]âŽ¯


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 206 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  __tests__/routers/activities.test.ts > app/server/routers/activities.ts > getActivityCounts > should accept valid input
AssertionError: promise rejected "TRPCError: activities is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/activities.test.ts:139:7
    137|           entityId: "550e8400-e29b-41d4-a716-446655440000",
    138|         }),
    139|       ).resolves.not.toThrow();
       |       ^
    140|     });
    141|   });

Caused by: TRPCError: activities is not iterable
 â¯ app/server/routers/activities.ts:125:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: activities is not iterable
 â¯ app/server/routers/activities.ts:125:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept empty input
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:46:50
     44|   describe("listPendingReviews", () => {
     45|     it("should accept empty input", async () => {
     46|       await expect(_caller.listPendingReviews({})).resolves.not.toThroâ€¦
       |                                                  ^
     47|     });
     48| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:46:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:46:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept status filter
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:52:7
     50|       await expect(
     51|         _caller.listPendingReviews({ status: "pending" }),
     52|       ).resolves.not.toThrow();
       |       ^
     53|     });
     54| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:50:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:50:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept pagination parameters
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:61:7
     59|           offset: 50,
     60|         }),
     61|       ).resolves.not.toThrow();
       |       ^
     62|     });
     63| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:56:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:56:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > listPendingReviews > should accept both pending and completed status
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:78:9
     76|         await expect(
     77|           _caller.listPendingReviews({ status }),
     78|         ).resolves.not.toThrow();
       |         ^
     79|       }
     80|     });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:76:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:95:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/admin-kyc.test.ts:76:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > getVerificationDetail > should accept valid verification ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:93:7
     91|           verificationId: "550e8400-e29b-41d4-a716-446655440000",
     92|         }),
     93|       ).resolves.not.toThrow();
       |       ^
     94|     });
     95|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:113:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:113:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > approveVerification > should accept valid approval data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:111:7
    109|           verificationId: "550e8400-e29b-41d4-a716-446655440000",
    110|         }),
    111|       ).resolves.not.toThrow();
       |       ^
    112|     });
    113| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:211:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:211:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > approveVerification > should accept optional notes
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:120:7
    118|           notes: "Verification approved after review",
    119|         }),
    120|       ).resolves.not.toThrow();
       |       ^
    121|     });
    122|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:211:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:211:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/207]âŽ¯

 FAIL  __tests__/routers/admin-kyc.test.ts > app/server/routers/admin-kyc.ts > rejectVerification > should accept valid rejection data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/admin-kyc.test.ts:135:7
    133|           reason: "Document does not match identity",
    134|         }),
    135|       ).resolves.not.toThrow();
       |       ^
    136|     });
    137| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:294:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/admin-kyc.ts:294:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineMetrics > should accept empty input
AssertionError: promise rejected "TRPCError: leadsByStage.reduce is not a fâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:102:49
    100|   describe("getPipelineMetrics", () => {
    101|     it("should accept empty input", async () => {
    102|       await expect(caller.getPipelineMetrics({})).resolves.not.toThrowâ€¦
       |                                                 ^
    103|     });
    104| 

Caused by: TRPCError: leadsByStage.reduce is not a function
 â¯ app/server/routers/analytics.ts:233:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:102:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: leadsByStage.reduce is not a function
 â¯ app/server/routers/analytics.ts:233:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:102:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineMetrics > should accept date range
AssertionError: promise rejected "TRPCError: leadsByStage.reduce is not a fâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:111:7
    109|           endDate: "2025-01-31",
    110|         }),
    111|       ).resolves.not.toThrow();
       |       ^
    112|     });
    113|   });

Caused by: TRPCError: leadsByStage.reduce is not a function
 â¯ app/server/routers/analytics.ts:233:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:106:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: leadsByStage.reduce is not a function
 â¯ app/server/routers/analytics.ts:233:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:106:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getModelComparison > should accept empty input
AssertionError: promise rejected "TRPCError: modelStats.find is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:117:49
    115|   describe("getModelComparison", () => {
    116|     it("should accept empty input", async () => {
    117|       await expect(caller.getModelComparison({})).resolves.not.toThrowâ€¦
       |                                                 ^
    118|     });
    119| 

Caused by: TRPCError: modelStats.find is not a function
 â¯ app/server/routers/analytics.ts:282:33
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: modelStats.find is not a function
 â¯ app/server/routers/analytics.ts:282:33
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getModelComparison > should accept date range
AssertionError: promise rejected "TRPCError: modelStats.find is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:126:7
    124|           endDate: "2025-01-31",
    125|         }),
    126|       ).resolves.not.toThrow();
       |       ^
    127|     });
    128|   });

Caused by: TRPCError: modelStats.find is not a function
 â¯ app/server/routers/analytics.ts:282:33
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: modelStats.find is not a function
 â¯ app/server/routers/analytics.ts:282:33
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept empty input
AssertionError: promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:132:51
    130|   describe("getServicePopularity", () => {
    131|     it("should accept empty input", async () => {
    132|       await expect(caller.getServicePopularity({})).resolves.not.toThrâ€¦
       |                                                   ^
    133|     });
    134| 

Caused by: TRPCError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:132:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:132:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept date range
AssertionError: promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:141:7
    139|           endDate: "2025-01-31",
    140|         }),
    141|       ).resolves.not.toThrow();
       |       ^
    142|     });
    143| 

Caused by: TRPCError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:136:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:136:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept limit parameter
AssertionError: promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:149:7
    147|           limit: 25,
    148|         }),
    149|       ).resolves.not.toThrow();
       |       ^
    150|     });
    151| 

Caused by: TRPCError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:145:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:145:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getServicePopularity > should accept all parameters combined
AssertionError: promise rejected "TRPCError: servicePopularity.map is not aâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:159:7
    157|           limit: 20,
    158|         }),
    159|       ).resolves.not.toThrow();
       |       ^
    160|     });
    161| 

Caused by: TRPCError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:153:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: servicePopularity.map is not a function
 â¯ app/server/routers/analytics.ts:344:56
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:153:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getDiscountAnalysis > should accept empty input
AssertionError: promise rejected "TRPCError: proposalsWithDiscounts is not â€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:181:50
    179|   describe("getDiscountAnalysis", () => {
    180|     it("should accept empty input", async () => {
    181|       await expect(caller.getDiscountAnalysis({})).resolves.not.toThroâ€¦
       |                                                  ^
    182|     });
    183| 

Caused by: TRPCError: proposalsWithDiscounts is not iterable
 â¯ app/server/routers/analytics.ts:393:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: proposalsWithDiscounts is not iterable
 â¯ app/server/routers/analytics.ts:393:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getDiscountAnalysis > should accept date range
AssertionError: promise rejected "TRPCError: proposalsWithDiscounts is not â€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:190:7
    188|           endDate: "2025-01-31",
    189|         }),
    190|       ).resolves.not.toThrow();
       |       ^
    191|     });
    192|   });

Caused by: TRPCError: proposalsWithDiscounts is not iterable
 â¯ app/server/routers/analytics.ts:393:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: proposalsWithDiscounts is not iterable
 â¯ app/server/routers/analytics.ts:393:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getComplexityDistribution > should accept empty input
AssertionError: promise rejected "TRPCError: proposalsWithMetadata is not iâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:206:56
    204|   describe("getComplexityDistribution", () => {
    205|     it("should accept empty input", async () => {
    206|       await expect(caller.getComplexityDistribution({})).resolves.not.â€¦
       |                                                        ^
    207|     });
    208| 

Caused by: TRPCError: proposalsWithMetadata is not iterable
 â¯ app/server/routers/analytics.ts:530:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: proposalsWithMetadata is not iterable
 â¯ app/server/routers/analytics.ts:530:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getComplexityDistribution > should accept date range
AssertionError: promise rejected "TRPCError: proposalsWithMetadata is not iâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:215:7
    213|           endDate: "2025-01-31",
    214|         }),
    215|       ).resolves.not.toThrow();
       |       ^
    216|     });
    217|   });

Caused by: TRPCError: proposalsWithMetadata is not iterable
 â¯ app/server/routers/analytics.ts:530:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: proposalsWithMetadata is not iterable
 â¯ app/server/routers/analytics.ts:530:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept empty input
AssertionError: promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:221:46
    219|   describe("getWinLossStats", () => {
    220|     it("should accept empty input", async () => {
    221|       await expect(caller.getWinLossStats({})).resolves.not.toThrow();
       |                                              ^
    222|     });
    223| 

Caused by: TRPCError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept date range
AssertionError: promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:230:7
    228|           to: "2025-01-31",
    229|         }),
    230|       ).resolves.not.toThrow();
       |       ^
    231|     });
    232| 

Caused by: TRPCError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept assignedToId filter
AssertionError: promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:238:7
    236|           assignedToId: "user-123",
    237|         }),
    238|       ).resolves.not.toThrow();
       |       ^
    239|     });
    240| 

Caused by: TRPCError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept clientId filter
AssertionError: promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:246:7
    244|           clientId: "550e8400-e29b-41d4-a716-446655440000",
    245|         }),
    246|       ).resolves.not.toThrow();
       |       ^
    247|     });
    248| 

Caused by: TRPCError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getWinLossStats > should accept all filters combined
AssertionError: promise rejected "TRPCError: stats.find is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:257:7
    255|           clientId: "550e8400-e29b-41d4-a716-446655440000",
    256|         }),
    257|       ).resolves.not.toThrow();
       |       ^
    258|     });
    259|   });

Caused by: TRPCError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stats.find is not a function
 â¯ app/server/routers/analytics.ts:912:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineValueByStage > should accept empty input
AssertionError: promise rejected "TRPCError: stageData.reduce is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:263:54
    261|   describe("getPipelineValueByStage", () => {
    262|     it("should accept empty input", async () => {
    263|       await expect(caller.getPipelineValueByStage({})).resolves.not.toâ€¦
       |                                                      ^
    264|     });
    265| 

Caused by: TRPCError: stageData.reduce is not a function
 â¯ app/server/routers/analytics.ts:959:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stageData.reduce is not a function
 â¯ app/server/routers/analytics.ts:959:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getPipelineValueByStage > should accept asOf date
AssertionError: promise rejected "TRPCError: stageData.reduce is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:271:7
    269|           asOf: "2025-01-31",
    270|         }),
    271|       ).resolves.not.toThrow();
       |       ^
    272|     });
    273|   });

Caused by: TRPCError: stageData.reduce is not a function
 â¯ app/server/routers/analytics.ts:959:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: stageData.reduce is not a function
 â¯ app/server/routers/analytics.ts:959:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getAverageDealSize > should accept empty input
AssertionError: promise rejected "TRPCError: byStage.map is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:277:49
    275|   describe("getAverageDealSize", () => {
    276|     it("should accept empty input", async () => {
    277|       await expect(caller.getAverageDealSize({})).resolves.not.toThrowâ€¦
       |                                                 ^
    278|     });
    279| 

Caused by: TRPCError: byStage.map is not a function
 â¯ app/server/routers/analytics.ts:1016:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:277:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: byStage.map is not a function
 â¯ app/server/routers/analytics.ts:1016:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:277:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getAverageDealSize > should accept date range
AssertionError: promise rejected "TRPCError: byStage.map is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:286:7
    284|           endDate: "2025-01-31",
    285|         }),
    286|       ).resolves.not.toThrow();
       |       ^
    287|     });
    288|   });

Caused by: TRPCError: byStage.map is not a function
 â¯ app/server/routers/analytics.ts:1016:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:281:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: byStage.map is not a function
 â¯ app/server/routers/analytics.ts:1016:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/analytics.test.ts:281:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getSalesCycleDuration > should accept empty input
AssertionError: promise rejected "TRPCError: wonProposals.map is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:292:52
    290|   describe("getSalesCycleDuration", () => {
    291|     it("should accept empty input", async () => {
    292|       await expect(caller.getSalesCycleDuration({})).resolves.not.toThâ€¦
       |                                                    ^
    293|     });
    294| 

Caused by: TRPCError: wonProposals.map is not a function
 â¯ app/server/routers/analytics.ts:1067:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: wonProposals.map is not a function
 â¯ app/server/routers/analytics.ts:1067:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getSalesCycleDuration > should accept date range
AssertionError: promise rejected "TRPCError: wonProposals.map is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:301:7
    299|           endDate: "2025-01-31",
    300|         }),
    301|       ).resolves.not.toThrow();
       |       ^
    302|     });
    303|   });

Caused by: TRPCError: wonProposals.map is not a function
 â¯ app/server/routers/analytics.ts:1067:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: wonProposals.map is not a function
 â¯ app/server/routers/analytics.ts:1067:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should accept empty input
AssertionError: promise rejected "TRPCError: monthlyData.map is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:307:46
    305|   describe("getMonthlyTrend", () => {
    306|     it("should accept empty input", async () => {
    307|       await expect(caller.getMonthlyTrend({})).resolves.not.toThrow();
       |                                              ^
    308|     });
    309| 

Caused by: TRPCError: monthlyData.map is not a function
 â¯ app/server/routers/analytics.ts:1140:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: monthlyData.map is not a function
 â¯ app/server/routers/analytics.ts:1140:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getMonthlyTrend > should accept months parameter
AssertionError: promise rejected "TRPCError: monthlyData.map is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:315:7
    313|           months: 6,
    314|         }),
    315|       ).resolves.not.toThrow();
       |       ^
    316|     });
    317| 

Caused by: TRPCError: monthlyData.map is not a function
 â¯ app/server/routers/analytics.ts:1140:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: monthlyData.map is not a function
 â¯ app/server/routers/analytics.ts:1140:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLossReasons > should accept empty input
AssertionError: promise rejected "TRPCError: lossData.reduce is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:337:45
    335|   describe("getLossReasons", () => {
    336|     it("should accept empty input", async () => {
    337|       await expect(caller.getLossReasons({})).resolves.not.toThrow();
       |                                             ^
    338|     });
    339| 

Caused by: TRPCError: lossData.reduce is not a function
 â¯ app/server/routers/analytics.ts:1179:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: lossData.reduce is not a function
 â¯ app/server/routers/analytics.ts:1179:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/207]âŽ¯

 FAIL  __tests__/routers/analytics.test.ts > app/server/routers/analytics.ts > getLossReasons > should accept date range
AssertionError: promise rejected "TRPCError: lossData.reduce is not a functâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/analytics.test.ts:346:7
    344|           endDate: "2025-01-31",
    345|         }),
    346|       ).resolves.not.toThrow();
       |       ^
    347|     });
    348|   });

Caused by: TRPCError: lossData.reduce is not a function
 â¯ app/server/routers/analytics.ts:1179:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: lossData.reduce is not a function
 â¯ app/server/routers/analytics.ts:1179:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > getEvent > should accept valid event ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:87:7
     85|           eventId: "550e8400-e29b-41d4-a716-446655440000",
     86|         }),
     87|       ).resolves.not.toThrow();
       |       ^
     88|     });
     89| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:91:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:91:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept valid event data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:116:7
    114|           endTime: new Date("2025-01-15T10:00:00Z"),
    115|         }),
    116|       ).resolves.not.toThrow();
       |       ^
    117|     });
    118| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept optional fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:135:7
    133|           attendeeIds: ["770e8400-e29b-41d4-a716-446655440000"],
    134|         }),
    135|       ).resolves.not.toThrow();
       |       ^
    136|     });
    137| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > createEvent > should accept all-day events
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:147:7
    145|           allDay: true,
    146|         }),
    147|       ).resolves.not.toThrow();
       |       ^
    148|     });
    149|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:178:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > updateEvent > should accept valid update data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:166:7
    164|           title: "Updated Meeting Title",
    165|         }),
    166|       ).resolves.not.toThrow();
       |       ^
    167|     });
    168| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:241:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:241:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > updateEvent > should accept partial updates
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:176:7
    174|           reminderMinutes: 30,
    175|         }),
    176|       ).resolves.not.toThrow();
       |       ^
    177|     });
    178|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:241:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:241:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > deleteEvent > should accept valid event ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:192:7
    190|           eventId: "550e8400-e29b-41d4-a716-446655440000",
    191|         }),
    192|       ).resolves.not.toThrow();
       |       ^
    193|     });
    194|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:300:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:300:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > respondToInvitation > should accept valid response data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:211:7
    209|           status: "accepted" as const,
    210|         }),
    211|       ).resolves.not.toThrow();
       |       ^
    212|     });
    213| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:346:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:346:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > respondToInvitation > should accept all status values
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:223:9
    221|             status,
    222|           }),
    223|         ).resolves.not.toThrow();
       |         ^
    224|       }
    225|     });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:346:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:346:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > addAttendee > should accept valid attendee data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:243:7
    241|           userId: "660e8400-e29b-41d4-a716-446655440000",
    242|         }),
    243|       ).resolves.not.toThrow();
       |       ^
    244|     });
    245| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:396:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:396:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > addAttendee > should accept optional isOptional field
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:253:7
    251|           isOptional: true,
    252|         }),
    253|       ).resolves.not.toThrow();
       |       ^
    254|     });
    255|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:396:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:396:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/207]âŽ¯

 FAIL  __tests__/routers/calendar.test.ts > app/server/routers/calendar.ts > removeAttendee > should accept valid removal data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/calendar.test.ts:272:7
    270|           userId: "660e8400-e29b-41d4-a716-446655440000",
    271|         }),
    272|       ).resolves.not.toThrow();
       |       ^
    273|     });
    274|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:449:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/calendar.ts:449:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept valid input without status
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:84:52
     82|       };
     83| 
     84|       await expect(_caller.getProposals(validInput)).resolves.not.toThâ€¦
       |                                                    ^
     85|     });
     86| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept valid input with status
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:93:52
     91|       };
     92| 
     93|       await expect(_caller.getProposals(validInput)).resolves.not.toThâ€¦
       |                                                    ^
     94|     });
     95| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposals > should accept all valid status values
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:116:9
    114|             status: status as unknown as "sent",
    115|           }),
    116|         ).resolves.not.toThrow();
       |         ^
    117|       }
    118|     });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getProposalById > should accept valid proposal ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:137:55
    135|       };
    136| 
    137|       await expect(_caller.getProposalById(validInput)).resolves.not.tâ€¦
       |                                                       ^
    138|     });
    139|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept valid input without status
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:158:51
    156|       };
    157| 
    158|       await expect(_caller.getInvoices(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    159|     });
    160| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept valid input with status
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:167:51
    165|       };
    166| 
    167|       await expect(_caller.getInvoices(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    168|     });
    169| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoices > should accept all valid status values
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:190:9
    188|             status: status as unknown as "sent",
    189|           }),
    190|         ).resolves.not.toThrow();
       |         ^
    191|       }
    192|     });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getInvoiceById > should accept valid invoice ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:211:54
    209|       };
    210| 
    211|       await expect(_caller.getInvoiceById(validInput)).resolves.not.toâ€¦
       |                                                      ^
    212|     });
    213|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocuments > should accept valid client ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:231:52
    229|       };
    230| 
    231|       await expect(_caller.getDocuments(validInput)).resolves.not.toThâ€¦
       |                                                    ^
    232|     });
    233|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getDocumentsToSign > should accept valid client ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:253:7
    251|       await expect(
    252|         _caller.getDocumentsToSign(validInput),
    253|       ).resolves.not.toThrow();
       |       ^
    254|     });
    255|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getSignedDocuments > should accept valid client ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:275:7
    273|       await expect(
    274|         _caller.getSignedDocuments(validInput),
    275|       ).resolves.not.toThrow();
       |       ^
    276|     });
    277|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMyThreads > should accept valid client ID
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:295:53
    293|       };
    294| 
    295|       await expect(_caller.listMyThreads(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    296|     });
    297|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > getThread > should accept valid thread and client IDs
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:316:49
    314|       };
    315| 
    316|       await expect(_caller.getThread(validInput)).resolves.not.toThrowâ€¦
       |                                                 ^
    317|     });
    318|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > listMessages > should accept valid input with defaults
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:338:52
    336|       };
    337| 
    338|       await expect(_caller.listMessages(validInput)).resolves.not.toThâ€¦
       |                                                    ^
    339|     });
    340| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept valid message data
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:391:51
    389|       };
    390| 
    391|       await expect(_caller.sendMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    392|     });
    393| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept file type
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:422:51
    420|       };
    421| 
    422|       await expect(_caller.sendMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    423|     });
    424| 

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > sendMessage > should accept message without metadata
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:433:51
    431|       };
    432| 
    433|       await expect(_caller.sendMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    434|     });
    435|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/207]âŽ¯

 FAIL  __tests__/routers/clientPortal.test.ts > app/server/routers/clientPortal.ts > markThreadAsRead > should accept valid thread and client IDs
AssertionError: promise rejected "TRPCError: Client portal authentication râ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortal.test.ts:454:56
    452|       };
    453| 
    454|       await expect(_caller.markThreadAsRead(validInput)).resolves.not.â€¦
       |                                                        ^
    455|     });
    456|   });

Caused by: TRPCError: Client portal authentication required
 â¯ app/server/trpc.ts:104:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'UNAUTHORIZED' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept valid invitation data
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:71:54
     69|       };
     70| 
     71|       await expect(_caller.sendInvitation(validInput)).resolves.not.toâ€¦
       |                                                      ^
     72|     });
     73| 

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:71:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:71:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept all valid role values
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:150:9
    148|             role: role as unknown as "viewer",
    149|           }),
    150|         ).resolves.not.toThrow();
       |         ^
    151|       }
    152|     });

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:142:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:142:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > sendInvitation > should accept optional message
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:164:54
    162|       };
    163| 
    164|       await expect(_caller.sendInvitation(validInput)).resolves.not.toâ€¦
       |                                                      ^
    165|     });
    166|   });

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:164:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:141:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:164:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > resendInvitation > should accept valid invitation ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:220:56
    218|       };
    219| 
    220|       await expect(_caller.resendInvitation(validInput)).resolves.not.â€¦
       |                                                        ^
    221|     });
    222|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/clientPortalAdmin.ts:203:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/clientPortalAdmin.ts:203:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > revokeInvitation > should accept valid invitation ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:240:56
    238|       };
    239| 
    240|       await expect(_caller.revokeInvitation(validInput)).resolves.not.â€¦
       |                                                        ^
    241|     });
    242|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/clientPortalAdmin.ts:289:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/clientPortalAdmin.ts:289:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept valid access grant data
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:273:51
    271|       };
    272| 
    273|       await expect(_caller.grantAccess(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    274|     });
    275| 

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:273:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:273:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept optional expiresAt
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:284:51
    282|       };
    283| 
    284|       await expect(_caller.grantAccess(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    285|     });
    286| 

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:284:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:284:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/207]âŽ¯

 FAIL  __tests__/routers/clientPortalAdmin.test.ts > app/server/routers/clientPortalAdmin.ts > grantAccess > should accept all valid role values
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/clientPortalAdmin.test.ts:309:9
    307|             role: role as unknown as "viewer",
    308|           }),
    309|         ).resolves.not.toThrow();
       |         ^
    310|       }
    311|     });

Caused by: TRPCError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:303:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'id')
 â¯ app/server/routers/clientPortalAdmin.ts:448:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/clientPortalAdmin.test.ts:303:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should accept empty input
AssertionError: promise rejected "TRPCError: logs.reverse is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:60:47
     58|   describe("getActivityLogs", () => {
     59|     it("should accept empty input", async () => {
     60|       await expect(_caller.getActivityLogs({})).resolves.not.toThrow();
       |                                               ^
     61|     });
     62| 

Caused by: TRPCError: logs.reverse is not a function
 â¯ app/server/routers/invitations.ts:183:19
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: logs.reverse is not a function
 â¯ app/server/routers/invitations.ts:183:19
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > getActivityLogs > should accept limit parameter
AssertionError: promise rejected "TRPCError: logs.reverse is not a function { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:68:7
     66|           limit: 10,
     67|         }),
     68|       ).resolves.not.toThrow();
       |       ^
     69|     });
     70| 

Caused by: TRPCError: logs.reverse is not a function
 â¯ app/server/routers/invitations.ts:183:19
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: logs.reverse is not a function
 â¯ app/server/routers/invitations.ts:183:19
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept valid invitation data
AssertionError: promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:123:44
    121|       };
    122| 
    123|       await expect(_caller.send(validInput)).resolves.not.toThrow();
       |                                            ^
    124|     });
    125| 

Caused by: TRPCError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept custom message
AssertionError: promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:133:44
    131|       };
    132| 
    133|       await expect(_caller.send(validInput)).resolves.not.toThrow();
       |                                            ^
    134|     });
    135| 

Caused by: TRPCError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > send > should accept all valid role values
AssertionError: promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:156:9
    154|             role,
    155|           }),
    156|         ).resolves.not.toThrow();
       |         ^
    157|       }
    158|     });

Caused by: TRPCError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: db.select(...).from(...).where(...).then is not a function
 â¯ checkRateLimits app/server/routers/invitations.ts:62:6
 â¯ app/server/routers/invitations.ts:222:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > verify > should accept valid token
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:186:46
    184|       };
    185| 
    186|       await expect(_caller.verify(validInput)).resolves.not.toThrow();
       |                                              ^
    187|     });
    188|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:334:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:334:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should accept valid acceptance data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:208:46
    206|       };
    207| 
    208|       await expect(_caller.accept(validInput)).resolves.not.toThrow();
       |                                              ^
    209|     });
    210| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:385:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:385:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > accept > should accept optional name fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:219:46
    217|       };
    218| 
    219|       await expect(_caller.accept(validInput)).resolves.not.toThrow();
       |                                              ^
    220|     });
    221| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:385:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:385:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > resend > should accept valid invitation ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:248:46
    246|       };
    247| 
    248|       await expect(_caller.resend(validInput)).resolves.not.toThrow();
       |                                              ^
    249|     });
    250| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:501:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:501:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/207]âŽ¯

 FAIL  __tests__/routers/invitations.test.ts > app/server/routers/invitations.ts > cancel > should accept valid invitation ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/invitations.test.ts:278:46
    276|       };
    277| 
    278|       await expect(_caller.cancel(validInput)).resolves.not.toThrow();
       |                                              ^
    279|     });
    280|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:581:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/invitations.ts:581:28
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/207]âŽ¯

 FAIL  __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should generate PDF for valid invoice
 FAIL  __tests__/routers/invoices.test.ts > app/server/routers/invoices.ts (Integration) > generatePdf (GAP-004) > should log activity when PDF is generated
TRPCError: Failed to generate PDF: React is not defined
 â¯ generateInvoicePdf lib/pdf/generate-invoice-pdf.tsx:145:11
    143|   } catch (error) {
    144|     console.error("Error generating invoice PDF:", error);
    145|     throw new Error(
       |           ^
    146|       `Failed to generate PDF: ${error instanceof Error ? error.messagâ€¦
    147|     );
 â¯ app/server/routers/invoices.ts:618:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: Error: Failed to generate PDF: React is not defined
 â¯ generateInvoicePdf lib/pdf/generate-invoice-pdf.tsx:145:11
 â¯ app/server/routers/invoices.ts:618:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > getById > should accept valid UUID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:96:44
     94|       const validId = "550e8400-e29b-41d4-a716-446655440000";
     95| 
     96|       await expect(_caller.getById(validId)).resolves.not.toThrow();
       |                                            ^
     97|     });
     98| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:386:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:386:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept valid lead data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:126:46
    124|       };
    125| 
    126|       await expect(_caller.create(validInput)).resolves.not.toThrow();
       |                                              ^
    127|     });
    128| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept any string as email
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:140:7
    138|       await expect(
    139|         _caller.create(validInput as Record<string, unknown>),
    140|       ).resolves.not.toThrow();
       |       ^
    141|     });
    142| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > create > should accept optional fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:155:7
    153|       await expect(
    154|         _caller.create(validInput as Record<string, unknown>),
    155|       ).resolves.not.toThrow();
       |       ^
    156|     });
    157|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:442:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > update > should accept valid update data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:180:46
    178|       };
    179| 
    180|       await expect(_caller.update(validInput)).resolves.not.toThrow();
       |                                              ^
    181|     });
    182| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:488:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:488:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > delete > should accept valid lead ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:199:43
    197|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    198| 
    199|       await expect(_caller.delete(validId)).resolves.not.toThrow();
       |                                           ^
    200|     });
    201| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:540:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:540:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > assignLead > should accept valid assignment data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:225:50
    223|       };
    224| 
    225|       await expect(_caller.assignLead(validInput)).resolves.not.toThroâ€¦
       |                                                  ^
    226|     });
    227|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:588:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:588:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > scheduleFollowUp > should accept valid follow-up data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:248:56
    246|       };
    247| 
    248|       await expect(_caller.scheduleFollowUp(validInput)).resolves.not.â€¦
       |                                                        ^
    249|     });
    250| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:639:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:639:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > scheduleFollowUp > should validate nextFollowUpAt is a string
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:257:56
    255|       };
    256| 
    257|       await expect(_caller.scheduleFollowUp(validInput)).resolves.not.â€¦
       |                                                        ^
    258|     });
    259|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:639:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:639:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/207]âŽ¯

 FAIL  __tests__/routers/leads.test.ts > app/server/routers/leads.ts > convertToClient > should accept valid conversion data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/leads.test.ts:273:7
    271|       await expect(
    272|         _caller.convertToClient(validInput as Record<string, unknown>),
    273|       ).resolves.not.toThrow();
       |       ^
    274|     });
    275| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:713:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/leads.ts:713:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: privacy
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:52:7
     50|       await expect(
     51|         _caller.getByType({ pageType: "privacy" }),
     52|       ).resolves.not.toThrow();
       |       ^
     53|     });
     54| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: terms
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:58:7
     56|       await expect(
     57|         _caller.getByType({ pageType: "terms" }),
     58|       ).resolves.not.toThrow();
       |       ^
     59|     });
     60| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getByType > should accept valid pageType: cookie_policy
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:64:7
     62|       await expect(
     63|         _caller.getByType({ pageType: "cookie_policy" }),
     64|       ).resolves.not.toThrow();
       |       ^
     65|     });
     66| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/legal.ts:29:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should accept valid input with pageType and content
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:95:7
     93|           content: "# Privacy Policy\n\nThis is the privacy policy conâ€¦
     94|         }),
     95|       ).resolves.not.toThrow();
       |       ^
     96|     });
     97| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > update > should accept markdown formatted content
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:119:7
    117| **Bold text** and *italic text*`,
    118|         }),
    119|       ).resolves.not.toThrow();
       |       ^
    120|     });
    121|   });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > getVersionHistory > should accept valid pageType
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:133:7
    131|       await expect(
    132|         _caller.getVersionHistory({ pageType: "privacy" }),
    133|       ).resolves.not.toThrow();
       |       ^
    134|     });
    135| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > version tracking > update input should accept content that will be versioned
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:185:41
    183|       };
    184| 
    185|       await expect(_caller.update(input)).resolves.not.toThrow();
       |                                         ^
    186|     });
    187|   });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should accept long content for update
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:209:7
    207|           content: longContent,
    208|         }),
    209|       ).resolves.not.toThrow();
       |       ^
    210|     });
    211| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/207]âŽ¯

 FAIL  __tests__/routers/legal.test.ts > app/server/routers/legal.ts > input validation edge cases > should handle special characters in content
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/legal.test.ts:223:7
    221|           content: specialContent,
    222|         }),
    223|       ).resolves.not.toThrow();
       |       ^
    224|     });
    225|   });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > getThread > should accept valid thread ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:63:49
     61|       };
     62| 
     63|       await expect(_caller.getThread(validInput)).resolves.not.toThrowâ€¦
       |                                                 ^
     64|     });
     65| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:96:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:96:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createDirectMessage > should accept valid participant list
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:95:7
     93|       await expect(
     94|         _caller.createDirectMessage(validInput),
     95|       ).resolves.not.toThrow();
       |       ^
     96|     });
     97| 

Caused by: TRPCError: Cannot read properties of undefined (reading 'length')
 â¯ app/server/routers/messages.ts:193:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'length')
 â¯ app/server/routers/messages.ts:193:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createChannel > should accept valid channel data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:137:53
    135|       };
    136| 
    137|       await expect(_caller.createChannel(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    138|     });
    139| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:253:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:253:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createChannel > should accept optional fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:151:53
    149|       };
    150| 
    151|       await expect(_caller.createChannel(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    152|     });
    153|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:253:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:253:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createClientThread > should accept valid client thread data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:175:7
    173|       await expect(
    174|         _caller.createClientThread(validInput),
    175|       ).resolves.not.toThrow();
       |       ^
    176|     });
    177| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:306:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:306:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > createClientThread > should accept optional initial message
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:187:7
    185|       await expect(
    186|         _caller.createClientThread(validInput),
    187|       ).resolves.not.toThrow();
       |       ^
    188|     });
    189|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:306:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:306:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > addParticipant > should accept valid participant data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:209:54
    207|       };
    208| 
    209|       await expect(_caller.addParticipant(validInput)).resolves.not.toâ€¦
       |                                                      ^
    210|     });
    211|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:464:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:464:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > removeParticipant > should accept valid removal data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:233:7
    231|       await expect(
    232|         _caller.removeParticipant(validInput),
    233|       ).resolves.not.toThrow();
       |       ^
    234|     });
    235|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:528:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:528:36
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should accept valid thread ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:254:52
    252|       };
    253| 
    254|       await expect(_caller.listMessages(validInput)).resolves.not.toThâ€¦
       |                                                    ^
    255|     });
    256| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:580:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:580:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > listMessages > should accept pagination parameters
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:264:52
    262|       };
    263| 
    264|       await expect(_caller.listMessages(validInput)).resolves.not.toThâ€¦
       |                                                    ^
    265|     });
    266| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:580:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:580:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should accept valid message data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:297:51
    295|       };
    296| 
    297|       await expect(_caller.sendMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    298|     });
    299| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:673:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:673:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > sendMessage > should accept optional fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:309:51
    307|       };
    308| 
    309|       await expect(_caller.sendMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    310|     });
    311| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:673:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:673:29
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > editMessage > should accept valid edit data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:353:51
    351|       };
    352| 
    353|       await expect(_caller.editMessage(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    354|     });
    355|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:734:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:734:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/207]âŽ¯

 FAIL  __tests__/routers/messages.test.ts > app/server/routers/messages.ts > deleteMessage > should accept valid message ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/messages.test.ts:363:53
    361|       };
    362| 
    363|       await expect(_caller.deleteMessage(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    364|     });
    365| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:776:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/messages.ts:776:25
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/207]âŽ¯

 FAIL  __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > markAsRead > should accept valid notification ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/notifications.test.ts:108:50
    106|       };
    107| 
    108|       await expect(_caller.markAsRead(validInput)).resolves.not.toThroâ€¦
       |                                                  ^
    109|     });
    110| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:70:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:70:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/207]âŽ¯

 FAIL  __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > delete > should accept valid notification ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/notifications.test.ts:148:46
    146|       };
    147| 
    148|       await expect(_caller.delete(validInput)).resolves.not.toThrow();
       |                                              ^
    149|     });
    150|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:126:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:126:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/207]âŽ¯

 FAIL  __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > create > should accept valid notification data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/notifications.test.ts:172:46
    170|       };
    171| 
    172|       await expect(_caller.create(validInput)).resolves.not.toThrow();
       |                                              ^
    173|     });
    174| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:171:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:171:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/207]âŽ¯

 FAIL  __tests__/routers/notifications.test.ts > app/server/routers/notifications.ts > create > should accept optional fields
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/notifications.test.ts:187:46
    185|       };
    186| 
    187|       await expect(_caller.create(validInput)).resolves.not.toThrow();
       |                                              ^
    188|     });
    189|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:171:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/notifications.ts:171:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/207]âŽ¯

 FAIL  __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept valid calculation input
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricing.test.ts:56:48
     54|       };
     55| 
     56|       await expect(caller.calculate(validInput)).resolves.not.toThrow(â€¦
       |                                                ^
     57|     });
     58| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[124/207]âŽ¯

 FAIL  __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept service with configuration
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricing.test.ts:74:48
     72|       };
     73| 
     74|       await expect(caller.calculate(validInput)).resolves.not.toThrow(â€¦
       |                                                ^
     75|     });
     76| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[125/207]âŽ¯

 FAIL  __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept transaction data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricing.test.ts:92:48
     90|       };
     91| 
     92|       await expect(caller.calculate(validInput)).resolves.not.toThrow(â€¦
       |                                                ^
     93|     });
     94| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[126/207]âŽ¯

 FAIL  __tests__/routers/pricing.test.ts > app/server/routers/pricing.ts > calculate > should accept modifiers
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricing.test.ts:111:48
    109|       };
    110| 
    111|       await expect(caller.calculate(validInput)).resolves.not.toThrow(â€¦
       |                                                ^
    112|     });
    113| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ calculateModelA app/server/routers/pricing.ts:265:25
 â¯ app/server/routers/pricing.ts:632:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[127/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > getComponent > should accept valid component ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:69:48
     67|       const validId = "550e8400-e29b-41d4-a716-446655440000";
     68| 
     69|       await expect(caller.getComponent(validId)).resolves.not.toThrow(â€¦
       |                                                ^
     70|     });
     71| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:53:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:53:27
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[128/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createComponent > should accept valid component data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:97:54
     95|       };
     96| 
     97|       await expect(caller.createComponent(validInput)).resolves.not.toâ€¦
       |                                                      ^
     98|     });
     99|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:76:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:76:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[129/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateComponent > should accept valid update data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:122:54
    120|       };
    121| 
    122|       await expect(caller.updateComponent(validInput)).resolves.not.toâ€¦
       |                                                      ^
    123|     });
    124| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:127:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:127:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[130/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateComponent > should accept partial updates
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:133:54
    131|       };
    132| 
    133|       await expect(caller.updateComponent(validInput)).resolves.not.toâ€¦
       |                                                      ^
    134|     });
    135|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:127:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:127:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[131/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > deleteComponent > should accept valid component ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:141:51
    139|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    140| 
    141|       await expect(caller.deleteComponent(validId)).resolves.not.toThrâ€¦
       |                                                   ^
    142|     });
    143| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:194:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:194:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[132/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > cloneComponent > should accept valid clone data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:166:53
    164|       };
    165| 
    166|       await expect(caller.cloneComponent(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    167|     });
    168|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:272:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:272:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[133/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > createRule > should accept valid rule data
AssertionError: promise rejected "TRPCError: [
  {
    "expected": "string"â€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:242:49
    240|       };
    241| 
    242|       await expect(caller.createRule(validInput)).resolves.not.toThrowâ€¦
       |                                                 ^
    243|     });
    244|   });

Caused by: TRPCError: [
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:191:15
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/pricingAdmin.test.ts:242:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'BAD_REQUEST' }
Caused by: ZodError: [
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:189:29
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { _zod: { traits: { constructor: 'Function<Set>', has: 'Function<has>', add: 'Function<add>', delete: 'Function<delete>', clear: 'Function<clear>', entries: 'Function<entries>', forEach: 'Function<forEach>', size: 2, values: 'Function<values>', keys: 'Function<values>', union: 'Function<union>', intersection: 'Function<intersection>', difference: 'Function<difference>', symmetricDifference: 'Function<symmetricDifference>', isSubsetOf: 'Function<isSubsetOf>', isSupersetOf: 'Function<isSupersetOf>', isDisjointFrom: 'Function<isDisjointFrom>' }, constr: 'Function<ZodError>', def: [ { expected: 'string', code: 'invalid_type', path: [ 'componentId' ], message: 'Invalid input: expected string, received undefined' } ], deferred: [] }, issues: [ { expected: 'string', code: 'invalid_type', path: [ 'componentId' ], message: 'Invalid input: expected string, received undefined' } ], format: 'Function<value>', flatten: 'Function<value>', addIssue: 'Function<value>', addIssues: 'Function<value>', isEmpty: false }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[134/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > updateRule > should accept valid update data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:267:49
    265|       };
    266| 
    267|       await expect(caller.updateRule(validInput)).resolves.not.toThrowâ€¦
       |                                                 ^
    268|     });
    269|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:528:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:528:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[135/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > deleteRule > should accept valid rule ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:275:46
    273|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    274| 
    275|       await expect(caller.deleteRule(validId)).resolves.not.toThrow();
       |                                              ^
    276|     });
    277|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:593:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/pricingAdmin.ts:593:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[136/207]âŽ¯

 FAIL  __tests__/routers/pricingAdmin.test.ts > app/server/routers/pricingAdmin.ts > bulkCreateRules > should accept array of valid rules
AssertionError: promise rejected "TRPCError: [
  {
    "expected": "string"â€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingAdmin.test.ts:300:54
    298|       ];
    299| 
    300|       await expect(caller.bulkCreateRules(validInput)).resolves.not.toâ€¦
       |                                                      ^
    301|     });
    302| 

Caused by: TRPCError: [
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      1,
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:191:15
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/pricingAdmin.test.ts:300:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'BAD_REQUEST' }
Caused by: ZodError: [
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      1,
      "componentId"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:189:29
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { _zod: { traits: { constructor: 'Function<Set>', has: 'Function<has>', add: 'Function<add>', delete: 'Function<delete>', clear: 'Function<clear>', entries: 'Function<entries>', forEach: 'Function<forEach>', size: 2, values: 'Function<values>', keys: 'Function<values>', union: 'Function<union>', intersection: 'Function<intersection>', difference: 'Function<difference>', symmetricDifference: 'Function<symmetricDifference>', isSubsetOf: 'Function<isSubsetOf>', isSupersetOf: 'Function<isSupersetOf>', isDisjointFrom: 'Function<isDisjointFrom>' }, constr: 'Function<ZodError>', def: [ { expected: 'string', code: 'invalid_type', path: [ +0, 'componentId' ], message: 'Invalid input: expected string, received undefined' }, { expected: 'string', code: 'invalid_type', path: [ 1, 'componentId' ], message: 'Invalid input: expected string, received undefined' } ], deferred: [] }, issues: [ { expected: 'string', code: 'invalid_type', path: [ +0, 'componentId' ], message: 'Invalid input: expected string, received undefined' }, { expected: 'string', code: 'invalid_type', path: [ 1, 'componentId' ], message: 'Invalid input: expected string, received undefined' } ], format: 'Function<value>', flatten: 'Function<value>', addIssue: 'Function<value>', addIssues: 'Function<value>', isEmpty: false }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[137/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should accept valid Model A multipliers
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:74:7
     72|       await expect(
     73|         caller.updateComplexityMultipliers(validInput),
     74|       ).resolves.not.toThrow();
       |       ^
     75|     });
     76| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[138/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateComplexityMultipliers > should accept valid Model B multipliers
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:90:7
     88|       await expect(
     89|         caller.updateComplexityMultipliers(validInput),
     90|       ).resolves.not.toThrow();
       |       ^
     91|     });
     92| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[139/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateIndustryMultipliers > should accept valid industry multipliers
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:166:7
    164|       await expect(
    165|         caller.updateIndustryMultipliers(validInput),
    166|       ).resolves.not.toThrow();
       |       ^
    167|     });
    168| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[140/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateDiscountRules > should accept valid discount rules
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:225:7
    223|       await expect(
    224|         caller.updateDiscountRules(validInput),
    225|       ).resolves.not.toThrow();
       |       ^
    226|     });
    227| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[141/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept valid global settings
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:312:7
    310|       await expect(
    311|         caller.updateGlobalSettings(validInput),
    312|       ).resolves.not.toThrow();
       |       ^
    313|     });
    314| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[142/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept all valid industry values
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:351:9
    349|             taxRate: 0,
    350|           }),
    351|         ).resolves.not.toThrow();
       |         ^
    352|       }
    353|     });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[143/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > updateGlobalSettings > should accept all valid rounding rules
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:367:9
    365|             taxRate: 0,
    366|           }),
    367|         ).resolves.not.toThrow();
       |         ^
    368|       }
    369|     });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[144/207]âŽ¯

 FAIL  __tests__/routers/pricingConfig.test.ts > app/server/routers/pricingConfig.ts > importConfig > should accept valid configuration import
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/pricingConfig.test.ts:460:51
    458|       };
    459| 
    460|       await expect(caller.importConfig(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    461|     });
    462|   });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[145/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept search parameter
AssertionError: promise rejected "TRPCError: templates.filter is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:70:51
     68| 
     69|     it("should accept search parameter", async () => {
     70|       await expect(caller.list({ search: "test" })).resolves.not.toThrâ€¦
       |                                                   ^
     71|     });
     72| 

Caused by: TRPCError: templates.filter is not a function
 â¯ app/server/routers/proposalTemplates.ts:67:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: templates.filter is not a function
 â¯ app/server/routers/proposalTemplates.ts:67:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[146/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > list > should accept all filters combined
AssertionError: promise rejected "TRPCError: templates.filter is not a funcâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:80:7
     78|           search: "test template",
     79|         }),
     80|       ).resolves.not.toThrow();
       |       ^
     81|     });
     82|   });

Caused by: TRPCError: templates.filter is not a function
 â¯ app/server/routers/proposalTemplates.ts:67:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: templates.filter is not a function
 â¯ app/server/routers/proposalTemplates.ts:67:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[147/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > getById > should accept valid UUID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:87:43
     85|     it("should accept valid UUID", async () => {
     86|       const validId = "550e8400-e29b-41d4-a716-446655440000";
     87|       await expect(caller.getById(validId)).resolves.not.toThrow();
       |                                           ^
     88|     });
     89| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposalTemplates.ts:83:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposalTemplates.ts:83:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[148/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept valid template data with minimal fields
AssertionError: promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:106:44
    104|       };
    105| 
    106|       await expect(caller.create(validData)).resolves.not.toThrow();
       |                                            ^
    107|     });
    108| 

Caused by: TRPCError: Failed to create template
 â¯ app/server/routers/proposalTemplates.ts:164:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/proposalTemplates.test.ts:106:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[149/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept valid template data with all fields
AssertionError: promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:127:44
    125|       };
    126| 
    127|       await expect(caller.create(validData)).resolves.not.toThrow();
       |                                            ^
    128|     });
    129| 

Caused by: TRPCError: Failed to create template
 â¯ app/server/routers/proposalTemplates.ts:164:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/proposalTemplates.test.ts:127:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[150/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > create > should accept service config as optional
AssertionError: promise rejected "TRPCError: Failed to create template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:170:44
    168|       };
    169| 
    170|       await expect(caller.create(validData)).resolves.not.toThrow();
       |                                            ^
    171|     });
    172|   });

Caused by: TRPCError: Failed to create template
 â¯ app/server/routers/proposalTemplates.ts:164:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/proposalTemplates.test.ts:170:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[151/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept partial update data
AssertionError: promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:183:44
    181|       };
    182| 
    183|       await expect(caller.update(validData)).resolves.not.toThrow();
       |                                            ^
    184|     });
    185| 

Caused by: TRPCError: Failed to update template
 â¯ app/server/routers/proposalTemplates.ts:248:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[152/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept updating multiple fields
AssertionError: promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:197:44
    195|       };
    196| 
    197|       await expect(caller.update(validData)).resolves.not.toThrow();
       |                                            ^
    198|     });
    199| 

Caused by: TRPCError: Failed to update template
 â¯ app/server/routers/proposalTemplates.ts:248:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[153/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept updating services
AssertionError: promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:211:44
    209|       };
    210| 
    211|       await expect(caller.update(validData)).resolves.not.toThrow();
       |                                            ^
    212|     });
    213| 

Caused by: TRPCError: Failed to update template
 â¯ app/server/routers/proposalTemplates.ts:248:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[154/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > update > should accept empty data object
AssertionError: promise rejected "TRPCError: Failed to update template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:231:44
    229|       };
    230| 
    231|       await expect(caller.update(validData)).resolves.not.toThrow();
       |                                            ^
    232|     });
    233|   });

Caused by: TRPCError: Failed to update template
 â¯ app/server/routers/proposalTemplates.ts:248:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[155/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > delete > should accept valid UUID
AssertionError: promise rejected "TRPCError: Failed to delete template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:238:42
    236|     it("should accept valid UUID", async () => {
    237|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    238|       await expect(caller.delete(validId)).resolves.not.toThrow();
       |                                          ^
    239|     });
    240| 

Caused by: TRPCError: Failed to delete template
 â¯ app/server/routers/proposalTemplates.ts:301:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[156/207]âŽ¯

 FAIL  __tests__/routers/proposalTemplates.test.ts > app/server/routers/proposalTemplates.ts > setDefault > should accept valid UUID
AssertionError: promise rejected "TRPCError: Failed to set default template { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposalTemplates.test.ts:249:46
    247|     it("should accept valid UUID", async () => {
    248|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    249|       await expect(caller.setDefault(validId)).resolves.not.toThrow();
       |                                              ^
    250|     });
    251| 

Caused by: TRPCError: Failed to set default template
 â¯ app/server/routers/proposalTemplates.ts:364:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/proposalTemplates.test.ts:249:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[157/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > getById > should accept valid UUID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:87:43
     85|       const validId = "550e8400-e29b-41d4-a716-446655440000";
     86| 
     87|       await expect(caller.getById(validId)).resolves.not.toThrow();
       |                                           ^
     88|     });
     89| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:309:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:309:26
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[158/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > create > should accept valid proposal data
AssertionError: promise rejected "TRPCError: db.transâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:119:45
    117|       };
    118| 
    119|       await expect(caller.create(validInput)).resolves.not.toThrow();
       |                                             ^
    120|     });
    121| 

Caused by: TRPCError: db.transaction is not a function
 â¯ app/server/routers/proposals.ts:382:31
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: db.transaction is not a function
 â¯ app/server/routers/proposals.ts:382:31
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[159/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > createFromLead > should accept valid lead ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:142:53
    140|       };
    141| 
    142|       await expect(caller.createFromLead(validInput)).resolves.not.toTâ€¦
       |                                                     ^
    143|     });
    144| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:451:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:451:22
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[160/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > update > should accept valid update data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:175:45
    173|       };
    174| 
    175|       await expect(caller.update(validInput)).resolves.not.toThrow();
       |                                             ^
    176|     });
    177| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:560:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:560:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[161/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > update > should accept partial updates
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:186:45
    184|       };
    185| 
    186|       await expect(caller.update(validInput)).resolves.not.toThrow();
       |                                             ^
    187|     });
    188|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:560:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:560:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[162/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > delete > should accept valid proposal ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:194:42
    192|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    193| 
    194|       await expect(caller.delete(validId)).resolves.not.toThrow();
       |                                          ^
    195|     });
    196| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:760:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:760:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[163/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > send > should accept valid send data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:222:43
    220|       };
    221| 
    222|       await expect(caller.send(validInput)).resolves.not.toThrow();
       |                                           ^
    223|     });
    224| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:808:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:808:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[164/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > trackView > should accept valid proposal ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:241:45
    239|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    240| 
    241|       await expect(caller.trackView(validId)).resolves.not.toThrow();
       |                                             ^
    242|     });
    243| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:984:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:984:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[165/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > addSignature > should accept valid signature data
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:271:51
    269|       };
    270| 
    271|       await expect(caller.addSignature(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    272|     });
    273| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:1026:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:1026:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[166/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > addSignature > should accept any string as email
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:283:51
    281|       };
    282| 
    283|       await expect(caller.addSignature(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    284|     });
    285|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:1026:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:1026:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[167/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > generatePdf > should accept valid proposal ID
AssertionError: promise rejected "TRPCError: Cannot read properties of undeâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:301:47
    299|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    300| 
    301|       await expect(caller.generatePdf(validId)).resolves.not.toThrow();
       |                                               ^
    302|     });
    303| 

Caused by: TRPCError: Cannot read properties of undefined (reading 'proposals')
 â¯ app/server/routers/proposals.ts:1148:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: Cannot read properties of undefined (reading 'proposals')
 â¯ app/server/routers/proposals.ts:1148:39
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[168/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should accept valid sales stage update
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:318:55
    316|       };
    317| 
    318|       await expect(caller.updateSalesStage(validInput)).resolves.not.tâ€¦
       |                                                       ^
    319|     });
    320| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:701:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:701:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[169/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > updateSalesStage > should validate all sales stage enum values
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:338:52
    336|         };
    337| 
    338|         await expect(caller.updateSalesStage(input)).resolves.not.toThâ€¦
       |                                                    ^
    339|       }
    340|     });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:701:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/proposals.ts:701:34
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[170/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept empty input
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:397:42
    395|   describe("listByStage", () => {
    396|     it("should accept empty input", async () => {
    397|       await expect(caller.listByStage({})).resolves.not.toThrow();
       |                                          ^
    398|     });
    399| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[171/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by assignedToId
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:402:45
    400|     it("should filter by assignedToId", async () => {
    401|       const input = { assignedToId: "user-123" };
    402|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    403|     });
    404| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[172/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by date range
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:410:45
    408|         dateTo: "2025-01-31T23:59:59Z",
    409|       };
    410|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    411|     });
    412| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[173/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by value range
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:415:45
    413|     it("should filter by value range", async () => {
    414|       const input = { minValue: 1000, maxValue: 5000 };
    415|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    416|     });
    417| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[174/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should filter by specific stages
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:420:45
    418|     it("should filter by specific stages", async () => {
    419|       const input = { stages: ["enquiry", "qualified", "won"] };
    420|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    421|     });
    422| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[175/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept search parameter
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:425:45
    423|     it("should accept search parameter", async () => {
    424|       const input = { search: "accounting services" };
    425|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    426|     });
    427| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[176/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > listByStage > should accept all filters combined
AssertionError: promise rejected "TRPCError: allProposals is not iterable { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/proposals.test.ts:438:45
    436|         stages: ["enquiry", "qualified"],
    437|       };
    438|       await expect(caller.listByStage(input)).resolves.not.toThrow();
       |                                             ^
    439|     });
    440| 

Caused by: TRPCError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: allProposals is not iterable
 â¯ app/server/routers/proposals.ts:272:30
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[177/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should create a note for a proposal
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:498:24
    496| 
    497|         const proposal = await caller.createFromLead({
    498|           leadId: lead.id,
       |                        ^
    499|           title: "Test Proposal with Notes",
    500|           monthlyTotal: "100.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[178/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should create an internal note
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:535:24
    533| 
    534|         const proposal = await caller.createFromLead({
    535|           leadId: lead.id,
       |                        ^
    536|           title: "Proposal for Internal Notes",
    537|           monthlyTotal: "150.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[179/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > createNote > should reject note for non-existent proposal
AssertionError: expected [Function] to throw error including 'Proposal not found' but got '(intermediate value) is not iterable'

Expected: [32m"Proposal not found"[39m
Received: [31m"(intermediate value) is not iterable"[39m

 â¯ __tests__/routers/proposals.test.ts:553:9
    551| 
    552|       it("should reject note for non-existent proposal", async () => {
    553|         await expect(
       |         ^
    554|           caller.createNote({
    555|             proposalId: "00000000-0000-0000-0000-000000000000",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[180/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNotes > should retrieve notes for a proposal
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:580:24
    578| 
    579|         const proposal = await caller.createFromLead({
    580|           leadId: lead.id,
       |                        ^
    581|           title: "Proposal with Multiple Notes",
    582|           monthlyTotal: "200.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[181/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNotes > should support pagination
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:628:24
    626| 
    627|         const proposal = await caller.createFromLead({
    628|           leadId: lead.id,
       |                        ^
    629|           title: "Pagination Test Proposal",
    630|           monthlyTotal: "250.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[182/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > updateNote > should allow author to update their note
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:678:24
    676| 
    677|         const proposal = await caller.createFromLead({
    678|           leadId: lead.id,
       |                        ^
    679|           title: "Update Note Test",
    680|           monthlyTotal: "300.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[183/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > updateNote > should reject update for non-existent note
AssertionError: expected [Function] to throw error including 'Note not found' but got '(intermediate value) is not iterable'

Expected: [32m"Note not found"[39m
Received: [31m"(intermediate value) is not iterable"[39m

 â¯ __tests__/routers/proposals.test.ts:702:9
    700| 
    701|       it("should reject update for non-existent note", async () => {
    702|         await expect(
       |         ^
    703|           caller.updateNote({
    704|             noteId: "00000000-0000-0000-0000-000000000000",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[184/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > deleteNote > should allow author to delete their note
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:727:24
    725| 
    726|         const proposal = await caller.createFromLead({
    727|           leadId: lead.id,
       |                        ^
    728|           title: "Delete Note Test",
    729|           monthlyTotal: "350.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[185/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > deleteNote > should reject delete for non-existent note
AssertionError: expected [Function] to throw error including 'Note not found' but got '(intermediate value) is not iterable'

Expected: [32m"Note not found"[39m
Received: [31m"(intermediate value) is not iterable"[39m

 â¯ __tests__/routers/proposals.test.ts:756:9
    754| 
    755|       it("should reject delete for non-existent note", async () => {
    756|         await expect(
       |         ^
    757|           caller.deleteNote({
    758|             noteId: "00000000-0000-0000-0000-000000000000",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[186/207]âŽ¯

 FAIL  __tests__/routers/proposals.test.ts > app/server/routers/proposals.ts > Proposal Notes (GAP-003) > getNoteCount > should count notes for a proposal
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ __tests__/routers/proposals.test.ts:780:24
    778| 
    779|         const proposal = await caller.createFromLead({
    780|           leadId: lead.id,
       |                        ^
    781|           title: "Count Notes Test",
    782|           monthlyTotal: "400.00",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[187/207]âŽ¯

 FAIL  __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > estimate > should accept valid estimate input
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/transactionData.test.ts:88:47
     86|       };
     87| 
     88|       await expect(caller.estimate(validInput)).resolves.not.toThrow();
       |                                               ^
     89|     });
     90| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/transactionData.ts:355:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/transactionData.ts:355:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[188/207]âŽ¯

 FAIL  __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > fetchFromXero > should accept valid client ID
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/transactionData.test.ts:141:50
    139|       const clientId = "550e8400-e29b-41d4-a716-446655440000";
    140| 
    141|       await expect(caller.fetchFromXero(clientId)).resolves.not.toThroâ€¦
       |                                                  ^
    142|     });
    143| 

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/transactionData.ts:218:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/transactionData.ts:218:24
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[189/207]âŽ¯

 FAIL  __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > upsert > should accept valid upsert input
AssertionError: promise rejected "TRPCError: undefined is not iterable (canâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/transactionData.test.ts:438:45
    436|       };
    437| 
    438|       await expect(caller.upsert(validInput)).resolves.not.toThrow();
       |                                             ^
    439|     });
    440| 

Caused by: TRPCError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 â¯ app/server/routers/transactionData.ts:164:16
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/transactionData.test.ts:438:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 â¯ app/server/routers/transactionData.ts:164:16
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/transactionData.test.ts:438:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[190/207]âŽ¯

 FAIL  __tests__/routers/transactionData.test.ts > app/server/routers/transactionData.ts > getHistory > should accept valid client ID
AssertionError: promise rejected "TRPCError: db.selecâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/transactionData.test.ts:484:47
    482|       const clientId = "550e8400-e29b-41d4-a716-446655440000";
    483| 
    484|       await expect(caller.getHistory(clientId)).resolves.not.toThrow();
       |                                               ^
    485|     });
    486| 

Caused by: TRPCError: db.select(...).from(...).where(...).orderBy is not a function
 â¯ app/server/routers/transactionData.ts:114:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: db.select(...).from(...).where(...).orderBy is not a function
 â¯ app/server/routers/transactionData.ts:114:10
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:28
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/middleware.ts:206:19
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[191/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > getById > should accept valid UUID
AssertionError: promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:107:44
    105|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    106| 
    107|       await expect(_caller.getById(validId)).resolves.not.toThrow();
       |                                            ^
    108|     });
    109| 

Caused by: TRPCError: User not found
 â¯ app/server/routers/users.ts:87:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/users.test.ts:107:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[192/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept valid user data
AssertionError: promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:136:51
    134|       };
    135| 
    136|       await expect(_adminCaller.create(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    137|     });
    138| 

Caused by: TRPCError: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: fe99630c-d204-4a42-94f9-fdb6f2f3a4f8,test-tenant-id,john@example.com,John,Doe,user
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: Error: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: fe99630c-d204-4a42-94f9-fdb6f2f3a4f8,test-tenant-id,john@example.com,John,Doe,user
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { query: 'insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"', params: [ 'fe99630c-d204-4a42-94f9-fdb6f2f3a4f8', 'test-tenant-id', 'john@example.com', 'John', 'Doe', 'user' ] }
Caused by: error: insert or update on table "users" violates foreign key constraint "users_tenant_id_tenants_id_fk"
 â¯ node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:161:13
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:71:12
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { length: 281, severity: 'ERROR', code: '23503', detail: 'Key (tenant_id)=(test-tenant-id) is not present in table "tenants".', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'users', dataType: undefined, constraint: 'users_tenant_id_tenants_id_fk', file: 'ri_triggers.c', routine: 'ri_ReportViolation' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[193/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept any string as email
AssertionError: promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:148:51
    146|       };
    147| 
    148|       await expect(_adminCaller.create(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    149|     });
    150| 

Caused by: TRPCError: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: d3eec9cb-255e-4d9b-ad63-dfa818996261,test-tenant-id,invalid-email,John,Doe,member
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: Error: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: d3eec9cb-255e-4d9b-ad63-dfa818996261,test-tenant-id,invalid-email,John,Doe,member
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { query: 'insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"', params: [ 'd3eec9cb-255e-4d9b-ad63-dfa818996261', 'test-tenant-id', 'invalid-email', 'John', 'Doe', 'member' ] }
Caused by: error: insert or update on table "users" violates foreign key constraint "users_tenant_id_tenants_id_fk"
 â¯ node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:161:13
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:71:12
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { length: 281, severity: 'ERROR', code: '23503', detail: 'Key (tenant_id)=(test-tenant-id) is not present in table "tenants".', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'users', dataType: undefined, constraint: 'users_tenant_id_tenants_id_fk', file: 'ri_triggers.c', routine: 'ri_ReportViolation' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[194/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > create > should accept optional phone field
AssertionError: promise rejected "TRPCError: Failed query: insert into "useâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:161:51
    159|       };
    160| 
    161|       await expect(_adminCaller.create(validInput)).resolves.not.toThrâ€¦
       |                                                   ^
    162|     });
    163|   });

Caused by: TRPCError: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: 8bb11347-2af4-4346-a9fa-f6692a905140,test-tenant-id,john@example.com,John,Doe,user
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: Error: Failed query: insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"
params: 8bb11347-2af4-4346-a9fa-f6692a905140,test-tenant-id,john@example.com,John,Doe,user
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:73:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { query: 'insert into "users" ("id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at") values ($1, $2, $3, default, default, $4, $5, default, $6, default, default, default, default, default, default, default, default) returning "id", "tenant_id", "email", "email_verified", "name", "first_name", "last_name", "image", "role", "status", "is_active", "department_id", "hourly_rate", "timesheet_min_weekly_hours", "timesheet_daily_target_hours", "created_at", "updated_at"', params: [ '8bb11347-2af4-4346-a9fa-f6692a905140', 'test-tenant-id', 'john@example.com', 'John', 'Doe', 'user' ] }
Caused by: error: insert or update on table "users" violates foreign key constraint "users_tenant_id_tenants_id_fk"
 â¯ node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:161:13
 â¯ NodePgPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/pg-core/session.ts:71:12
 â¯ node_modules/.pnpm/drizzle-orm@0.44.5_@opentelemetry+api@1.9.0_@types+pg@8.15.5_@upstash+redis@1.35.6_kyse_5e9bb48bf4255129f937bf37099242fc/node_modules/src/node-postgres/session.ts:154:19
 â¯ app/server/routers/users.ts:114:23
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { length: 281, severity: 'ERROR', code: '23503', detail: 'Key (tenant_id)=(test-tenant-id) is not present in table "tenants".', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'users', dataType: undefined, constraint: 'users_tenant_id_tenants_id_fk', file: 'ri_triggers.c', routine: 'ri_ReportViolation' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[195/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept valid update data
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:184:46
    182|       };
    183| 
    184|       await expect(_caller.update(validInput)).resolves.not.toThrow();
       |                                              ^
    185|     });
    186| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[196/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept any string as email in updates
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:196:46
    194|       };
    195| 
    196|       await expect(_caller.update(validInput)).resolves.not.toThrow();
       |                                              ^
    197|     });
    198| 

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[197/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > update > should accept partial updates
AssertionError: promise rejected "TRPCError: Admin access required { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:207:46
    205|       };
    206| 
    207|       await expect(_caller.update(validInput)).resolves.not.toThrow();
       |                                              ^
    208|     });
    209|   });

Caused by: TRPCError: Admin access required
 â¯ app/server/trpc.ts:87:11
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:646:16
 â¯ app/server/trpc.ts:31:12
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:26
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:26
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'FORBIDDEN' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[198/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > delete > should accept valid user ID
AssertionError: promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:215:48
    213|       const validId = "550e8400-e29b-41d4-a716-446655440000";
    214| 
    215|       await expect(_adminCaller.delete(validId)).resolves.not.toThrow(â€¦
       |                                                ^
    216|     });
    217| 

Caused by: TRPCError: User not found
 â¯ app/server/routers/users.ts:215:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/users.test.ts:215:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[199/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > updateRole > should accept valid role update
AssertionError: promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:241:55
    239|       };
    240| 
    241|       await expect(_adminCaller.updateRole(validInput)).resolves.not.tâ€¦
       |                                                       ^
    242|     });
    243| 

Caused by: TRPCError: User not found
 â¯ app/server/routers/users.ts:256:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/users.test.ts:241:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[200/207]âŽ¯

 FAIL  __tests__/routers/users.test.ts > app/server/routers/users.ts > sendPasswordReset > should accept valid userId
AssertionError: promise rejected "TRPCError: User not found { code: 'Nâ€¦' }" instead of resolving
 â¯ __tests__/routers/users.test.ts:272:7
    270|       await expect(
    271|         _adminCaller.sendPasswordReset(validInput),
    272|       ).resolves.not.toThrow();
       |       ^
    273|     });
    274| 

Caused by: TRPCError: User not found
 â¯ app/server/routers/users.ts:310:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/users.test.ts:270:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[201/207]âŽ¯

 FAIL  __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate compareVersions input
AssertionError: promise rejected "TRPCError: One or both versions not found { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/workflows.versioning.test.ts:105:7
    103|       await expect(
    104|         _workflowCaller.compareVersions(input),
    105|       ).resolves.not.toThrow();
       |       ^
    106|     });
    107| 

Caused by: TRPCError: One or both versions not found
 â¯ app/server/routers/workflows.ts:676:15
 â¯ resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:571:22
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:633:20
 â¯ procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/procedureBuilder.ts:673:20
 â¯ node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.2/node_modules/@trpc/server/src/unstable-core-do-not-import/router.ts:474:20
 â¯ __tests__/routers/workflows.versioning.test.ts:103:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[202/207]âŽ¯

 FAIL  __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate rollbackToVersion input
AssertionError: promise rejected "TRPCError: Workflow not found { â€¦(1) }" instead of resolving
 â¯ __tests__/routers/workflows.versioning.test.ts:118:7
    116|       await expect(
    117|         _workflowCaller.rollbackToVersion(input),
    118|       ).resolves.not.toThrow();
       |       ^
    119|     });
    120| 

Caused by: TRPCError: Workflow not found
 â¯ app/server/routers/workflows.ts:837:17

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[203/207]âŽ¯

 FAIL  __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate rollbackToVersion input with minimal fields
AssertionError: promise rejected "TRPCError: Workflow not found { â€¦(1) }" instead of resolving
 â¯ __tests__/routers/workflows.versioning.test.ts:129:7
    127|       await expect(
    128|         _workflowCaller.rollbackToVersion(input),
    129|       ).resolves.not.toThrow();
       |       ^
    130|     });
    131| 

Caused by: TRPCError: Workflow not found
 â¯ app/server/routers/workflows.ts:837:17

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'NOT_FOUND' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[204/207]âŽ¯

 FAIL  __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Input Validation > should validate migrateInstances input
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/workflows.versioning.test.ts:140:7
    138|       await expect(
    139|         _workflowCaller.migrateInstances(input),
    140|       ).resolves.not.toThrow();
       |       ^
    141|     });
    142|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/workflows.ts:592:30

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/workflows.ts:592:30

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[205/207]âŽ¯

 FAIL  __tests__/routers/workflows.versioning.test.ts > Workflow Versioning System > Task Assignment with Versioning > should validate assignWorkflow input
AssertionError: promise rejected "TRPCError: (intermediate value) is not itâ€¦ { code: 'â€¦' }" instead of resolving
 â¯ __tests__/routers/workflows.versioning.test.ts:151:53
    149|       };
    150| 
    151|       await expect(_taskCaller.assignWorkflow(input)).resolves.not.toTâ€¦
       |                                                     ^
    152|     });
    153|   });

Caused by: TRPCError: (intermediate value) is not iterable
 â¯ app/server/routers/tasks.ts:843:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'INTERNAL_SERVER_ERROR' }
Caused by: TypeError: (intermediate value) is not iterable
 â¯ app/server/routers/tasks.ts:843:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[206/207]âŽ¯


 Test Files  21 failed | 64 passed (85)
      Tests  206 failed | 1570 passed | 9 skipped (1785)
   Start at  19:24:21
   Duration  61.59s (transform 5.35s, setup 234ms, collect 18.50s, tests 40.12s, environment 0ms, prepare 145ms)

â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
