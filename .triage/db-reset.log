
> practice-hub@0.1.0 db:reset /root/projects/practice-hub
> pnpm db:migrate:reset && pnpm db:seed && pnpm db:seed:auth


> practice-hub@0.1.0 db:migrate:reset /root/projects/practice-hub
> tsx -r dotenv/config scripts/migrate.ts --reset dotenv_config_path=.env.local

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ğŸ“¡ version env with Radar: https://dotenvx.com/radar
ğŸ—‘ï¸  Dropping and recreating schema...
NOTICE:  drop cascades to 121 other objects
DETAIL:  drop cascades to type client_status
drop cascades to type client_type
drop cascades to type compliance_priority
drop cascades to type compliance_status
drop cascades to type document_type
drop cascades to type import_entity_type
drop cascades to type import_status
drop cascades to type invoice_status
drop cascades to type lead_status
drop cascades to type leave_status
drop cascades to type leave_type
drop cascades to type onboarding_priority
drop cascades to type onboarding_status
drop cascades to type pricing_model
drop cascades to type pricing_rule_type
drop cascades to type proposal_status
drop cascades to type recurring_frequency
drop cascades to type sales_stage
drop cascades to type service_component_category
drop cascades to type service_price_type
drop cascades to type task_priority
drop cascades to type task_status
drop cascades to type time_entry_status
drop cascades to type transaction_data_source
drop cascades to type work_type
drop cascades to table account
drop cascades to table activity_logs
drop cascades to table aml_checks
drop cascades to table calendar_event_attendees
drop cascades to table calendar_events
drop cascades to table client_contacts
drop cascades to table client_directors
drop cascades to table client_pscs
drop cascades to table client_portal_access
drop cascades to table client_portal_account
drop cascades to table client_portal_invitations
drop cascades to table client_portal_session
drop cascades to table client_portal_users
drop cascades to table client_portal_verification
drop cascades to table client_services
drop cascades to table client_task_template_overrides
drop cascades to table client_transaction_data
drop cascades to table clients
drop cascades to table companies_house_cache
drop cascades to table companies_house_rate_limit
drop cascades to table compliance
drop cascades to table departments
drop cascades to table document_signatures
drop cascades to table documents
drop cascades to table email_queue
drop cascades to table email_templates
drop cascades to table feedback
drop cascades to table import_logs
drop cascades to table integration_settings
drop cascades to table invitations
drop cascades to table invoice_items
drop cascades to table invoices
drop cascades to table kyc_verifications
drop cascades to table leads
drop cascades to table leave_balances
drop cascades to table leave_requests
drop cascades to table legal_pages
drop cascades to table message_thread_participants
drop cascades to table message_threads
drop cascades to table messages
drop cascades to table notifications
drop cascades to table onboarding_responses
drop cascades to table onboarding_sessions
drop cascades to table onboarding_tasks
drop cascades to table portal_categories
drop cascades to table portal_links
drop cascades to table pricing_rules
drop cascades to table proposal_notes
drop cascades to table proposal_services
drop cascades to table proposal_signatures
drop cascades to table proposal_templates
drop cascades to table proposal_versions
drop cascades to table proposals
drop cascades to table role_permissions
drop cascades to table services
drop cascades to table session
drop cascades to table staff_capacity
drop cascades to table task_assignment_history
drop cascades to table task_notes
drop cascades to table task_templates
drop cascades to table task_workflow_instances
drop cascades to table tasks
drop cascades to table tenants
drop cascades to table time_entries
drop cascades to table timesheet_submissions
drop cascades to table toil_accrual_history
drop cascades to table user_favorites
drop cascades to table user_permissions
drop cascades to table user_settings
drop cascades to table users
drop cascades to table verification
drop cascades to table work_types
drop cascades to table workflow_email_rules
drop cascades to table workflow_stages
drop cascades to table workflow_templates
and 21 other objects (see server log for list)
DROP SCHEMA
CREATE SCHEMA
âœ… Schema dropped and recreated

ğŸ“‹ Pushing schema (creating tables)...

> practice-hub@0.1.0 db:push:dev /root/projects/practice-hub
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/root/projects/practice-hub/drizzle.config.ts'
[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
Using 'pg' driver for database querying
[â£·] Pulling schema from database...
[2K[1G[âœ“] Pulling schema from database...
[âœ“] Changes applied
âœ… Schema pushed

ğŸ”„ Running migrations (creating views)...
{
  severity_local: 'NOTICE',
  severity: 'NOTICE',
  code: '42P06',
  message: 'schema "drizzle" already exists, skipping',
  file: 'schemacmds.c',
  line: '132',
  routine: 'CreateSchemaCommand'
}
{
  severity_local: 'NOTICE',
  severity: 'NOTICE',
  code: '42P07',
  message: 'relation "__drizzle_migrations" already exists, skipping',
  file: 'parse_utilcmd.c',
  line: '207',
  routine: 'transformCreateStmt'
}
âœ… Migrations completed successfully!

ğŸ‘ï¸  Creating database views...
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
CREATE VIEW
âœ… Database views created successfully!

âœ… Database migration complete!

ğŸ’¡ Next step: Run 'pnpm db:seed' to populate the database

> practice-hub@0.1.0 db:seed /root/projects/practice-hub
> tsx -r dotenv/config scripts/seed.ts dotenv_config_path=.env.local

ğŸŒ± Starting database seed...
Creating tenant...
Creating departments...
Creating work types...
Creating users...
Updating departments with managers...
Creating user settings...
Creating staff capacity records...
Creating working patterns...
Creating leave balances...
Creating TOIL accrual history...
Creating leave requests...
Creating invitations...
Creating legal pages...
Creating portal categories and links...
âœ“ Created 20 portal links across 3 categories
Creating service components...
âœ“ Created 28 services
Creating pricing rules...
âœ“ Created 138 pricing rules
Creating task templates...
âœ“ Created 19 task templates
Creating clients...
Creating client contacts...
Creating client directors...
Creating client PSCs...
Assigning service components to clients...
Creating leads...
âœ… Created 15 leads
Creating proposals...
âœ… Created 20 proposals with services
Creating onboarding sessions...
âœ… Created 5 onboarding sessions with tasks
Creating tasks...
Creating auto-generated tasks from templates...
Creating task notes...
âœ… Created 30 task notes for 10 tasks
Creating task assignment history...
âœ… Created assignment history for 15 tasks
Creating time entries...
Creating timesheet submissions...
âœ… Created timesheet submissions
Creating invoices...
Creating compliance items...
Creating workflows...
Assigning workflows to tasks...
Skipping workflow templates (disabled due to bugs)...
âœ“ Skipped workflow templates (section disabled)
âœ“ 50 Workflow instances created
Creating documents and uploading to S3...
âœ“ Documents created and uploaded to S3
Creating activity logs...
Creating client portal users and access...
Creating message threads, messages, notifications, and calendar events...
âœ“ Created message threads, messages, notifications, and calendar events
Creating integration settings...
Creating import logs...
Creating sample Xero webhook events...
âœ“ Created integration settings, import logs, and sample webhook events
Creating email templates...
âœ“ Created 5 email templates
Creating workflow email rules...
âœ“ Created 4 workflow email rules for workflow "Annual Tax Return Process"
âœ… Database seeding completed!

ğŸ“Š Seed Summary:
================
âœ“ 1 Tenant created
âœ“ 4 Users created
âœ“ 3 Portal categories created
âœ“ 20 Portal links created (internal modules + external tools)
âœ“ 28 Service Components created
âœ“ 138 Pricing Rules created
âœ“ 25 Clients created
âœ“ 56 Tasks created
âœ“ 30 Invoices created
âœ“ Multiple time entries created (last 90 days)
âœ“ Compliance items created
âœ“ Document structure created
âœ“ 8 Workflow templates created
âœ“ 5 Email templates created
âœ“ Workflow email rules created (workflow triggers)
âœ“ 100 Activity logs created

ğŸ‘¤ Test Users:
==============
Email: joe@pageivy.com
Role: admin
---
Email: sarah.johnson@demo.com
Role: accountant
---
Email: mike.chen@demo.com
Role: accountant
---
Email: emily.davis@demo.com
Role: member
---

ğŸ‰ You can now log in with any of the above users!
Note: In development, authentication will auto-create these users with Clerk.

> practice-hub@0.1.0 db:seed:auth /root/projects/practice-hub
> tsx -r dotenv/config scripts/seed-auth-users.ts dotenv_config_path=.env.local

ğŸ” Creating Better Auth accounts for seed users...

Clearing existing auth accounts...
âœ“ Cleared old accounts

âœ“ Created auth account for joe@pageivy.com
âœ“ Created auth account for sarah.johnson@demo.com
âœ“ Created auth account for mike.chen@demo.com
âœ“ Created auth account for emily.davis@demo.com

âœ… Auth account creation complete!

ğŸ“§ Users can sign in with:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  joe@pageivy.com     â†’ Innspired@321
  Other users         â†’ password123
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¥ Available Users:
  â€¢ joe@pageivy.com                (admin)
  â€¢ sarah.johnson@demo.com         (accountant)
  â€¢ mike.chen@demo.com             (accountant)
  â€¢ emily.davis@demo.com           (member)

