[
  {
    "legacy_feature_id": "CLIENT_HUB/task-list",
    "legacy_evidence": {
      "hook": "useTasks",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:35-107",
      "logic": "Query with status, client, assignee, search filters"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks",
        "api": "tasks.list",
        "file": "app/server/routers/tasks.ts:313+",
        "match_score": 100,
        "match_reasoning": "Same filters (status, client, assignee, search) implemented via tRPC query. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Multi-tenant isolation", "Tenant-scoped queries"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-create",
    "legacy_evidence": {
      "hook": "useCreateTask",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:138-203",
      "logic": "Creates adhoc, templated, or recurring tasks"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks",
        "api": "tasks.create",
        "file": "app/server/routers/tasks.ts:400+",
        "match_score": 100,
        "match_reasoning": "Task creation with type (adhoc, templated, recurring) support. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Story 3.2 template system with auto-generation"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-update",
    "legacy_evidence": {
      "hook": "useUpdateTask",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:205-272",
      "logic": "Update task fields, auto-set completed_at on completion"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks/[id]",
        "api": "tasks.update",
        "file": "app/server/routers/tasks.ts:450+",
        "match_score": 100,
        "match_reasoning": "Same update behavior with automatic completed_at timestamp. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Workflow instance state tracking"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-delete",
    "legacy_evidence": {
      "hook": "useDeleteTask",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:274-299",
      "logic": "Soft or hard delete task"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks/[id]",
        "api": "tasks.delete",
        "file": "app/server/routers/tasks.ts:480+",
        "match_score": 100,
        "match_reasoning": "Delete operation with soft-delete support. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-reassignment",
    "legacy_evidence": {
      "hook": "useReassignTask",
      "file": ".archive/crm-app/main/src/hooks/useTaskReassignment.ts:63-228",
      "logic": "Reassign task to new user with audit trail and notifications"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks/[id]",
        "api": "tasks.reassign",
        "file": "app/server/routers/tasks.ts:600+",
        "match_score": 100,
        "match_reasoning": "Same reassignment logic (preparer, reviewer, assigned_to) with audit trail and notifications. Feature parity with enhanced notification preferences."
      }
    ],
    "status": "OK",
    "enhancements": ["User notification preferences from user_settings", "Transaction safety"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-bulk-reassign",
    "legacy_evidence": {
      "hook": "useBulkReassign",
      "file": ".archive/crm-app/main/src/hooks/useTaskReassignment.ts:230-383",
      "logic": "Reassign multiple tasks to single user"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks",
        "api": "tasks.bulkReassign",
        "file": "app/server/routers/tasks.ts:650+",
        "match_score": 100,
        "match_reasoning": "Bulk reassignment with transaction safety. Same capability plus enhanced transaction isolation."
      }
    ],
    "status": "OK",
    "enhancements": ["Transaction safety", "Batch audit trail"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-assignment-history",
    "legacy_evidence": {
      "hook": "useAssignmentHistory",
      "file": ".archive/crm-app/main/src/hooks/useTaskReassignment.ts:7-32",
      "logic": "Get assignment change history with from/to users"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks/[id]",
        "api": "tasks.getAssignmentHistory",
        "file": "app/server/routers/tasks.ts:700+",
        "match_score": 100,
        "match_reasoning": "Full audit trail of task assignments in taskAssignmentHistory table. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/my-tasks-filter",
    "legacy_evidence": {
      "hook": "useTasks",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:76-79",
      "logic": "OR filter on 3 assignment fields (preparer_id, reviewer_id, assigned_to)"
    },
    "current_candidates": [
      {
        "route": "/client-hub/tasks",
        "api": "tasks.list",
        "file": "app/server/routers/tasks.ts:313+",
        "match_score": 50,
        "match_reasoning": "Current filters by single assigneeId field only. Missing OR logic across preparer/reviewer/assigned_to."
      }
    ],
    "status": "PARTIAL",
    "missing_features": ["Filter does not check preparerId or reviewerId when loading 'my tasks'"],
    "regression_details": "Users may not see tasks where they are preparer or reviewer, only where assigned_to matches their ID",
    "severity": "HIGH",
    "confidence": 85,
    "fix_proposal": {
      "approach": "Extend tasks.list query to support assigneeId filter mode that checks OR(preparerId=userId, reviewerId=userId, assignedToId=userId)",
      "estimated_effort": "2 hours"
    }
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-status-enum",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:125",
      "statuses": "pending, in_progress, completed, cancelled"
    },
    "current_candidates": [
      {
        "api": "tasks schema",
        "file": "lib/db/schema.ts:957",
        "match_score": 100,
        "match_reasoning": "Legacy 4 statuses + current 8 (adds review, blocked, records_received, queries_sent, queries_received for workflow tracking)"
      }
    ],
    "status": "OK",
    "enhancements": ["Better granularity with review/blocked states", "Workflow stage tracking"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-priority-enum",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:154-161",
      "mapping": "high (1), medium (2), low (3)"
    },
    "current_candidates": [
      {
        "api": "tasks schema",
        "file": "lib/db/schema.ts:960",
        "match_score": 100,
        "match_reasoning": "Legacy 3 priorities + current 5 (adds urgent, critical)"
      }
    ],
    "status": "OK",
    "enhancements": ["Added urgent and critical priority levels"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/workflow-checklist-progress",
    "legacy_evidence": {
      "hook": "updateChecklistItem",
      "file": ".archive/crm-app/main/src/components/tasks/TaskChecklistTab.tsx:79-97",
      "logic": "Track per-stage checklist completion with progress percentage"
    },
    "current_candidates": [
      {
        "api": "tasks.updateChecklistItem",
        "file": "app/server/routers/tasks.ts:550+",
        "match_score": 100,
        "match_reasoning": "Same checklist tracking in stageProgress JSONB with workflow email triggers (FR32:AC3)"
      }
    ],
    "status": "OK",
    "enhancements": ["Automatic workflow email triggers on stage completion"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-notes-internal",
    "legacy_evidence": {
      "route": "/crm/tasks/:id",
      "component": "TaskDetail with notes section"
    },
    "current_candidates": [
      {
        "api": "tasks.createNote, tasks.getNotes",
        "file": "app/server/routers/tasks.ts:750+",
        "match_score": 100,
        "match_reasoning": "NEW in current: taskNotes table with mentions, soft-delete, permission isolation"
      }
    ],
    "status": "OK",
    "enhancements": ["User mentions support", "Soft-delete capability", "Permission isolation"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/task-templates-auto-generation",
    "legacy_evidence": {
      "component": "Task creation supports templated type",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:169"
    },
    "current_candidates": [
      {
        "api": "tasks.generateFromTemplate, tasks.generateBulk, taskTemplates.*",
        "file": "app/server/routers/task-generation.ts, taskTemplates.ts",
        "match_score": 100,
        "match_reasoning": "Story 3.2 adds comprehensive template system: taskTemplates router (20+ procedures), auto-generation with placeholder substitution, recurring patterns"
      }
    ],
    "status": "OK",
    "enhancements": ["Placeholder substitution ({service_name}, {client_name})", "Configurable due dates (offset)", "Bulk generation", "Recurring patterns"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/bulk-task-status-update",
    "legacy_evidence": {
      "route": "/crm/tasks (list view)"
    },
    "current_candidates": [
      {
        "api": "tasks.bulkUpdateStatus",
        "file": "app/server/routers/tasks.ts:650+",
        "match_score": 100,
        "match_reasoning": "NEW in current: bulkUpdateStatus mutation for mass status updates"
      }
    ],
    "status": "OK",
    "enhancements": ["Batch operation support"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/bulk-task-delete",
    "legacy_evidence": {
      "route": "/crm/tasks (list view)"
    },
    "current_candidates": [
      {
        "api": "tasks.bulkDelete",
        "file": "app/server/routers/tasks.ts:700+",
        "match_score": 100,
        "match_reasoning": "NEW in current: bulkDelete mutation with soft-delete support"
      }
    ],
    "status": "OK",
    "enhancements": ["Batch delete with soft-delete support"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_HUB/dashboard-stats",
    "legacy_evidence": {
      "hook": "useDashboardStats",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:301-377",
      "metrics": "myOpenTasks, dueThisWeek, overdueTasks, hoursToday"
    },
    "current_candidates": [
      {
        "route": "/client-hub",
        "api": "dashboard.getStats",
        "file": "app/server/routers/dashboard.ts",
        "match_score": 100,
        "match_reasoning": "Same dashboard metrics available via dashboard router. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 95
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-list",
    "legacy_evidence": {
      "endpoint": "/api/v1/proposals",
      "file": ".archive/proposal-app/main/server/server.js:152-195",
      "filters": "status, client, pagination"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/proposals",
        "api": "proposals.list",
        "file": "app/server/routers/proposals.ts:96-160",
        "match_score": 100,
        "match_reasoning": "List with clientId, status, salesStage, search filters. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Added salesStage filter for better pipeline control"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-create",
    "legacy_evidence": {
      "endpoint": "/api/v1/proposals",
      "file": ".archive/proposal-app/main/server/server.js:197-222",
      "method": "POST"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/proposals",
        "api": "proposals.create",
        "file": "app/server/routers/proposals.ts:170+",
        "match_score": 100,
        "match_reasoning": "Create proposal with full schema including services. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Services array support", "Pricing model selection"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-update",
    "legacy_evidence": {
      "endpoint": "/api/v1/proposals/:id",
      "file": ".archive/proposal-app/main/server/server.js:249-276",
      "method": "PUT"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/proposals/[id]",
        "api": "proposals.update",
        "file": "app/server/routers/proposals.ts:220+",
        "match_score": 100,
        "match_reasoning": "Update proposal fields. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-status-enum",
    "legacy_evidence": {
      "file": ".archive/proposal-app/main/server/server.js:90",
      "statuses": "draft, sent, signed, declined, converted"
    },
    "current_candidates": [
      {
        "api": "proposals schema",
        "file": "app/server/routers/proposals.ts:34-41",
        "match_score": 100,
        "match_reasoning": "Current 6 statuses (draft, sent, viewed, signed, rejected, expired) vs legacy 5. New 'viewed' for tracking, 'expired' for time-limited proposals."
      }
    ],
    "status": "OK",
    "enhancements": ["View tracking", "Expiry date support"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-pipeline",
    "legacy_evidence": {
      "component": "Pipeline.tsx",
      "file": ".archive/proposal-app/main/src/App.tsx:33",
      "visual": "Kanban board by proposal status"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/pipeline",
        "api": "proposals.listByStage",
        "file": "app/server/routers/proposals.ts:160+",
        "match_score": 100,
        "match_reasoning": "Pipeline view with 7-stage sales process. Enhanced granularity vs legacy status-based Kanban."
      }
    ],
    "status": "OK",
    "enhancements": ["7-stage sales pipeline (enquiry, qualified, proposal_sent, follow_up, won, lost, dormant)"],
    "severity": null,
    "confidence": 95
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-analytics",
    "legacy_evidence": {
      "endpoint": "/api/v1/proposals/analytics/pipeline",
      "file": ".archive/proposal-app/main/server/server.js:395-471",
      "metrics": "total, by_status, by_source, conversion_rate"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/analytics",
        "api": "proposals.getStats, analytics.getProposalMetrics",
        "file": "app/server/routers/proposals.ts + analytics.ts",
        "match_score": 100,
        "match_reasoning": "Same analytics queries. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-versioning",
    "legacy_evidence": {
      "component": "Proposal editing"
    },
    "current_candidates": [
      {
        "api": "proposals.createVersion, proposals.updateWithVersion, proposals.getVersionHistory",
        "file": "app/server/routers/proposals.ts:350+",
        "match_score": 100,
        "match_reasoning": "NEW in current: proposal_versions table with automatic snapshots on update, full version history"
      }
    ],
    "status": "OK",
    "enhancements": ["Full version history with snapshots", "Rollback capability"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-signatures-canvas",
    "legacy_evidence": {
      "component": "Canvas signature support",
      "file": ".archive/proposal-app/main/src/components"
    },
    "current_candidates": [
      {
        "api": "proposals.submitSignature",
        "file": "app/server/routers/proposals.ts:450+",
        "match_score": 40,
        "match_reasoning": "Legacy canvas signatures DEPRECATED. Current uses DocuSeal professional e-signature platform. Different implementation, better solution."
      }
    ],
    "status": "REGRESSED",
    "missing_features": ["Canvas-based signature support removed"],
    "regression_details": "Legacy canvas signatures no longer available, replaced by DocuSeal",
    "severity": "MEDIUM",
    "confidence": 100,
    "fix_proposal": {
      "approach": "Canvas deprecation is by-design. DocuSeal is professional standard. If legacy contracts require canvas, implement fallback module (requires canvas library + verification logic).",
      "estimated_effort": "4-8 hours if required"
    }
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/docuseal-esignatures",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "proposals.submitSignature, docuseal webhook handler",
        "file": "app/server/routers/proposals.ts:450+, app/api/webhooks/docuseal/route.ts:132+",
        "match_score": 100,
        "match_reasoning": "NEW in current: Professional DocuSeal integration with templates, submissions, webhooks, UK compliance fields"
      }
    ],
    "status": "OK",
    "enhancements": ["Professional e-signature platform", "Webhook verification", "Signed PDF generation", "Auditable signature trail", "UK compliance fields"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-pdf-generation",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "proposals.generatePdf",
        "file": "app/server/routers/proposals.ts:430+",
        "match_score": 100,
        "match_reasoning": "NEW in current: PDF generation with S3 storage and presigned URLs"
      }
    ],
    "status": "OK",
    "enhancements": ["S3 storage", "Presigned URL access", "TTL-based expiry"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/proposal-to-client-conversion",
    "legacy_evidence": {
      "endpoint": "/api/v1/proposals/:id/convert",
      "file": ".archive/proposal-app/main/server/server.js:329-393",
      "logic": "Maps proposal to client"
    },
    "current_candidates": [
      {
        "api": "proposals.createFromLead, leads.convertToClient",
        "file": "app/server/routers/proposals.ts + leads.ts",
        "match_score": 80,
        "match_reasoning": "Different flow (lead → proposal → client) but achieves same goal. Verify field mapping is equivalent."
      }
    ],
    "status": "OK",
    "enhancements": ["Lead-based conversion pipeline more structured"],
    "severity": null,
    "confidence": 90,
    "fix_proposal": {
      "approach": "Verify legacy proposal→client field mapping matches current lead→proposal→client pipeline",
      "estimated_effort": "1-2 hours verification"
    }
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/lead-management",
    "legacy_evidence": {
      "route": "/leads",
      "file": ".archive/proposal-app/main/src/App.tsx:30"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/leads",
        "api": "leads.list, leads.create, leads.qualify, leads.convert",
        "file": "app/server/routers/leads.ts",
        "match_score": 100,
        "match_reasoning": "Full lead lifecycle (list, create, qualify, convert). Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/sales-stage-tracking",
    "legacy_evidence": {
      "component": "Pipeline tracking by status"
    },
    "current_candidates": [
      {
        "api": "proposals.updateSalesStage, sales_stage_automation",
        "file": "app/server/routers/proposals.ts:300+",
        "match_score": 100,
        "match_reasoning": "NEW in current: Detailed sales stage enum (enquiry, qualified, proposal_sent, follow_up, won, lost, dormant) with automation"
      }
    ],
    "status": "OK",
    "enhancements": ["Granular sales stage tracking", "Automated stage transitions"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "PROPOSAL_HUB/pricing-calculator",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "route": "/proposal-hub/calculator",
        "api": "pricing.calculate",
        "file": "app/proposal-hub/calculator/page.tsx, app/server/routers/pricing.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Story 6.2 dynamic pricing calculator with model computation"
      }
    ],
    "status": "OK",
    "enhancements": ["Dynamic pricing models", "Service component selection"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INVOICE_MANAGEMENT/invoice-list",
    "legacy_evidence": {
      "hook": "useInvoices",
      "file": ".archive/crm-app/main/src/hooks/useInvoices.ts:103-220",
      "filters": "search, status, date, client"
    },
    "current_candidates": [
      {
        "route": "/client-hub/invoices",
        "api": "invoices.list",
        "file": "app/server/routers/invoices.ts:47-110",
        "match_score": 100,
        "match_reasoning": "List with search, status, client filters. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": ["Overdue detection", "Xero sync status"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INVOICE_MANAGEMENT/xero-sync-status",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/hooks/useInvoices.ts:6-59",
      "fields": "xero_status, xero_last_sync_at"
    },
    "current_candidates": [
      {
        "api": "invoices schema",
        "file": "lib/db/schema.ts:1380",
        "match_score": 100,
        "match_reasoning": "xeroInvoiceId, xeroSyncStatus, xeroLastSyncedAt fields match legacy. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INVOICE_MANAGEMENT/manual-client-matching",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/hooks/useInvoices.ts:133-137",
      "logic": "Link Xero invoice to client via clientId FK"
    },
    "current_candidates": [
      {
        "api": "invoices schema",
        "file": "lib/db/schema.ts:1360",
        "match_score": 100,
        "match_reasoning": "clientId foreign key for manual matching. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INVOICE_MANAGEMENT/overdue-detection",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/hooks/useInvoices.ts:223",
      "logic": "Filter: due_date < today AND amount_due > 0"
    },
    "current_candidates": [
      {
        "api": "invoices.list with overdue filter",
        "file": "app/server/routers/invoices.ts:80-86",
        "match_score": 100,
        "match_reasoning": "Overdue calculation: status=sent AND dueDate < CURRENT_DATE. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INVOICE_MANAGEMENT/invoice-pdf-generation",
    "legacy_evidence": {
      "component": "Not visible in legacy"
    },
    "current_candidates": [
      {
        "api": "invoices router",
        "file": "app/server/routers/invoices.ts",
        "match_score": 0,
        "match_reasoning": "No explicit invoice PDF generation found in current routers"
      }
    ],
    "status": "PARTIAL",
    "missing_features": ["Invoice PDF generation not found"],
    "regression_details": "No explicit generatePdf mutation for invoices. May be integrated into documents system.",
    "severity": "MEDIUM",
    "confidence": 60,
    "fix_proposal": {
      "approach": "Verify if invoices can generate PDFs via documents router or as part of document system. If missing, add invoices.generatePdf mutation.",
      "estimated_effort": "2-4 hours"
    }
  },
  {
    "legacy_feature_id": "WORKFLOW_SYSTEM/workflow-instance-tracking",
    "legacy_evidence": {
      "table": "crm_workflow_instances",
      "file": ".archive/crm-app/main/src/hooks/useTasks.ts:60"
    },
    "current_candidates": [
      {
        "api": "task_workflow_instances table",
        "file": "lib/db/schema.ts:1140+",
        "match_score": 100,
        "match_reasoning": "Same workflow instance lifecycle tracking with state management. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "WORKFLOW_SYSTEM/workflow-stages-checklist",
    "legacy_evidence": {
      "table": "crm_workflow_stages",
      "structure": "name, description, stage_order, is_required, checklist_items"
    },
    "current_candidates": [
      {
        "api": "workflow_stages table",
        "file": "lib/db/schema.ts:1200+",
        "match_score": 100,
        "match_reasoning": "Same stage structure with checklistItems as jsonb array. More flexible than legacy."
      }
    ],
    "status": "OK",
    "enhancements": ["checklistItems as JSONB array for flexibility"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "WORKFLOW_SYSTEM/checklist-progress-tracking",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/components/tasks/TaskChecklistTab.tsx:79-97"
    },
    "current_candidates": [
      {
        "api": "tasks.updateChecklistItem",
        "file": "app/server/routers/tasks.ts:550+",
        "match_score": 100,
        "match_reasoning": "Per-stage progress via stageProgress jsonb in task_workflow_instances. More efficient denormalization with workflow email triggers."
      }
    ],
    "status": "OK",
    "enhancements": ["Denormalized stageProgress for efficiency", "Automatic workflow email triggers (FR32:AC3)"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "WORKFLOW_SYSTEM/workflow-automation-triggers",
    "legacy_evidence": {
      "component": "Not explicit in legacy"
    },
    "current_candidates": [
      {
        "api": "workflows schema",
        "file": "lib/db/schema.ts:1454+",
        "match_score": 100,
        "match_reasoning": "NEW in current: workflow_stages.autoComplete, workflow_stages.requiresApproval, workflows.trigger, workflows.actions enable rich automation"
      }
    ],
    "status": "OK",
    "enhancements": ["Auto-complete stages", "Approval requirements", "Event-based triggers", "Action definitions"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "WORKFLOW_SYSTEM/workflow-email-integration",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "workflow email triggers",
        "file": "lib/email/workflow-triggers.ts, app/server/routers/tasks.ts:550+",
        "match_score": 100,
        "match_reasoning": "NEW in current: FR32:AC3 workflow email triggers on checklist completion, task assignment, etc."
      }
    ],
    "status": "OK",
    "enhancements": ["Automated workflow emails on stage events"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INTEGRATIONS/xero-oauth",
    "legacy_evidence": {
      "route": "/oauth/xero/callback",
      "file": ".archive/crm-app/main/src/App.tsx:185"
    },
    "current_candidates": [
      {
        "api": "integrations.connectXero",
        "file": "app/server/routers/integrations.ts",
        "match_score": 100,
        "match_reasoning": "OAuth flow maintained. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INTEGRATIONS/companies-house-lookup",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "clients.lookupCompaniesHouse",
        "file": "app/server/routers/clients.ts:350+, lib/integrations/companies-house.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Companies House API integration for company details, directors, PSCs with caching"
      }
    ],
    "status": "OK",
    "enhancements": ["Director lookup", "PSC lookup", "5-min cache"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INTEGRATIONS/vat-validation",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "clients.validateVAT",
        "file": "app/server/routers/clients.ts:370+",
        "match_score": 100,
        "match_reasoning": "NEW in current: HMRC API integration for VAT validation"
      }
    ],
    "status": "OK",
    "enhancements": ["VAT number validation"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INTEGRATIONS/email-notifications",
    "legacy_evidence": {
      "library": "Sonner (toast notifications)",
      "file": ".archive/shared/components/src/ui/sonner.tsx"
    },
    "current_candidates": [
      {
        "library": "react-hot-toast + Resend",
        "file": "lib/email/send-proposal-email.ts",
        "match_score": 100,
        "match_reasoning": "Legacy in-app notifications via Sonner. Current adds Resend for email notifications (signing invites, confirmations, team messages)"
      }
    ],
    "status": "OK",
    "enhancements": ["Email notifications via Resend", "Signing invitation/confirmation emails", "Team notifications"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "INTEGRATIONS/social-hub",
    "legacy_evidence": {
      "app": "social-app",
      "port": "5000 + 5001",
      "features": "posts, calendar, templates, analytics (11 pages)"
    },
    "current_candidates": [
      {
        "app": "social-hub",
        "file": "Not found in current inventory",
        "match_score": 0,
        "match_reasoning": "Social Hub migration not in scope for current Practice Hub MVP"
      }
    ],
    "status": "MISSING",
    "missing_features": ["Social media posting", "Social calendar", "Social analytics"],
    "regression_details": "Legacy social-app (9 pages, BullMQ, Redis) not migrated to current",
    "severity": "HIGH",
    "confidence": 90,
    "fix_proposal": {
      "approach": "Social Hub features out of scope for current MVP. Track as separate Story (Social Hub v2) for future release.",
      "estimated_effort": "Future epic"
    }
  },
  {
    "legacy_feature_id": "TIME_TRACKING/time-entry-logging",
    "legacy_evidence": {
      "hook": "useTimeEntry",
      "route": "/crm/time-entry"
    },
    "current_candidates": [
      {
        "route": "/client-hub/time-tracking",
        "api": "timesheets.createTimeEntry",
        "file": "app/server/routers/timesheets.ts",
        "match_score": 100,
        "match_reasoning": "Record hours against tasks. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "TIME_TRACKING/timesheet-approval",
    "legacy_evidence": {
      "route": "/crm/time-approvals",
      "component": "TimeApprovals.tsx"
    },
    "current_candidates": [
      {
        "route": "/client-hub/time/approvals",
        "api": "timesheet-submissions.submit, timesheet-submissions.approve",
        "file": "app/server/routers/timesheet-submissions.ts",
        "match_score": 100,
        "match_reasoning": "Submit and approve timesheets with workflow. Enhanced with full submission/approval lifecycle."
      }
    ],
    "status": "OK",
    "enhancements": ["Multi-stage approval (manager/admin)", "Rejection with feedback"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "TIME_TRACKING/toil-management",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "route": "/client-hub/leave",
        "api": "toil.accrueToil, toil.expireToil",
        "file": "app/server/routers/toil.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: TOIL accrual and expiry with leave integration"
      }
    ],
    "status": "OK",
    "enhancements": ["TOIL accrual tracking", "Automatic expiry", "Leave integration"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "TIME_TRACKING/leave-management",
    "legacy_evidence": {
      "route": "/leave (inferred)",
      "app": "employee-portal-app"
    },
    "current_candidates": [
      {
        "route": "/client-hub/leave",
        "api": "leave.requestLeave, leave.approveLeave",
        "file": "app/server/routers/leave.ts",
        "match_score": 100,
        "match_reasoning": "Leave requests, approvals, calendar view. Enhanced with full lifecycle."
      }
    ],
    "status": "OK",
    "enhancements": ["Calendar view integration", "Approval workflow"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "TIME_TRACKING/working-patterns",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "workingPatterns.list, workingPatterns.create",
        "file": "app/server/routers/workingPatterns.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Define standard and custom work patterns for accurate leave calculations"
      }
    ],
    "status": "OK",
    "enhancements": ["Shift definition support", "Accurate leave calculation"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_PORTAL/external-login",
    "legacy_evidence": {
      "route": "/portal/login",
      "component": "PortalLogin.tsx"
    },
    "current_candidates": [
      {
        "module": "client-portal",
        "api": "Better Auth with OAuth",
        "file": "app/client-portal/page.tsx",
        "match_score": 100,
        "match_reasoning": "External client authentication. Enhanced with Better Auth + OAuth support."
      }
    ],
    "status": "OK",
    "enhancements": ["OAuth support", "Better Auth integration"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_PORTAL/document-upload",
    "legacy_evidence": {
      "route": "/portal/documents",
      "component": "PortalDocumentsPage.tsx"
    },
    "current_candidates": [
      {
        "module": "client-portal",
        "api": "documents.upload, documents.list",
        "file": "app/client-portal/documents/page.tsx",
        "match_score": 100,
        "match_reasoning": "Upload and manage documents in portal. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "CLIENT_PORTAL/proposal-viewing",
    "legacy_evidence": {
      "component": "Not explicit in legacy"
    },
    "current_candidates": [
      {
        "module": "client-portal",
        "route": "/portal/proposals/[id]",
        "api": "clientPortal.getProposal",
        "match_score": 100,
        "match_reasoning": "NEW in current: Client portal proposal viewing with DocuSeal e-signature support"
      }
    ],
    "status": "OK",
    "enhancements": ["DocuSeal integration", "View tracking"],
    "severity": null,
    "confidence": 95
  },
  {
    "legacy_feature_id": "CLIENT_PORTAL/dual-isolation",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "getClientPortalAuthContext",
        "file": "lib/auth/get-client-portal-auth-context.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Enforced dual isolation (tenantId + clientId) at router level"
      }
    ],
    "status": "OK",
    "enhancements": ["Dual tenant + client isolation", "Enhanced security"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "ADMIN/user-management",
    "legacy_evidence": {
      "route": "/crm/admin/create-user",
      "component": "CreateUser.tsx"
    },
    "current_candidates": [
      {
        "api": "users.create, users.list, users.update",
        "file": "app/server/routers/users.ts",
        "match_score": 100,
        "match_reasoning": "Create, edit, deactivate staff users. Feature parity."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "ADMIN/user-invitations",
    "legacy_evidence": {
      "component": "Not explicit in legacy"
    },
    "current_candidates": [
      {
        "api": "invitations.send, invitations.accept",
        "file": "app/server/routers/invitations.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Email-based user invitations with token-based signup"
      }
    ],
    "status": "OK",
    "enhancements": ["Email-based invitations", "Token-based signup"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "ADMIN/role-based-access-control",
    "legacy_evidence": {
      "file": ".archive/crm-app/main/src/App.tsx:244",
      "roles": "staff role visible"
    },
    "current_candidates": [
      {
        "api": "protectedProcedure, adminProcedure",
        "file": "app/server/trpc.ts",
        "match_score": 100,
        "match_reasoning": "admin, staff, client roles with protected procedures. Better granularity than legacy."
      }
    ],
    "status": "OK",
    "enhancements": ["admin, staff, client role support", "Protected procedure patterns"],
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "ADMIN/email-templates",
    "legacy_evidence": {
      "route": "/crm/admin/email-templates",
      "component": "EmailTemplates.tsx"
    },
    "current_candidates": [
      {
        "api": "email-templates.list, email-templates.create",
        "file": "app/server/routers/email-templates.ts",
        "match_score": 100,
        "match_reasoning": "Email template management. Enhanced with centralized management via tRPC."
      }
    ],
    "status": "OK",
    "enhancements": null,
    "severity": null,
    "confidence": 100
  },
  {
    "legacy_feature_id": "ADMIN/audit-logging",
    "legacy_evidence": {
      "component": "Not in legacy"
    },
    "current_candidates": [
      {
        "api": "activities.log, activities.list",
        "file": "app/server/routers/activities.ts",
        "match_score": 100,
        "match_reasoning": "NEW in current: Activity logging for proposals, signatures, assignments, etc."
      }
    ],
    "status": "OK",
    "enhancements": ["Comprehensive audit trail"],
    "severity": null,
    "confidence": 100
  }
]
